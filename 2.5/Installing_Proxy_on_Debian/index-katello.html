<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Installing an External Smart Proxy Server 2.5</title>
<link rel="stylesheet" href="./katello.css">
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Installing an External Smart Proxy Server 2.5</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preparing-environment-for-capsule-installation">1. Preparing your Environment for Installation</a>
<ul class="sectlevel2">
<li><a href="#system-requirements_smart-proxy">1.1. System Requirements</a></li>
<li><a href="#capsule-storage-requirements_smart-proxy">1.2. Storage Requirements</a></li>
<li><a href="#storage-guidelines_smart-proxy">1.3. Storage Guidelines</a></li>
<li><a href="#supported-operating-systems_smart-proxy">1.4. Supported Operating Systems</a></li>
<li><a href="#capsule-ports-and-firewalls-requirements_smart-proxy">1.5. Ports and Firewalls Requirements</a></li>
<li><a href="#enabling-connections-from-capsule-to-satellite_smart-proxy">1.6. Enabling Connections from Smart&#160;Proxy&#160;server to Foreman&#160;server</a></li>
<li><a href="#enabling-connections-to-capsule_smart-proxy">1.7. Enabling Connections from Foreman&#160;server and Clients to a Smart&#160;Proxy&#160;server</a></li>
<li><a href="#verifying-firewall-settings_smart-proxy">1.8. Verifying Firewall Settings</a></li>
</ul>
</li>
<li><a href="#installing-capsule-server">2. Installing Smart&#160;Proxy&#160;server</a>
<ul class="sectlevel2">
<li><a href="#installing-capsule-server-packages_smart-proxy">2.1. Installing Smart&#160;Proxy&#160;server Packages</a></li>
<li><a href="#installing-an-external-smart-proxy-upstream_smart-proxy">2.2. Installing Smart&#160;Proxy&#160;server</a></li>
<li><a href="#synchronizing-the-system-clock-with-chronyd_smart-proxy">2.3. Synchronizing the System Clock With chronyd</a></li>
<li><a href="#configuring-capsule-server-with-ssl-certificates">2.4. Configuring Smart&#160;Proxy&#160;server with SSL Certificates</a></li>
<li><a href="#assigning-organization-location-capsule-server_smart-proxy">2.5. Assigning the Correct Organization and Location to Smart&#160;Proxy&#160;server in the Foreman web UI</a></li>
<li><a href="#configuring-capsule-container-gateway_smart-proxy">2.6. Container Gateway Configuration</a></li>
</ul>
</li>
<li><a href="#performing-additional-configuration-on-capsule-server">3. Performing Additional Configuration on Smart&#160;Proxy&#160;server</a>
<ul class="sectlevel2">
<li><a href="#enabling-katello-agent_smart-proxy">3.1. Enabling Katello Agent on External Smart&#160;Proxies</a></li>
<li><a href="#enabling-openscap_smart-proxy">3.2. Enabling OpenSCAP on External Smart&#160;Proxies</a></li>
<li><a href="#adding-life-cycle-environments_smart-proxy">3.3. Adding Life Cycle Environments to Smart&#160;Proxy&#160;servers</a></li>
<li><a href="#enabling-power-management-on-managed-hosts_smart-proxy">3.4. Enabling Power Management on Managed Hosts</a></li>
<li><a href="#configuring-dns-dhcp-and-tftp_smart-proxy">3.5. Configuring DNS, DHCP, and TFTP on Smart&#160;Proxy&#160;server</a></li>
</ul>
</li>
<li><a href="#capsule-server-scalability-considerations_smart-proxy">Appendix A: Smart&#160;Proxy&#160;server Scalability Considerations</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preparing-environment-for-capsule-installation">1. Preparing your Environment for Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="system-requirements_smart-proxy">1.1. System Requirements</h3>
<div class="paragraph">
<p>The following requirements apply to the networked base operating system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x86_64 architecture</p>
</li>
<li>
<p>4-core 2.0 GHz CPU at a minimum</p>
</li>
<li>
<p>A minimum of 12 GB RAM is required for Smart&#160;Proxy&#160;server to function.
In addition, a minimum of 4 GB RAM of swap space is also recommended.
Smart&#160;Proxy running with less RAM than the minimum value might not operate correctly.</p>
</li>
<li>
<p>A unique host name, which can contain lower-case letters, numbers, dots (.) and hyphens (-)</p>
</li>
<li>
<p>Administrative user (root) access</p>
</li>
<li>
<p>A system umask of 0022</p>
</li>
<li>
<p>Full forward and reverse DNS resolution using a fully-qualified domain name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Foreman only supports <code>UTF-8</code> encoding.
If your territory is USA and your language is English, set <code>en_US.utf-8</code> as the system-wide locale settings.
For more information about configuring system locale in Enterprise Linux, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/assembly_changing-basic-environment-settings_configuring-basic-system-settings#proc_configuring-the-system-locale_assembly_changing-basic-environment-settings">Configuring System Locale guide</a>.
Before you install Smart&#160;Proxy&#160;server, ensure that your environment meets the requirements for installation.</p>
</div>
<div class="paragraph">
<p>Smart&#160;Proxy&#160;server must be installed on a freshly provisioned system that serves no other function except to run Smart&#160;Proxy&#160;server.
The freshly provisioned system must not have the following users provided by external identity providers to avoid conflicts with the local users that Smart&#160;Proxy&#160;server creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>apache</p>
</li>
<li>
<p>foreman</p>
</li>
<li>
<p>foreman-proxy</p>
</li>
<li>
<p>postgres</p>
</li>
<li>
<p>pulp</p>
</li>
<li>
<p>puppet</p>
</li>
<li>
<p>puppetserver</p>
</li>
<li>
<p>qdrouterd</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">SELinux Mode</div>
<p>SELinux must be enabled, either in enforcing or permissive mode.
Installation with disabled SELinux is not supported.</p>
</div>
<div class="paragraph">
<div class="title">FIPS Mode</div>
<p>You can install Smart&#160;Proxy&#160;server on a Red&#160;Hat Enterprise Linux system that is operating in FIPS mode.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/chap-federal_standards_and_regulations#sec-Enabling-FIPS-Mode">Enabling FIPS Mode</a> in the <em>Red&#160;Hat Enterprise Linux Security Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="capsule-storage-requirements_smart-proxy">1.2. Storage Requirements</h3>
<div class="paragraph">
<p>The following table details storage requirements for specific directories.
These values are based on expected use case scenarios and can vary according to individual environments.</p>
</div>
<div class="paragraph">
<p>The runtime size was measured with Red&#160;Hat Enterprise Linux 6, 7, and 8 repositories synchronized.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Storage Requirements for Smart&#160;Proxy&#160;server Installation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Installation Size</th>
<th class="tableblock halign-left valign-top">Runtime Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pulp/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/opt/rh/rh-postgresql12/lib/pgsql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="storage-guidelines_smart-proxy">1.3. Storage Guidelines</h3>
<div class="paragraph">
<p>Consider the following guidelines when installing Smart&#160;Proxy&#160;server to increase efficiency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you mount the <code>/tmp</code> directory as a separate file system, you must use the <code>exec</code> mount option in the <code>/etc/fstab</code> file.
If <code>/tmp</code> is already mounted with the <code>noexec</code> option, you must change the option to <code>exec</code> and re-mount the file system.
This is a requirement for the <code>puppetserver</code> service to work.</p>
</li>
<li>
<p>Because most Smart&#160;Proxy&#160;server data is stored in the <code>/var</code> directory, mounting <code>/var</code> on LVM storage can help the system to scale.</p>
</li>
<li>
<p>The <code>/var/lib/qpidd/</code> directory uses slightly more than 2 MB per Content Host managed by the <code>goferd</code> service.
For example, 10 000 Content Hosts require 20 GB of disk space in <code>/var/lib/qpidd/</code>.</p>
</li>
<li>
<p>Use high-bandwidth, low-latency storage for the <code>/var/lib/pulp/</code> directories.
As Foreman has many operations that are I/O intensive, using high latency, low-bandwidth storage causes performance degradation.
Ensure your installation has a speed in the range 60 - 80 Megabytes per second.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">File System Guidelines</div>
<ul>
<li>
<p>Do not use the GFS2 file system as the input-output latency is too high.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Log File Storage</div>
<p>Log files are written to <code>/var/log/messages/,</code> <code>/var/log/httpd/</code>, and <code>/var/lib/foreman-proxy/openscap/content/</code>.
You can manage the size of these files using <strong>logrotate</strong>.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-viewing_and_managing_log_files#s2-log_rotation">Log Rotation</a> in the <em>Red Hat Enterprise Linux 7 System Administrator’s Guide</em>.</p>
</div>
<div class="paragraph">
<p>The exact amount of storage you require for log messages depends on your installation and setup.</p>
</div>
<div class="paragraph">
<div class="title">SELinux Considerations for NFS Mount</div>
<p>When the <code>/var/lib/pulp</code> directory is mounted using an NFS share, SELinux blocks the synchronization process.
To avoid this, specify the SELinux context of the <code>/var/lib/pulp</code> directory in the file system table by adding the following lines to <code>/etc/fstab</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nfs.example.com:/nfsshare  /var/lib/pulp  nfs  context="system_u:object_r:var_lib_t:s0"  1 2</pre>
</div>
</div>
<div class="paragraph">
<p>If NFS share is already mounted, remount it using the above configuration and enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># restorecon -R /var/lib/pulp</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Duplicated Packages</div>
<p>Packages that are duplicated in different repositories are only stored once on the disk.
Additional repositories containing duplicate packages require less additional storage.
The bulk of storage resides in the <code>/var/lib/pulp/</code> directory.
These end points are not manually configurable.
Ensure that storage is available on the <code>/var</code> file system to prevent storage problems.</p>
</div>
<div class="paragraph">
<div class="title">Software Collections</div>
<p>Software collections are installed in the <code>/opt/rh/</code> and <code>/opt/theforeman/</code> directories.</p>
</div>
<div class="paragraph">
<p>Write and execute permissions by the root user are required for installation to the <code>/opt</code> directory.</p>
</div>
<div class="paragraph">
<div class="title">Symbolic links</div>
<p>You cannot use symbolic links for <code>/var/lib/pulp/</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-operating-systems_smart-proxy">1.4. Supported Operating Systems</h3>
<div class="paragraph">
<p>You can install the operating system from a disc, local ISO image, or kickstart.</p>
</div>
<div class="paragraph">
<p>The following operating systems are supported by the installer, have packages, and are tested for deploying Foreman:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Operating Systems supported by foreman-installer</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is not supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Enterprise Linux 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is required.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Before you install Foreman, apply all operating system updates if possible.</p>
</div>
<div class="paragraph">
<p>Install Smart&#160;Proxy&#160;server on a freshly provisioned system.</p>
</div>
</div>
<div class="sect2">
<h3 id="capsule-ports-and-firewalls-requirements_smart-proxy">1.5. Ports and Firewalls Requirements</h3>
<div class="paragraph">
<p>For the components of Foreman architecture to communicate, ensure that the required network ports are open and free on the base operating system.
You must also ensure that the required network ports are open on any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>The installation of a Smart&#160;Proxy&#160;server fails if the ports between Foreman&#160;server and Smart&#160;Proxy&#160;server are not open before installation starts.</p>
</div>
<div class="paragraph">
<p>Use this information to configure any network-based firewalls.
Note that some cloud solutions must be specifically configured to allow communications between machines because they isolate machines similarly to network-based firewalls.
If you use an application-based firewall, ensure that the application-based firewall permits all applications that are listed in the tables and known to your firewall.
If possible, disable the application checking and allow open port communication based on the protocol.</p>
</div>
<div class="paragraph">
<div class="title">Integrated Smart&#160;Proxy</div>
<p>Foreman&#160;server has an integrated Smart&#160;Proxy and any host that is directly connected to Foreman&#160;server is a Client of Foreman in the context of this section.
This includes the base operating system on which Smart&#160;Proxy&#160;server is running.</p>
</div>
<div class="paragraph">
<div class="title">Clients of Smart&#160;Proxy</div>
<p>Hosts which are clients of Smart&#160;Proxies, other than Foreman&#8217;s integrated Smart&#160;Proxy, do not need access to Foreman&#160;server.
For more information on Foreman Topology and an illustration of port connections, see <a href="https://docs.theforeman.org/2.5/Planning_Guide/index-foreman-el.html#sect-Documentation-Architecture_Guide-Capsule_Networking">Smart&#160;Proxy Networking</a> in <em>Planning for Foreman</em>.</p>
</div>
<div class="paragraph">
<p>Required ports can change based on your configuration.</p>
</div>
<div class="paragraph">
<p>The following tables indicate the destination port and the direction of network traffic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Smart&#160;Proxy incoming traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Required For</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers and clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name resolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP Server (optional)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Retrieval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Host Registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy CA RPM installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Mirroring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart Proxy functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5647</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMQP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">goferd message bus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward message to client (optional)</p>
<p class="tableblock">Katello agent to communicate with Qpid dispatcher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisioning templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template retrieval for client installers, iPXE or UEFI HTTP Boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXE Boot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client updates (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Host registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiation</p>
<p class="tableblock">Uploading facts</p>
<p class="tableblock">Sending installed packages and traces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenSCAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovered Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host discovery and provisioning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy functionality</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any managed host that is directly connected to Foreman&#160;server is a client in this context because it is a client of the integrated Smart&#160;Proxy.
This includes the base operating system on which a Smart&#160;Proxy&#160;server is running.</p>
</div>
<div class="paragraph">
<p>A DHCP Smart&#160;Proxy performs ICMP ping and TCP echo connection attempts to hosts in subnets with DHCP IPAM set to find out if an IP address considered for use is free.
This behavior can be turned off using <code>foreman-installer --foreman-proxy-dhcp-ping-free-ip=false</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Smart&#160;Proxy outgoing traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Required For</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">echo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers on the Internet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve DNS records (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation of DNS conflicts (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p>
<p class="tableblock">Configuration management</p>
<p class="tableblock">Template retrieval</p>
<p class="tableblock">OpenSCAP</p>
<p class="tableblock">Remote Execution result upload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client communication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward requests from Client to Foreman</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infoblox DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When using Infoblox for DHCP, management of the DHCP leases (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">623</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BMC On/Off/Cycle/Status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5646</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMQP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman&#160;server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Katello agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward message to Qpid dispatch router on Smart&#160;Proxy (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7911</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP, OMAPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DHCP target is configured using <code>--foreman-proxy-dhcp-server</code> and defaults to localhost</p>
<p class="tableblock">ISC and <code>remote_isc</code> use a configurable port that defaults to 7911 and uses OMAPI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy sends reboot command to the discovered host (optional)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
ICMP to Port 7 UDP and TCP must not be rejected, but can be dropped.
The DHCP Smart&#160;Proxy sends an ECHO REQUEST to the Client network to verify that an IP address is free.
Any response will prevent IP addresses being allocated.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="enabling-connections-from-capsule-to-satellite_smart-proxy">1.6. Enabling Connections from Smart&#160;Proxy&#160;server to Foreman&#160;server</h3>
<div class="paragraph">
<p>On Foreman&#160;server, you must enable the incoming connection from Smart&#160;Proxy&#160;server to Foreman&#160;server and make this rule persistent across reboots.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the firewall rules on Foreman&#160;server are configured to enable connections for client to Foreman communication, because Smart&#160;Proxy&#160;server is a client of Foreman&#160;server.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#enabling-client-connections-to-satellite_foreman">Enabling Connections from a Client to Foreman&#160;server</a> in <em>Installing Foreman 2.5 server with Katello 4.1 plugin on Enterprise Linux</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, enter the following command to open the port for Smart&#160;Proxy to Foreman communication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="5646/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-connections-to-capsule_smart-proxy">1.7. Enabling Connections from Foreman&#160;server and Clients to a Smart&#160;Proxy&#160;server</h3>
<div class="paragraph">
<p>On the base operating system on which you want to install Smart&#160;Proxy, you must enable incoming connections from Foreman&#160;server and clients to Smart&#160;Proxy&#160;server and make these rules persistent across reboots.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the base operating system on which you want to install Smart&#160;Proxy, enter the following command to open the ports for Foreman&#160;server and clients communication to Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="53/udp" --add-port="53/tcp" \
--add-port="67/udp" --add-port="69/udp" \
--add-port="80/tcp" --add-port="443/tcp" \
--add-port="5647/tcp" \
--add-port="8000/tcp" --add-port="8140/tcp" \
--add-port="8443/tcp" --add-port="9090/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="verifying-firewall-settings_smart-proxy">1.8. Verifying Firewall Settings</h3>
<div class="paragraph">
<p>Use this procedure to verify your changes to the firewall settings.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --list-all</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-using_firewalls#sec-Getting_started_with_firewalld">Getting Started with firewalld</a> in the <em>Red Hat Enterprise Linux 7 Security Guide</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-capsule-server">2. Installing Smart&#160;Proxy&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install Smart&#160;Proxy&#160;server, you must ensure that your environment meets the requirements for installation.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Proxy_on_Red_Hat/index-foreman-el.html#preparing-environment-for-capsule-installation">Preparing your Environment for Installation</a>.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in common/assembly_installing-capsule-server.adoc - include::modules/proc_registering-capsule-to-satellite-server.adoc[leveloffset=+1]</p>
</div>
<div class="sect2">
<h3 id="installing-capsule-server-packages_smart-proxy">2.1. Installing Smart&#160;Proxy&#160;server Packages</h3>
<div class="paragraph">
<p>Before installing Smart&#160;Proxy&#160;server packages, you must update all packages that are installed on the base operating system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install Smart&#160;Proxy&#160;server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>foreman-proxy-content</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install foreman-proxy-content</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-an-external-smart-proxy-upstream_smart-proxy">2.2. Installing Smart&#160;Proxy&#160;server</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To install an external Smart&#160;Proxy, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer \
  --no-enable-foreman \
  --no-enable-foreman-cli \
  --enable-puppet \
  --puppet-server-ca=false \
  --puppet-server-foreman-url=https://<em>foreman.example.com</em> \
  --enable-foreman-proxy \
  --foreman-proxy-puppetca=false \
  --foreman-proxy-tftp=false \
  --foreman-proxy-foreman-base-url=https://<em>foreman.example.com</em> \
  --foreman-proxy-trusted-hosts=<em>foreman.example.com</em> \
  --foreman-proxy-oauth-consumer-key=<em>oAuth_Consumer_Key</em> \
  --foreman-proxy-oauth-consumer-secret=<em>oAuth_Consumer_Secret</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-the-system-clock-with-chronyd_smart-proxy">2.3. Synchronizing the System Clock With chronyd</h3>
<div class="paragraph">
<p>To minimize the effects of time drift, you must synchronize the system clock on the base operating system on which you want to install Smart&#160;Proxy&#160;server with Network Time Protocol (NTP) servers.
If the base operating system clock is configured incorrectly, certificate verification might fail.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>chrony</code> suite, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-configuring_ntp_using_the_chrony_suite">Configuring NTP Using the chrony Suite</a> in the <em>Red Hat Enterprise Linux 7 System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>chrony</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install chrony</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the <code>chronyd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start chronyd
# systemctl enable chronyd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-capsule-server-with-ssl-certificates">2.4. Configuring Smart&#160;Proxy&#160;server with SSL Certificates</h3>
<div class="paragraph">
<p>Foreman uses SSL certificates to enable encrypted communications between Foreman&#160;server, external Smart&#160;Proxy&#160;servers, and all hosts.
Depending on the requirements of your organization, you must configure your Smart&#160;Proxy&#160;server with a default or custom certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use a default SSL certificate, you must also configure each external Smart&#160;Proxy&#160;server with a distinct default SSL certificate.
For more information, see <a href="#configuring-capsule-default-certificate_smart-proxy">Configuring Smart&#160;Proxy&#160;server with a Default SSL Certificate</a>.</p>
</li>
<li>
<p>If you use a custom SSL certificate, you must also configure each external Smart&#160;Proxy&#160;server with a distinct custom SSL certificate.
For more information, see <a href="#configuring-capsule-custom-server-certificate_smart-proxy">Configuring Smart&#160;Proxy&#160;server with a Custom SSL Certificate</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="assigning-organization-location-capsule-server_smart-proxy">2.5. Assigning the Correct Organization and Location to Smart&#160;Proxy&#160;server in the Foreman web UI</h3>
<div class="paragraph">
<p>After installing Smart&#160;Proxy&#160;server packages, if there is more than one organization or location, you must assign the correct organization and location to Smart&#160;Proxy to make Smart&#160;Proxy visible in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log into the Foreman web UI.</p>
</li>
<li>
<p>From the <strong>Organization</strong> list in the upper-left of the screen, select <strong>Any Organization</strong>.</p>
</li>
<li>
<p>From the <strong>Location</strong> list in the upper-left of the screen, select <strong>Any Location</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and select Smart&#160;Proxy&#160;server.</p>
</li>
<li>
<p>From the <strong>Select Actions</strong> list, select <strong>Assign Organization</strong>.</p>
</li>
<li>
<p>From the <strong>Organization</strong> list, select the organization where you want to assign this Smart&#160;Proxy.</p>
</li>
<li>
<p>Click <strong>Fix Organization on Mismatch</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Select Smart&#160;Proxy&#160;server. From the <strong>Select Actions</strong> list, select <strong>Assign Location</strong>.</p>
</li>
<li>
<p>From the <strong>Location</strong> list, select the location where you want to assign this Smart&#160;Proxy.</p>
</li>
<li>
<p>Click <strong>Fix Location on Mismatch</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Organizations</strong> and click the organization to which you have assigned Smart&#160;Proxy.</p>
</li>
<li>
<p>Click <strong>Smart&#160;Proxies</strong> tab and ensure that Smart&#160;Proxy&#160;server is listed under the <strong>Selected items</strong> list, then click <strong>Submit</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Locations</strong> and click the location to which you have assigned Smart&#160;Proxy.</p>
</li>
<li>
<p>Click <strong>Smart&#160;Proxies</strong> tab and ensure that Smart&#160;Proxy&#160;server is listed under the <strong>Selected items</strong> list, then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Optionally, you can verify if Smart&#160;Proxy&#160;server is correctly listed in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the organization from the <strong>Organization</strong> list.</p>
</li>
<li>
<p>Select the location from the <strong>Location</strong> list.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Foreman uses SSL certificates to enable encrypted communications between Foreman&#160;server, external Smart&#160;Proxy&#160;servers, and all hosts.
Depending on the requirements of your organization, you must configure your Smart&#160;Proxy&#160;server with a default or custom certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use a default SSL certificate, you must also configure each external Smart&#160;Proxy&#160;server with a distinct default SSL certificate.
For more information, see <a href="#configuring-capsule-default-certificate_smart-proxy">Configuring Smart&#160;Proxy&#160;server with a Default SSL Certificate</a>.</p>
</li>
<li>
<p>If you use a custom SSL certificate, you must also configure each external Smart&#160;Proxy&#160;server with a distinct custom SSL certificate.
For more information, see <a href="#configuring-capsule-custom-server-certificate_smart-proxy">Configuring Smart&#160;Proxy&#160;server with a Custom SSL Certificate</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-capsule-default-certificate_smart-proxy">2.5.1. Configuring Smart&#160;Proxy&#160;server with a Default SSL Certificate</h4>
<div class="paragraph">
<p>Use this section to configure Smart&#160;Proxy&#160;server with an SSL certificate that is signed by Foreman&#160;server default Certificate Authority (CA).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Smart&#160;Proxy&#160;server is registered to Foreman&#160;server.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Proxy_on_Red_Hat/index-foreman-el.html#registering-to-satellite-server_smart-proxy">Registering to Foreman&#160;server</a>.</p>
</li>
<li>
<p>Smart&#160;Proxy&#160;server packages are installed.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Proxy_on_Red_Hat/index-foreman-el.html#installing-capsule-server-packages_smart-proxy">Installing Smart&#160;Proxy&#160;server Packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, to store all the source certificate files for your Smart&#160;Proxy&#160;server, create a directory that is accessible only to the <code>root</code> user, for example <code>/root/smart-proxy_cert</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/<em>smart-proxy_cert</em></pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, generate the <code><em>/root/smart-proxy_cert/smart-proxy_certs.tar</em></code> certificate archive for your Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--foreman-proxy-fqdn <em>smartproxy.example.com</em> \
--certs-tar <em>/root/smart-proxy_cert/smart-proxy_certs.tar</em></pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns for deploying the certificate to your Smart&#160;Proxy&#160;server.</p>
</div>
<div class="listingblock">
<div class="title">Example output of <code>foreman-proxy-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
foreman-installer --scenario foreman-proxy-content \
--certs-tar-file "<em>/root/smart-proxy_certs.tar</em>" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-foreman-base-url "https://<em>foreman.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>foreman.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>smartproxy.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>s97QxvUAgFNAQZNGg4F9zLq2biDsxM7f</em>" \
--foreman-proxy-oauth-consumer-secret "<em>6bpzAdMpRAfYaVZtaepYetomgBVQ6ehY</em>" \
--puppet-server-foreman-url "https://<em>foreman.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, copy the certificate archive file to your Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/smart-proxy_cert/<em>smartproxy.example.com</em>-certs.tar \
root@<em>smartproxy.example.com</em>:/root/<em>smartproxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On Smart&#160;Proxy&#160;server, to deploy the certificate, enter the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>When network connections or ports to Foreman are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent Smart&#160;Proxy from attempting to connect to Foreman and reporting errors.
Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate.
It is required, for example, when upgrading Smart&#160;Proxy&#160;server.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-capsule-custom-server-certificate_smart-proxy">2.5.2. Configuring Smart&#160;Proxy&#160;server with a Custom SSL Certificate</h4>
<div class="paragraph">
<p>If you configure Foreman&#160;server to use a custom SSL certificate, you must also configure each of your external Smart&#160;Proxy&#160;servers with a distinct custom SSL certificate.</p>
</div>
<div class="paragraph">
<p>To configure your Smart&#160;Proxy&#160;server with a custom certificate, complete the following procedures on each Smart&#160;Proxy&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-custom-certificate_smart-proxy">Creating a Custom SSL Certificate for Smart&#160;Proxy&#160;server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-capsule-server_smart-proxy">Deploying a Custom SSL Certificate to Smart&#160;Proxy&#160;server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-hosts_smart-proxy">Deploying a Custom SSL Certificate to Hosts</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="creating-a-custom-certificate_smart-proxy">Creating a Custom SSL Certificate for Smart&#160;Proxy&#160;server</h5>
<div class="paragraph">
<p>On Foreman&#160;server, create a custom certificate for your Smart&#160;Proxy&#160;server.
If you already have a custom SSL certificate for Smart&#160;Proxy&#160;server, skip this procedure.</p>
</div>
<div class="paragraph">
<p>When you configure Smart&#160;Proxy&#160;server with custom certificates, note the following considerations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must use the Privacy-Enhanced Mail (PEM) encoding for the SSL certificates.</p>
</li>
<li>
<p>You cannot use the same certificate for both Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
</li>
<li>
<p>The same Certificate Authority must sign certificates for Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/smart-proxy_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the Certificate Signing Request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted.
If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this Smart&#160;Proxy&#160;server, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/smart-proxy_cert/smart-proxy_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/smart-proxy_cert/openssl.cnf</code> configuration file for the Certificate Signing Request (CSR) and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
x509_extensions = usr_cert
prompt = no

[ req_distinguished_name ] <b class="conum">(1)</b>
C  = <em>Country Name (2 letter code)</em>
ST = <em>State or Province Name (full name)</em>
L  = <em>Locality Name (eg, city)</em>
O  = <em>Organization Name (eg, company)</em>
OU = <em>The division of your organization handling the certificate</em>
CN = <em>smart-proxy.example.com</em> <b class="conum">(2)</b>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
subjectAltName = @alt_names

[ usr_cert ]
basicConstraints=CA:FALSE
nsCertType = client, server, email
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
nsComment = "OpenSSL Generated Certificate"
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

[ alt_names ]
DNS.1 = <em>smart-proxy.example.com</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In the <code>[ req_distinguished_name ]</code> section, enter information about your organization.</p>
</li>
<li>
<p>Set the certificate&#8217;s Common Name <code>CN</code> to match the fully qualified domain name (FQDN) of your Smart&#160;Proxy&#160;server or a wildcard value <code>*</code>.
To confirm a FQDN, on that Smart&#160;Proxy&#160;server, enter the <code>hostname -f</code> command.
This is required to ensure that the <code>katello-certs-check</code> command validates the certificate correctly.
If you set a wildcard value, you must add the <code>-t foreman-proxy</code> option when you use the <code>katello-certs-check</code> command.</p>
</li>
<li>
<p>Set the Subject Alternative Name (SAN) <code>DNS.1</code> to match the fully qualified domain name (FQDN) of your server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the Certificate Signing Request (CSR):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/smart-proxy_cert/smart-proxy_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/smart-proxy_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/smart-proxy_cert/smart-proxy_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key.</p>
</li>
<li>
<p>Path to the configuration file.</p>
</li>
<li>
<p>Path to the CSR to generate.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the Certificate Authority.
The same Certificate Authority must sign certificates for Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate.
The method for sending the certificate request varies, so consult the Certificate Authority for the preferred method.
In response to the request, you can expect to receive a Certificate Authority bundle and a signed certificate, in separate files.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-capsule-server_smart-proxy">Deploying a Custom SSL Certificate to Smart&#160;Proxy&#160;server</h5>
<div class="paragraph">
<p>Use this procedure to configure your Smart&#160;Proxy&#160;server with a custom SSL certificate signed by a Certificate Authority.
The <code>foreman-installer</code> command, which the <code>foreman-proxy-certs-generate</code> command returns, is unique to each Smart&#160;Proxy&#160;server.
Do not use the same command on more than one Smart&#160;Proxy&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Foreman&#160;server is configured with a custom certificate.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#configuring-satellite-custom-server-certificate_foreman">Configuring Foreman&#160;server with a Custom SSL Certificate</a> in <em>Installing Foreman 2.5 server with Katello 4.1 plugin on Enterprise Linux</em>.</p>
</li>
<li>
<p>Smart&#160;Proxy&#160;server is registered to Foreman&#160;server.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Proxy_on_Red_Hat/index-foreman-el.html#registering-to-satellite-server_smart-proxy">Registering to Foreman&#160;server</a>.</p>
</li>
<li>
<p>Smart&#160;Proxy&#160;server packages are installed.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Proxy_on_Red_Hat/index-foreman-el.html#installing-capsule-server-packages_smart-proxy">Installing Smart&#160;Proxy&#160;server Packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, validate the custom SSL certificate input files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-certs-check \
-t foreman-proxy -c <em>/root/smart-proxy_cert/smart-proxy_cert.pem</em> \      <b class="conum">(1)</b>
-k <em>/root/smart-proxy_cert/smart-proxy_cert_key.pem</em> \  <b class="conum">(2)</b>
-b <em>/root/smart-proxy_cert/ca_cert_bundle.pem</em>      <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to Smart&#160;Proxy&#160;server certificate file that is signed by a Certificate Authority.</p>
</li>
<li>
<p>Path to the private key that was used to sign Smart&#160;Proxy&#160;server certificate.</p>
</li>
<li>
<p>Path to the Certificate Authority bundle.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you set a wildcard value <code>*</code> for the certificate&#8217;s Common Name <code>CN =</code> in the <code>/root/smart-proxy_cert/openssl.cnf</code> configuration file, you must add the <code>-t foreman-proxy</code> option to the <code>katello-certs-check</code> command.</p>
</div>
<div class="paragraph">
<p>If the command is successful, it returns two <code>foreman-proxy-certs-generate</code> commands, one of which you must use to generate the certificate archive file for your Smart&#160;Proxy&#160;server.</p>
</div>
<div class="listingblock">
<div class="title">Example output of <code>katello-certs-check</code></div>
<div class="content">
<pre class="nowrap">Validation succeeded.

To use them inside a NEW $FOREMAN_PROXY, run this command:
  foreman-proxy-certs-generate --foreman-proxy-fqdn "$FOREMAN_PROXY" \
    --certs-tar  "~$FOREMAN_PROXY-certs.tar" \
    --server-cert "<em>/root/smart-proxy_cert/smart-proxy_cert.pem</em>" \
    --server-key "<em>/root/smart-proxy_cert/smart-proxy_cert_key.pem</em>" \
    --server-ca-cert "<em>/root/smart-proxy_cert/ca_cert_bundle.pem</em>" \

To use them inside an EXISTING $FOREMAN_PROXY, run this command INSTEAD:
  foreman-proxy-certs-generate --foreman-proxy-fqdn "\$FOREMAN_PROXY" \
    --certs-tar  "~/$FOREMAN_PROXY-certs.tar" \
    --server-cert "<em>/root/smart-proxy_cert/smart-proxy_cert.pem</em>" \
    --server-key "<em>/root/smart-proxy_cert/smart-proxy_cert_key.pem</em>" \
    --server-ca-cert "<em>/root/smart-proxy_cert/ca_cert_bundle.pem</em>" \
    --certs-update-server</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, from the output of the <code>katello-certs-check</code> command, depending on your requirements, enter the <code>foreman-proxy-certs-generate</code> command that generates a certificate for a new or existing Smart&#160;Proxy.</p>
<div class="paragraph">
<p>In this command, change <code>$FOREMAN_PROXY</code> to the FQDN of your Smart&#160;Proxy&#160;server.</p>
</div>
</li>
<li>
<p>Retain a copy of the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns for deploying the certificate to your Smart&#160;Proxy&#160;server.</p>
<div class="listingblock">
<div class="title">Example output of <code>foreman-proxy-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
foreman-installer --scenario foreman-proxy-content \
--certs-tar-file "<em>/root/smart-proxy_certs.tar</em>" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-foreman-base-url "https://<em>foreman.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>foreman.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>smartproxy.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>s97QxvUAgFNAQZNGg4F9zLq2biDsxM7f</em>" \
--foreman-proxy-oauth-consumer-secret "<em>6bpzAdMpRAfYaVZtaepYetomgBVQ6ehY</em>" \
--puppet-server-foreman-url "https://<em>foreman.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, copy the certificate archive file to your Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/smart-proxy_cert/<em>smartproxy.example.com</em>-certs.tar \
root@<em>smartproxy.example.com</em>:/root/<em>smartproxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On Smart&#160;Proxy&#160;server, to deploy the certificate, enter the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>When network connections or ports to Foreman are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent Smart&#160;Proxy from attempting to connect to Foreman and reporting errors.
Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate.
It is required, for example, when upgrading Smart&#160;Proxy&#160;server.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-hosts_smart-proxy">Deploying a Custom SSL Certificate to Hosts</h5>
<div class="paragraph">
<p>After you configure Smart&#160;Proxy&#160;server to use a custom SSL certificate, you must also install the <code>katello-ca-consumer</code> package on every host that is registered to this Smart&#160;Proxy&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On each host, install the <code>katello-ca-consumer</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall \
http://<em>smart-proxy.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-capsule-container-gateway_smart-proxy">2.6. Container Gateway Configuration</h3>
<div class="paragraph">
<p>Use this section to configure the Container Gateway on Smart&#160;Proxy&#160;server.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>The Container Gateway is installed by default with the foreman-proxy-content scenario.  If you wish to disable it, you must set the <code>--foreman-proxy-content-enable-docker</code> installer option to false.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>The default configuration should be sufficient for most users.  If the default configuration isn&#8217;t sufficient, the configuration may be changed in <code>/etc/foreman-proxy/settings.d/container_gateway.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
:enabled: true
:pulp_endpoint: 'https://your_pulp_3_server_here.com'
:pulp_client_ssl_ca: 'CA Cert for authenticating with Pulp'
:pulp_client_ssl_cert: 'X509 certificate for authenticating with Pulp'
:pulp_client_ssl_key: 'RSA private key for the Pulp certificate'
:katello_registry_path: 'Katello container registry suffix, e.g., /v2/'
:sqlite_db_path: '/var/lib/foreman-proxy/smart_proxy_container_gateway.db'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performing-additional-configuration-on-capsule-server">3. Performing Additional Configuration on Smart&#160;Proxy&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this chapter to configure additional settings on your Smart&#160;Proxy&#160;server.</p>
</div>
<div class="sect2">
<h3 id="enabling-katello-agent_smart-proxy">3.1. Enabling Katello Agent on External Smart&#160;Proxies</h3>
<div class="paragraph">
<p>Remote Execution is the primary method of managing packages on Content Hosts. To be able to use the deprecated Katello Agent it must be enabled on each Smart&#160;Proxy.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable Katello Agent infrastructure, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--foreman-proxy-content-enable-katello-agent=true</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enabling-openscap_smart-proxy">3.2. Enabling OpenSCAP on External Smart&#160;Proxies</h3>
<div class="paragraph">
<p>On Foreman&#160;server and the integrated Smart&#160;Proxy of your Foreman&#160;server, OpenSCAP is enabled by default.</p>
</div>
<div class="paragraph">
<p>To use the OpenSCAP plug-in and content on an external Smart&#160;Proxy, you must enable OpenSCAP on each Smart&#160;Proxy.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable OpenSCAP, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--enable-foreman-proxy-plugin-openscap</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-life-cycle-environments_smart-proxy">3.3. Adding Life Cycle Environments to Smart&#160;Proxy&#160;servers</h3>
<div class="paragraph">
<p>This procedure is only for Katello plug-in users.</p>
</div>
<div class="paragraph">
<p>If your Smart&#160;Proxy&#160;server has the content functionality enabled, you must add an environment so that Smart&#160;Proxy can synchronize content from Foreman&#160;server and provide content to host systems.</p>
</div>
<div class="paragraph">
<p>Do not assign the <em>Library</em> lifecycle environment to your Smart&#160;Proxy&#160;server because it triggers an automated Smart&#160;Proxy sync every time the CDN updates a repository.
This might consume multiple system resources on Smart&#160;Proxies, network bandwidth between Foreman and Smart&#160;Proxies, and available disk space on Smart&#160;Proxies.</p>
</div>
<div class="paragraph">
<p>You can use Hammer CLI on Foreman&#160;server or the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>, and select the Smart&#160;Proxy that you want to add a life cycle to.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and click the <strong>Life Cycle Environments</strong> tab.</p>
</li>
<li>
<p>From the left menu, select the life cycle environments that you want to add to Smart&#160;Proxy and click <strong>Submit</strong>.</p>
</li>
<li>
<p>To synchronize the content on the Smart&#160;Proxy, click the <strong>Overview</strong> tab and click <strong>Synchronize</strong>.</p>
</li>
<li>
<p>Select either <strong>Optimized Sync</strong> or <strong>Complete Sync</strong>.</p>
<div class="paragraph">
<p>For definitions of each synchronization type, see <a href="https://docs.theforeman.org/2.5/Content_Management_Guide/index-foreman-el.html#Importing_Content-Recovering_a_Repository">Recovering a Repository</a>.</p>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>To display a list of all Smart&#160;Proxy&#160;servers, on Foreman&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule list</pre>
</div>
</div>
<div class="paragraph">
<p>Note the Smart&#160;Proxy ID of the Smart&#160;Proxy that you want to add a life cycle to.</p>
</div>
</li>
<li>
<p>Using the ID, verify the details of your Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule info --id <em>capsule_id</em></pre>
</div>
</div>
</li>
<li>
<p>To view the life cycle environments available for your Smart&#160;Proxy&#160;server, enter the following command and note the ID and the organization name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content available-lifecycle-environments --id <em>capsule_id</em></pre>
</div>
</div>
</li>
<li>
<p>Add the life cycle environment to your Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content add-lifecycle-environment \
--id <em>capsule_id</em> --organization "<em>My_Organization</em>" \
--lifecycle-environment-id <em>lifecycle-environment_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat for each life cycle environment you want to add to Smart&#160;Proxy&#160;server.</p>
</div>
</li>
<li>
<p>Synchronize the content from Foreman to Smart&#160;Proxy.</p>
<div class="ulist">
<ul>
<li>
<p>To synchronize all content from your Foreman&#160;server environment to Smart&#160;Proxy&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content synchronize --id <em>capsule_id</em></pre>
</div>
</div>
</li>
<li>
<p>To synchronize a specific life cycle environment from your Foreman&#160;server to Smart&#160;Proxy&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content synchronize --id <em>external_capsule_id</em> \
--lifecycle-environment-id <em>lifecycle-environment_id</em></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-power-management-on-managed-hosts_smart-proxy">3.4. Enabling Power Management on Managed Hosts</h3>
<div class="paragraph">
<p>To perform power management tasks on managed hosts using the intelligent platform management interface (IPMI) or a similar protocol, you must enable the baseboard management controller (BMC) module on Smart&#160;Proxy&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All managed hosts must have a network interface of BMC type.
Smart&#160;Proxy&#160;server uses this NIC to pass the appropriate credentials to the host.
For more information, see <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#adding-a-bmc-interface">Adding a Baseboard Management Controller (BMC) Interface</a> in <em>Managing Hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable BMC, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--foreman-proxy-bmc "true" \
--foreman-proxy-bmc-default-provider "freeipmi"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-dns-dhcp-and-tftp_smart-proxy">3.5. Configuring DNS, DHCP, and TFTP on Smart&#160;Proxy&#160;server</h3>
<div class="paragraph">
<p>To configure the DNS, DHCP, and TFTP services on Smart&#160;Proxy&#160;server, use the <code>foreman-installer</code> command with the options appropriate for your environment.
To view a complete list of configurable options, enter the <code>foreman-installer --scenario katello --help</code> command.</p>
</div>
<div class="paragraph">
<p>Any changes to the settings require entering the <code>foreman-installer</code> command again.
You can enter the command multiple times and each time it updates all configuration files with the changed values.</p>
</div>
<div class="paragraph">
<p>To use external DNS, DHCP, and TFTP services instead, see <a href="#configuring-external-services">[configuring-external-services]</a>.</p>
</div>
<div class="paragraph">
<div class="title">Adding Multihomed DHCP details</div>
<p>If you want to use Multihomed DHCP, you must inform the installer.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have the correct network name (<code>dns-interface</code>) for the DNS server.</p>
</li>
<li>
<p>You must have the correct interface name (<code>dhcp-interface</code>) for the DHCP server.</p>
</li>
<li>
<p>Contact your network administrator to ensure that you have the correct settings.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the <code>foreman-installer</code> command with the options appropriate for your environment.
The following example shows configuring full provisioning services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-interface <em>eth0</em> \
--foreman-proxy-dns-zone <em>example.com</em> \
--foreman-proxy-dns-reverse <em>2.0.192.in-addr.arpa</em> \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-interface <em>eth0</em> \
--foreman-proxy-dhcp-additional-interfaces <em>eth1</em> \
--foreman-proxy-dhcp-additional-interfaces <em>eth2</em> \
--foreman-proxy-dhcp-range "<em>192.0.2.100</em> <em>192.0.2.150</em>" \
--foreman-proxy-dhcp-gateway <em>192.0.2.1</em> \
--foreman-proxy-dhcp-nameservers <em>192.0.2.2</em> \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true \
--foreman-proxy-tftp-servername <em>192.0.2.3</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about configuring DHCP, DNS, and TFTP services, see the <a href="https://docs.theforeman.org/2.5/Provisioning_Guide/index-foreman-el.html#Configuring_Networking-Configuring_Network_Services_for_PXE_Boot">Configuring Network Services</a> section in the <em>Provisioning Guide</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="capsule-server-scalability-considerations_smart-proxy">Appendix A: Smart&#160;Proxy&#160;server Scalability Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The maximum number of Smart&#160;Proxy&#160;servers that Foreman&#160;server can support has no fixed limit.
The tested limit is 17 Smart&#160;Proxy&#160;servers with 2 vCPUs on a Foreman&#160;server with Red Hat Enterprise Linux 7.
However, scalability is highly variable, especially when managing Puppet clients.</p>
</div>
<div class="paragraph">
<p>Smart&#160;Proxy&#160;server scalability when managing Puppet clients depends on the number of CPUs, the run-interval distribution, and the number of Puppet managed resources.
Smart&#160;Proxy&#160;server has a limitation of 100 concurrent Puppet agents running at any single point in time.
Running more than 100 concurrent Puppet agents results in a 503 HTTP error.</p>
</div>
<div class="paragraph">
<p>For example, assuming that Puppet agent runs are evenly distributed with less than 100 concurrent Puppet agents running at any single point during a run-interval, a Smart&#160;Proxy&#160;server with 4 CPUs has a maximum of 1250-1600 Puppet clients with a moderate workload of 10 Puppet classes assigned to each Puppet client.
Depending on the number of Puppet clients required, the Foreman installation can scale out the number of Smart&#160;Proxy&#160;servers to support them.</p>
</div>
<div class="paragraph">
<p>If you want to scale your Smart&#160;Proxy&#160;server when managing Puppet clients, the following assumptions are made:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are no external Puppet clients reporting directly to the Foreman integrated Smart&#160;Proxy.</p>
</li>
<li>
<p>All other Puppet clients report directly to an external Smart&#160;Proxy.</p>
</li>
<li>
<p>There is an evenly distributed run-interval of all Puppet agents.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Deviating from the even distribution increases the risk of overloading Foreman&#160;server.
The limit of 100 concurrent requests applies.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table describes the scalability limits using the recommended 4 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Puppet Scalability Using 4 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000-2500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2400-2000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700-1400</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes the scalability limits using the minimum 2 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Puppet Scalability Using 2 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700-1450</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500-1250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">850-700</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated Dec 2022
</div>
</div>
</body>
</html>