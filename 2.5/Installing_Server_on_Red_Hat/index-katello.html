<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Installing Foreman 2.5 server with Katello 4.1 plugin on Enterprise Linux</title>
<link rel="stylesheet" href="./katello.css">
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Installing Foreman 2.5 server with Katello 4.1 plugin on Enterprise Linux</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preparing-environment-for-satellite-installation">1. Preparing your Environment for Installation</a>
<ul class="sectlevel2">
<li><a href="#system-requirements_foreman">1.1. System Requirements</a></li>
<li><a href="#storage-requirements_foreman">1.2. Storage Requirements</a></li>
<li><a href="#storage-guidelines_foreman">1.3. Storage Guidelines</a></li>
<li><a href="#supported-operating-systems_foreman">1.4. Supported Operating Systems</a></li>
<li><a href="#supported-browsers_foreman">1.5. Supported Browsers</a></li>
<li><a href="#satellite-ports-and-firewalls-requirements_foreman">1.6. Ports and Firewalls Requirements</a></li>
<li><a href="#enabling-client-connections-to-satellite_foreman">1.7. Enabling Connections from a Client to Foreman&#160;server</a></li>
<li><a href="#verifying-firewall-settings_foreman">1.8. Verifying Firewall Settings</a></li>
<li><a href="#verifying-dns-resolution_foreman">1.9. Verifying DNS resolution</a></li>
</ul>
</li>
<li><a href="#preparing-environment-for-installation-in-ipv6-network_foreman">2. Preparing your Environment for Foreman Installation in an IPv6 Network</a>
<ul class="sectlevel2">
<li><a href="#limitations-of-installation-in-an-ipv6-network_foreman">2.1. Limitations of Foreman Installation in an IPv6 Network</a></li>
<li><a href="#requirements-for-installation-in-an-ipv6-network_foreman">2.2. Requirements for Foreman Installation in an IPv6 Network</a></li>
</ul>
</li>
<li><a href="#installing-satellite-server-connected">3. Installing Foreman&#160;server</a>
<ul class="sectlevel2">
<li><a href="#configuring-repositories_foreman">3.1. Configuring Repositories</a></li>
<li><a href="#installing-the-satellite-server-packages_foreman">3.2. Installing Foreman&#160;server Packages</a></li>
<li><a href="#synchronizing-the-system-clock-with-chronyd_foreman">3.3. Synchronizing the System Clock With chronyd</a></li>
<li><a href="#configuring-server_foreman">3.4. Configuring Foreman&#160;server</a></li>
</ul>
</li>
<li><a href="#performing-additional-configuration">4. Performing Additional Configuration on Foreman&#160;server</a>
<ul class="sectlevel2">
<li><a href="#configuring-for-uefi-http-boot-provisioning-in-an-ipv6-network_foreman">4.1. Configuring Foreman for UEFI HTTP Boot Provisioning in an IPv6 Network</a></li>
<li><a href="#configuring-satellite-with-an-http-proxy_foreman">4.2. Configuring Foreman&#160;server with an HTTP Proxy</a></li>
<li><a href="#enabling-power-management-on-managed-hosts_foreman">4.3. Enabling Power Management on Managed Hosts</a></li>
<li><a href="#configuring-dns-dhcp-and-tftp_foreman">4.4. Configuring DNS, DHCP, and TFTP on Foreman&#160;server</a></li>
<li><a href="#disabling-dns-dhcp-tftp-for-unmanaged-networks_foreman">4.5. Disabling DNS, DHCP, and TFTP for Unmanaged Networks</a></li>
<li><a href="#configuring-satellite-for-outgoing-emails_foreman">4.6. Configuring Foreman&#160;server for Outgoing Emails</a></li>
<li><a href="#configuring-an-alternate-cname_foreman">4.7. Configuring an Alternate CNAME for Foreman</a></li>
<li><a href="#configuring-satellite-custom-server-certificate_foreman">4.8. Configuring Foreman&#160;server with a Custom SSL Certificate</a></li>
<li><a href="#using-external-databases_foreman">4.9. Using External Databases with Foreman</a></li>
<li><a href="#tuning-with-predefined-profiles_foreman">4.10. Tuning Foreman&#160;server with Predefined Profiles</a></li>
</ul>
</li>
<li><a href="#configuring-external-services">5. Configuring Foreman&#160;server with External Services</a>
<ul class="sectlevel2">
<li><a href="#configuring-external-dns_foreman">5.1. Configuring Foreman&#160;server with External DNS</a></li>
<li><a href="#configuring-external-dhcp_foreman">5.2. Configuring Foreman&#160;server with External DHCP</a></li>
<li><a href="#configuring-external-tftp_foreman">5.3. Configuring Foreman&#160;server with External TFTP</a></li>
<li><a href="#configuring-external-idm-dns_foreman">5.4. Configuring Foreman&#160;server with External IdM DNS</a></li>
</ul>
</li>
<li><a href="#applying-custom-configuration_foreman">Appendix A: Applying Custom Configuration to Foreman</a></li>
<li><a href="#restoring-manual-changes-overwritten-by-a-puppet-run_foreman">Appendix B: Restoring Manual Changes Overwritten by a Puppet Run</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preparing-environment-for-satellite-installation">1. Preparing your Environment for Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install Foreman, ensure that your environment meets the following requirements.</p>
</div>
<div class="sect2">
<h3 id="system-requirements_foreman">1.1. System Requirements</h3>
<div class="paragraph">
<p>The following requirements apply to the networked base operating system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x86_64 architecture</p>
</li>
<li>
<p>4-core 2.0 GHz CPU at a minimum</p>
</li>
<li>
<p>A minimum of 20 GB RAM is required for Foreman&#160;server to function.
In addition, a minimum of 4 GB RAM of swap space is also recommended.
Foreman running with less RAM than the minimum value might not operate correctly.</p>
</li>
<li>
<p>A unique host name, which can contain lower-case letters, numbers, dots (.) and hyphens (-)</p>
</li>
<li>
<p>Administrative user (root) access</p>
</li>
<li>
<p>A system umask of 0022</p>
</li>
<li>
<p>Full forward and reverse DNS resolution using a fully-qualified domain name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Foreman only supports <code>UTF-8</code> encoding.
If your territory is USA and your language is English, set <code>en_US.utf-8</code> as the system-wide locale settings.
For more information about configuring system locale in Enterprise Linux, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/assembly_changing-basic-environment-settings_configuring-basic-system-settings#proc_configuring-the-system-locale_assembly_changing-basic-environment-settings">Configuring System Locale guide</a>.
Before you install Foreman&#160;server, ensure that your environment meets the requirements for installation.</p>
</div>
<div class="paragraph">
<p>Foreman&#160;server must be installed on a freshly provisioned system that serves no other function except to run Foreman&#160;server.
The freshly provisioned system must not have the following users provided by external identity providers to avoid conflicts with the local users that Foreman&#160;server creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>apache</p>
</li>
<li>
<p>foreman</p>
</li>
<li>
<p>foreman-proxy</p>
</li>
<li>
<p>postgres</p>
</li>
<li>
<p>pulp</p>
</li>
<li>
<p>puppet</p>
</li>
<li>
<p>puppetserver</p>
</li>
<li>
<p>qdrouterd</p>
</li>
<li>
<p>qpidd</p>
</li>
<li>
<p>redis</p>
</li>
<li>
<p>tomcat</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">SELinux Mode</div>
<p>SELinux must be enabled, either in enforcing or permissive mode.
Installation with disabled SELinux is not supported.</p>
</div>
<div class="paragraph">
<div class="title">FIPS Mode</div>
<p>You can install Foreman on a Red&#160;Hat Enterprise Linux system that is operating in FIPS mode.
You cannot enable FIPS mode after the installation of Foreman.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/chap-federal_standards_and_regulations#sec-Enabling-FIPS-Mode">Enabling FIPS Mode</a> in the <em>Red&#160;Hat Enterprise Linux Security Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="storage-requirements_foreman">1.2. Storage Requirements</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#storage-centos-7">CentOS 7</a></p>
</li>
<li>
<p><a href="#storage-centos-8">CentOS 8</a></p>
</li>
<li>
<p><a href="#storage-rhel-7">Red Hat Enterprise Linux 7</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table details storage requirements for specific directories.
These values are based on expected use case scenarios and can vary according to individual environments.</p>
</div>
<div class="paragraph">
<p>The runtime size was measured with Red&#160;Hat Enterprise Linux 6, 7, and 8 repositories synchronized.</p>
</div>
<div class="sect3">
<h4 id="_centos_7">1.2.1. <a id="storage-centos-7"></a>CentOS 7</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Storage Requirements for a Foreman&#160;server Installation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Installation Size</th>
<th class="tableblock halign-left valign-top">Runtime Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/opt/rh/rh-postgresql12/lib/pgsql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/puppetlabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pulp/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300Â GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/qpidd/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_centos_8">1.2.2. <a id="storage-centos-8"></a>CentOS 8</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Storage Requirements for a Foreman&#160;server Installation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Installation Size</th>
<th class="tableblock halign-left valign-top">Runtime Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pgsql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/puppetlabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pulp/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300Â GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/qpidd/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_red_hat_enterprise_linux_7">1.2.3. <a id="storage-rhel-7"></a>Red Hat Enterprise Linux 7</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Storage Requirements for a Foreman&#160;server Installation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Installation Size</th>
<th class="tableblock halign-left valign-top">Runtime Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/opt/rh/rh-postgresql12/lib/pgsql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/puppetlabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pulp/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Â MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300Â GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/qpidd/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="storage-guidelines_foreman">1.3. Storage Guidelines</h3>
<div class="paragraph">
<p>Consider the following guidelines when installing Foreman&#160;server to increase efficiency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you mount the <code>/tmp</code> directory as a separate file system, you must use the <code>exec</code> mount option in the <code>/etc/fstab</code> file.
If <code>/tmp</code> is already mounted with the <code>noexec</code> option, you must change the option to <code>exec</code> and re-mount the file system.
This is a requirement for the <code>puppetserver</code> service to work.</p>
</li>
<li>
<p>Because most Foreman&#160;server data is stored in the <code>/var</code> directory, mounting <code>/var</code> on LVM storage can help the system to scale.</p>
</li>
<li>
<p>The <code>/var/lib/qpidd/</code> directory uses slightly more than 2 MB per Content Host managed by the <code>goferd</code> service.
For example, 10 000 Content Hosts require 20 GB of disk space in <code>/var/lib/qpidd/</code>.</p>
</li>
<li>
<p>Use high-bandwidth, low-latency storage for the <code>/var/lib/pulp/</code> directories.
As Foreman has many operations that are I/O intensive, using high latency, low-bandwidth storage causes performance degradation.
Ensure your installation has a speed in the range 60 - 80 Megabytes per second.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">File System Guidelines</div>
<ul>
<li>
<p>Do not use the GFS2 file system as the input-output latency is too high.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Log File Storage</div>
<p>Log files are written to <code>/var/log/messages/,</code> <code>/var/log/httpd/</code>, and <code>/var/lib/foreman-proxy/openscap/content/</code>.
You can manage the size of these files using <strong>logrotate</strong>.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-viewing_and_managing_log_files#s2-log_rotation">Log Rotation</a> in the <em>Red Hat Enterprise Linux 7 System Administratorâs Guide</em>.</p>
</div>
<div class="paragraph">
<p>The exact amount of storage you require for log messages depends on your installation and setup.</p>
</div>
<div class="paragraph">
<div class="title">SELinux Considerations for NFS Mount</div>
<p>When the <code>/var/lib/pulp</code> directory is mounted using an NFS share, SELinux blocks the synchronization process.
To avoid this, specify the SELinux context of the <code>/var/lib/pulp</code> directory in the file system table by adding the following lines to <code>/etc/fstab</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nfs.example.com:/nfsshare  /var/lib/pulp  nfs  context="system_u:object_r:var_lib_t:s0"  1 2</pre>
</div>
</div>
<div class="paragraph">
<p>If NFS share is already mounted, remount it using the above configuration and enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># restorecon -R /var/lib/pulp</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Duplicated Packages</div>
<p>Packages that are duplicated in different repositories are only stored once on the disk.
Additional repositories containing duplicate packages require less additional storage.
The bulk of storage resides in the <code>/var/lib/pulp/</code> directory.
These end points are not manually configurable.
Ensure that storage is available on the <code>/var</code> file system to prevent storage problems.</p>
</div>
<div class="paragraph">
<div class="title">Software Collections</div>
<p>Software collections are installed in the <code>/opt/rh/</code> and <code>/opt/theforeman/</code> directories.</p>
</div>
<div class="paragraph">
<p>Write and execute permissions by the root user are required for installation to the <code>/opt</code> directory.</p>
</div>
<div class="paragraph">
<div class="title">Symbolic links</div>
<p>You cannot use symbolic links for <code>/var/lib/pulp/</code>.</p>
</div>
<div class="paragraph">
<div class="title">Synchronized RHEL ISO</div>
<p>If you plan to synchronize RHEL content ISOs to Foreman, note that all minor versions of Red&#160;Hat Enterprise Linux also synchronize.
You must plan to have adequate storage on your Foreman to manage this.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-operating-systems_foreman">1.4. Supported Operating Systems</h3>
<div class="paragraph">
<p>You can install the operating system from a disc, local ISO image, or kickstart.</p>
</div>
<div class="paragraph">
<p>The following operating systems are supported by the installer, have packages, and are tested for deploying Foreman:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Operating Systems supported by foreman-installer</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is not supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Enterprise Linux 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is required.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Before you install Foreman, apply all operating system updates if possible.</p>
</div>
<div class="paragraph">
<p>Install Foreman&#160;server on a freshly provisioned system.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-browsers_foreman">1.5. Supported Browsers</h3>
<div class="paragraph">
<p>The recommended requirements are as follows for major browsers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Google Chrome 54 or higher</p>
</li>
<li>
<p>Microsoft Edge</p>
</li>
<li>
<p>Microsoft Internet Explorer 10 or higher</p>
</li>
<li>
<p>Mozilla Firefox 49 or higher</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other browsers may work unpredictably.</p>
</div>
<div class="paragraph">
<p>The Foreman web UI and command-line interface support English, Portuguese, Simplified Chinese Traditional Chinese, Korean, Japanese, Italian, Spanish, Russian, French, and German.</p>
</div>
</div>
<div class="sect2">
<h3 id="satellite-ports-and-firewalls-requirements_foreman">1.6. Ports and Firewalls Requirements</h3>
<div class="paragraph">
<p>For the components of Foreman architecture to communicate, ensure that the required network ports are open and free on the base operating system.
You must also ensure that the required network ports are open on any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>Use this information to configure any network-based firewalls.
Note that some cloud solutions must be specifically configured to allow communications between machines because they isolate machines similarly to network-based firewalls.
If you use an application-based firewall, ensure that the application-based firewall permits all applications that are listed in the tables and known to your firewall.
If possible, disable the application checking and allow open port communication based on the protocol.</p>
</div>
<div class="paragraph">
<div class="title">Integrated Smart&#160;Proxy</div>
<p>Foreman&#160;server has an integrated Smart&#160;Proxy and any host that is directly connected to Foreman&#160;server is a Client of Foreman in the context of this section.
This includes the base operating system on which Smart&#160;Proxy&#160;server is running.</p>
</div>
<div class="paragraph">
<div class="title">Clients of Smart&#160;Proxy</div>
<p>Hosts which are clients of Smart&#160;Proxies, other than Foreman&#8217;s integrated Smart&#160;Proxy, do not need access to Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>Required ports can change based on your configuration.</p>
</div>
<div class="paragraph">
<p>The following tables indicate the destination port and the direction of network traffic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Foreman&#160;server incoming traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required For</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers and clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name resolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP Server (optional)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Communication from Smart&#160;Proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Retrieval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Retrieval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Host Registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy CA RPM installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Mirroring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart Proxy functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5646</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMQP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Katello agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward message to Qpid dispatch router on Foreman (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5910 - 5930</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browsers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Resource&#8217;s virtual console</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisioning templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template retrieval for client installers, iPXE or UEFI HTTP Boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXE Boot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client updates (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Host registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiation</p>
<p class="tableblock">Uploading facts</p>
<p class="tableblock">Sending installed packages and traces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenSCAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovered Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host discovery and provisioning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy functionality</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any managed host that is directly connected to Foreman&#160;server is a client in this context because it is a client of the integrated Smart&#160;Proxy.
This includes the base operating system on which a Smart&#160;Proxy&#160;server is running.</p>
</div>
<div class="paragraph">
<p>A DHCP Smart&#160;Proxy performs ICMP ping or TCP echo connection attempts to hosts in subnets with DHCP IPAM set to find out if an IP address considered for use is free.
This behavior can be turned off using <code>foreman-installer --foreman-proxy-dhcp-ping-free-ip=false</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Foreman&#160;server outgoing traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required For</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">echo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22, 16514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH SSH/TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman originated communications, for compute resources in libvirt</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers on the Internet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve DNS records (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation of DNS conflicts (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Orchestration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation of DNS conflicts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Sync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote yum repository</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">389, 636</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP, LDAPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External LDAP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP authenticatiion, necessary only if external authentication is enabled.
The port can be customized when <code>LDAPAuthSource</code> is defined</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p>
<p class="tableblock">Configuration management</p>
<p class="tableblock">Template retrieval</p>
<p class="tableblock">OpenSCAP</p>
<p class="tableblock">Remote Execution result upload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon EC2, Azure, Google GCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine interactions (query/create/destroy) (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content mirroring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infoblox DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When using Infoblox for DHCP, management of the DHCP leases (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">623</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BMC On/Off/Cycle/Status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenStack Compute Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine interactions (query/create/destroy) (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5646</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMQP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman&#160;server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Katello agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward message to Qpid dispatch router on Smart&#160;Proxy (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5671</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Qpid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send install command to  client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5671</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dispatch router (hub)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward message to dispatch router on Foreman</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5671</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman&#160;server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote install for Katello agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send install command to client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5671</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman&#160;server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote install for Katello agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward message to dispatch router on Foreman</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5900 - 5930</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hypervisor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">noVNC console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Launch noVNC console</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7911</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP, OMAPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DHCP target is configured using <code>--foreman-proxy-dhcp-server</code> and defaults to localhost</p>
<p class="tableblock">ISC and <code>remote_isc</code> use a configurable port that defaults to 7911 and uses OMAPI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy sends reboot command to the discovered host (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management of Smart&#160;Proxies</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="enabling-client-connections-to-satellite_foreman">1.7. Enabling Connections from a Client to Foreman&#160;server</h3>
<div class="paragraph">
<p>Smart&#160;Proxies and Content Hosts that are clients of a Foreman&#160;server&#8217;s internal Smart&#160;Proxy require access through Foreman&#8217;s host-based firewall and any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>Use this procedure to configure the host-based firewall on the Red Hat Enterprise Linux 7 system that Foreman is installed on, to enable incoming connections from Clients, and to make the configuration persistent across system reboots.
For more information on the ports used, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#satellite-ports-and-firewalls-requirements_foreman">Ports and Firewalls Requirements</a>.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To open the ports for client to Foreman communication, enter the following command on the base operating system that you want to install Foreman on:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd \
--add-port="80/tcp" --add-port="443/tcp" \
--add-port="5647/tcp" --add-port="8000/tcp" \
--add-port="8140/tcp" --add-port="9090/tcp" \
--add-port="53/udp" --add-port="53/tcp" \
--add-port="67/udp" --add-port="69/udp"</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="verifying-firewall-settings_foreman">1.8. Verifying Firewall Settings</h3>
<div class="paragraph">
<p>Use this procedure to verify your changes to the firewall settings.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --list-all</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-using_firewalls#sec-Getting_started_with_firewalld">Getting Started with firewalld</a> in the <em>Red Hat Enterprise Linux 7 Security Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="verifying-dns-resolution_foreman">1.9. Verifying DNS resolution</h3>
<div class="paragraph">
<p>Verify the full forward and reverse DNS resolution using a fully-qualified domain name to prevent issues while installing Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the host name and local host resolve correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ping -c1 localhost
# ping -c1 `hostname -f` # my_system.domain.com</pre>
</div>
</div>
<div class="paragraph">
<p>Successful name resolution results in output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ping -c1 localhost
PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.043 ms

--- localhost ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.043/0.043/0.043/0.000 ms

# ping -c1 `hostname -f`
PING hostname.gateway (XX.XX.XX.XX) 56(84) bytes of data.
64 bytes from hostname.gateway (XX.XX.XX.XX): icmp_seq=1 ttl=64 time=0.019 ms

--- localhost.gateway ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.019/0.019/0.019/0.000 ms</pre>
</div>
</div>
</li>
<li>
<p>To avoid discrepancies with static and transient host names, set all the host names on the system by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hostnamectl set-hostname <em>name</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/networking_guide/index#sec_Configuring_Host_Names_Using_hostnamectl">Configuring Host Names Using hostnamectl</a> in the <em>Red Hat Enterprise Linux 7 Networking Guide</em>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Name resolution is critical to the operation of Foreman.
If Foreman cannot properly resolve its fully qualified domain name, tasks such as content management, subscription management, and provisioning will fail.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-environment-for-installation-in-ipv6-network_foreman">2. Preparing your Environment for Foreman Installation in an IPv6 Network</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can install and use Foreman in an IPv6 network.
Before installing Foreman in an IPv6 network, view the limitations and ensure that you meet the requirements.</p>
</div>
<div class="paragraph">
<p>To provision hosts in an IPv6 network, after installing Foreman, you must also configure Foreman for the UEFI HTTP boot provisioning.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#configuring-for-uefi-http-boot-provisioning-in-an-ipv6-network_foreman">Configuring Foreman for UEFI HTTP Boot Provisioning in an IPv6 Network</a>.</p>
</div>
<div class="sect2">
<h3 id="limitations-of-installation-in-an-ipv6-network_foreman">2.1. Limitations of Foreman Installation in an IPv6 Network</h3>
<div class="paragraph">
<p>Foreman installation in an IPv6 network has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can install Foreman and Smart&#160;Proxies in IPv6-only systems, dual-stack installation is not supported.</p>
</li>
<li>
<p>Although Foreman provisioning templates include IPv6 support for PXE and HTTP (iPXE) provisioning, the only tested and certified provisioning workflow is the UEFI HTTP Boot provisioning.
This limitation only relates to users who plan to use Foreman to provision hosts.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="requirements-for-installation-in-an-ipv6-network_foreman">2.2. Requirements for Foreman Installation in an IPv6 Network</h3>
<div class="paragraph">
<p>Before installing Foreman in an IPv6 network, ensure that you meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you plan to provision hosts from Foreman or Smart&#160;Proxy, you must install Foreman and Smart&#160;Proxies on a system with <code>grub2</code> version 2.05 or higher or system with fixes for HTTP Boot, for example CentOS version 7.9 or 8.3 or higher.
For other operating systems, copy the newest GRUB build to <code>/var/lib/tftpboot/grub2/grubx64.efi</code>.</p>
</li>
<li>
<p>You must deploy an external DHCP IPv6 server as a separate unmanaged service to bootstrap clients into GRUB2, which then configures IPv6 networking either using DHCPv6 or or assigning static IPv6 address.
This is required because the DHCP server in Red&#160;Hat Enterprise Linux (ISC DHCP) does not provide an integration API for managing IPv6 records, therefore the Smart&#160;Proxy DHCP plug-in that provides DHCP management is limited to IPv4 subnets.</p>
</li>
<li>
<p>You must deploy an external IPv4 HTTP proxy server.
This is required because Foreman distributes content only over IPv4 networks, therefore you must use an IPv4 proxy to redirect that content to hosts in your IPv6 network.</p>
<div class="paragraph">
<p>Note that this requirement is for Katello users only.</p>
</div>
</li>
<li>
<p>You must configure Foreman to use this IPv4 HTTP proxy server as the default proxy.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#adding-a-default-http-proxy_foreman">Adding a Default HTTP Proxy to Satellite</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-satellite-server-connected">3. Installing Foreman&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the following procedures to install Foreman&#160;server and perform the initial configuration.</p>
</div>
<div class="paragraph">
<p>Note that the Foreman installation script is based on Puppet, which means that if you run the installation script more than once, it might overwrite any manual configuration changes.
â 
To avoid this and determine which future changes apply, use the <code>--noop</code> argument when you run the installation script.
This argument ensures that no actual changes are made.
Potential changes are written to <code>/var/log/foreman-installer/foreman.log</code>.</p>
</div>
<div class="paragraph">
<p>Files are always backed up and so you can revert any unwanted changes.
For example, in the foreman-installer logs, you can see an entry similar to the following about Filebucket:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/Stage[main]/Dhcp/File[/etc/dhcp/dhcpd.conf]: Filebucketed /etc/dhcp/dhcpd.conf to puppet with sum 622d9820b8e764ab124367c68f5fa3a1</pre>
</div>
</div>
<div class="paragraph">
<p>You can restore the previous file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># puppet filebucket -l \
restore /etc/dhcp/dhcpd.conf 622d9820b8e764ab124367c68f5fa3a1</pre>
</div>
</div>
<div class="sect2">
<h3 id="configuring-repositories_foreman">3.1. Configuring Repositories</h3>
<div class="paragraph">
<p>Use this procedure to enable the repositories that are required to install Foreman&#160;server. Choose from the available list which operating system and version you are installing on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#repositories-centos-7">CentOS 7</a></p>
</li>
<li>
<p><a href="#repositories-centos-8">CentOS 8</a></p>
</li>
<li>
<p><a href="#repositories-rhel-7">Red Hat Enterprise Linux 7</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_centos_7_2">3.1.1. <a id="repositories-centos-7"></a>CentOS 7</h4>
<div id="configuring-repositories-el-7-yum" class="olist arabic">
<ol class="arabic">
<li>
<p>Clear any metadata:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum clean all</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>foreman-release.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall https://yum.theforeman.org/releases/2.5/el7/x86_64/foreman-release.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>katello-repos-latest.rpm</code> package</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall https://yum.theforeman.org/katello/4.1/katello/el7/x86_64/katello-repos-latest.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>puppet6-release-el-7.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall https://yum.puppet.com/puppet6-release-el-7.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>epel-release</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install epel-release</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>centos-release-scl-rh</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install centos-release-scl-rh</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_centos_8_2">3.1.2. <a id="repositories-centos-8"></a>CentOS 8</h4>
<div id="configuring-repositories-el-8-dnf" class="olist arabic">
<ol class="arabic">
<li>
<p>Clear any metadata:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf clean all</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>foreman-release.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf localinstall https://yum.theforeman.org/releases/2.5/el8/x86_64/foreman-release.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>katello-repos-latest.rpm</code> package</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf localinstall https://yum.theforeman.org/katello/4.1/katello/el8/x86_64/katello-repos-latest.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>centos-release-ansible-29</code> package to enable repositories for dependencies of the Ansible collection support:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install centos-release-ansible-29</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>puppet6-release-el-8.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf localinstall https://yum.puppet.com/puppet6-release-el-8.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Enable Ruby 2.7 module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module reset ruby
# dnf module enable ruby:2.7</pre>
</div>
</div>
</li>
<li>
<p>Enable <code>powertools</code> repository:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf config-manager --set-enabled powertools</pre>
</div>
</div>
</li>
<li>
<p>Enable the PostgreSQL 12 module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable postgresql:12</pre>
</div>
</div>
</li>
<li>
<p>If the PostgreSQL 10 module has already been enabled, a module reset will need to be performed.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module reset postgresql
# dnf module enable postgresql:12</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_red_hat_enterprise_linux_7_2">3.1.3. <a id="repositories-rhel-7"></a>Red Hat Enterprise Linux 7</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable all repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --disable "*"</pre>
</div>
</div>
</li>
<li>
<p>Enable the following repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-7-server-rpms \
--enable rhel-7-server-optional-rpms \
--enable rhel-server-rhscl-7-rpms</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>epel-release-latest-7.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Clear any metadata:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum clean all</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>foreman-release.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall https://yum.theforeman.org/releases/2.5/el7/x86_64/foreman-release.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>katello-repos-latest.rpm</code> package</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall https://yum.theforeman.org/katello/4.1/katello/el7/x86_64/katello-repos-latest.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>puppet6-release-el-7.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall https://yum.puppet.com/puppet6-release-el-7.noarch.rpm</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are installing Foreman&#160;server as a virtual machine hosted on oVirt, you must also enable the <strong>Red&#160;Hat Common</strong> repository, and install oVirt guest agents and drivers.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html/virtual_machine_management_guide/installing_guest_agents_and_drivers_linux#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">Installing the Guest Agents and Drivers on Red Hat Enterprise Linux</a> in the <em>Virtual Machine Management Guide</em> for more information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installing-the-satellite-server-packages_foreman">3.2. Installing Foreman&#160;server Packages</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#centos-7">CentOS 7</a></p>
</li>
<li>
<p><a href="#centos-8">CentOS 8</a></p>
</li>
<li>
<p><a href="#rhel-7">Red Hat Enterprise Linux 7</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_centos_7_3">3.2.1. <a id="centos-7"></a>CentOS 7</h4>
<div id="configuring-foreman-repositories-el-yum-centos7" class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
</li>
<li>
<p>Install <code>foreman-installer-katello</code></p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install foreman-installer-katello</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_centos_8_3">3.2.2. <a id="centos-8"></a>CentOS 8</h4>
<div id="configuring-foreman-repositories-el-dnf-centos8" class="olist arabic">
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf update</pre>
</div>
</div>
</li>
<li>
<p>Install <code>foreman-installer-katello</code></p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install foreman-installer-katello</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_red_hat_enterprise_linux_7_3">3.2.3. <a id="rhel-7"></a>Red Hat Enterprise Linux 7</h4>
<div id="configuring-foreman-repositories-el-yum-rhel7" class="olist arabic">
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
</li>
<li>
<p>Install <code>foreman-installer-katello</code></p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install foreman-installer-katello</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-the-system-clock-with-chronyd_foreman">3.3. Synchronizing the System Clock With chronyd</h3>
<div class="paragraph">
<p>To minimize the effects of time drift, you must synchronize the system clock on the base operating system on which you want to install Foreman&#160;server with Network Time Protocol (NTP) servers.
If the base operating system clock is configured incorrectly, certificate verification might fail.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>chrony</code> suite, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-configuring_ntp_using_the_chrony_suite">Configuring NTP Using the chrony Suite</a> in the <em>Red Hat Enterprise Linux 7 System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>chrony</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install chrony</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the <code>chronyd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start chronyd
# systemctl enable chronyd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server_foreman">3.4. Configuring Foreman&#160;server</h3>
<div class="paragraph">
<p>Install Foreman&#160;server using the <code>foreman-installer</code> installation script.</p>
</div>
<div class="paragraph">
<p>This method is performed by running the installation script with one or more command options.
The command options override the corresponding default initial configuration options and are recorded in the Foreman answer file.
You can run the script as often as needed to configure any necessary options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Depending on the options that you use when running the Foreman installer, the configuration can take several minutes to complete.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-satellite-manually_foreman">3.4.1. Configuring Foreman</h4>
<div class="paragraph">
<p>This initial configuration procedure creates an organization, location, user name, and password.
After the initial configuration, you can create additional organizations and locations if required.
The initial configuration also installs PostgreSQL databases on the same server.</p>
</div>
<div class="paragraph">
<p>The installation process can take tens of minutes to complete.
If you are connecting remotely to the system, use a utility that allows suspending and reattaching a communication session so that you can check the installation progress in case you become disconnected from the remote system.
For example, on Red Hat-based operating systems, use a utility such as <code>tmux</code> or <code>screen</code>.
If you lose connection to the shell where the installation command is running, see the log at <code>/var/log/foreman-installer/foreman.log</code> to determine if the process completed successfully.</p>
</div>
<div class="ulist">
<div class="title">Considerations</div>
<ul>
<li>
<p>Use the <code>foreman-installer --scenario katello --help</code> command to display the available options and any default values.
If you do not specify any values, the default values are used.</p>
</li>
<li>
<p>Specify a meaningful value for the option: <code>--foreman-initial-organization</code>.
This can be your company name.
An internal label that matches the value is also created and cannot be changed afterwards.
If you do not specify a value, an organization called <strong>Default Organization</strong> with the label <strong>Default_Organization</strong> is created.
You can rename the organization name but not the label.</p>
</li>
<li>
<p>Remote Execution is the primary method of managing packages on Content Hosts. If you want to use the deprecated Katello Agent instead of Remote Execution SSH, use the <code>--foreman-proxy-content-enable-katello-agent=true</code> option to enable it. The same option should be given on any Smart&#160;Proxy&#160;server as well as Foreman&#160;server.</p>
</li>
<li>
<p>By default, all configuration files configured by the installer are managed by Puppet.
When <code>foreman-installer</code> runs, it overwrites any manual changes to the Puppet managed files with the initial values.
By default, Foreman&#160;server is installed with the Puppet agent running as a service.
If required, you can disable Puppet agent on Foreman&#160;server using the <code>--puppet-runmode=none</code> option.</p>
</li>
<li>
<p>If you want to manage DNS files and DHCP files manually, use the <code>--foreman-proxy-dns-managed=false</code> and <code>--foreman-proxy-dhcp-managed=false</code> options so that Puppet does not manage the files related to the respective services.
For more information on how to apply custom configuration on other services, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#applying-custom-configuration_foreman">Applying Custom Configuration to Foreman</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command with any additional options that you want to use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario katello \
--foreman-initial-organization "<em>initial_organization_name</em>" \
--foreman-initial-location "<em>initial_location_name</em>" \
--foreman-initial-admin-username <em>admin_user_name</em> \
--foreman-initial-admin-password <em>admin_password</em></pre>
</div>
</div>
<div class="paragraph">
<p>The script displays its progress and writes logs to <code>/var/log/foreman-installer/foreman-installer --scenario katello.log</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performing-additional-configuration">4. Performing Additional Configuration on Foreman&#160;server</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuring-for-uefi-http-boot-provisioning-in-an-ipv6-network_foreman">4.1. Configuring Foreman for UEFI HTTP Boot Provisioning in an IPv6 Network</h3>
<div class="paragraph">
<p>Use this procedure to configure Foreman to provision hosts in an IPv6 network with UEFI HTTP Boot provisioning.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your clients can access DHCP and HTTP servers.</p>
</li>
<li>
<p>Ensure that the UDP ports 67 and 68 are accessible by clients so clients can send DHCP requests and receive DHCP offers.</p>
</li>
<li>
<p>Ensure that the TCP port 8000 is open for clients to download files and Kickstart templates from Foreman and Smart&#160;Proxies.</p>
</li>
<li>
<p>Ensure that the host provisioning interface subnet has an HTTP Boot Smart&#160;Proxy, and Templates Smart&#160;Proxy set.
For more information, see <a href="https://docs.theforeman.org/2.5/Provisioning_Guide/index-foreman-el.html#Configuring_Networking-Adding_a_Subnet_to_the_Satellite_Server">Adding a Subnet to Foreman&#160;server</a> in the <em>Provisioning Guide</em>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and ensure that the <strong>Token duration</strong> setting is not set to <strong>0</strong>.
Foreman cannot identify clients that are booting from the network by a remote IPv6 address because of unmanaged DHCPv6 service, therefore provisioning tokens must be enabled.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>You must disable DHCP management in the installer or not use it.</p>
</li>
<li>
<p>For all IPv6 subnets created in Foreman, set the <strong>DHCP Smart&#160;Proxy</strong> to blank.</p>
</li>
<li>
<p>Optional: If the host and the DHCP server are separated by a router, configure the DHCP relay agent and point to the DHCP server.</p>
</li>
<li>
<p>On Foreman or Smart&#160;Proxy from which you provision, update the <code>grub2-efi</code> package to the latest version:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install grub2-efi</pre>
</div>
</div>
</li>
<li>
<p>Synchronize the Red&#160;Hat Enterprise Linux 8 kickstart repository.</p>
<div class="paragraph">
<p>Note that this step is for Katello users only.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-satellite-with-an-http-proxy_foreman">4.2. Configuring Foreman&#160;server with an HTTP Proxy</h3>
<div class="paragraph">
<p>Use the following procedures to configure Foreman with an HTTP proxy.</p>
</div>
<div class="sect3">
<h4 id="adding-a-default-http-proxy_foreman">4.2.1. Adding a Default HTTP Proxy to Foreman</h4>
<div class="paragraph">
<p>If your network uses an HTTP Proxy, you can configure Foreman&#160;server to use an HTTP proxy for requests to the Red&#160;Hat Content Delivery Network (CDN) or another content source.
Use the FQDN instead of the IP address where possible to avoid losing connectivity because of network changes.</p>
</div>
<div class="paragraph">
<p>The following procedure configures a proxy only for downloading content for Foreman.
To use the CLI instead of the web UI, see the <a href="#cli-adding-a-default-http-proxy_foreman">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>HTTP Proxies</strong>.</p>
</li>
<li>
<p>Click <strong>New HTTP Proxy</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name for the HTTP proxy.</p>
</li>
<li>
<p>In the <strong>Url</strong> field, enter the URL of the HTTP proxy in the following format: <code>\https://<em>proxy.example.com</em>:8080</code>.</p>
</li>
<li>
<p>Optional: If authentication is required, in the <strong>Username</strong> field, enter the username to authenticate with.</p>
</li>
<li>
<p>Optional: If authentication is required, in the <strong>Password</strong> field, enter the password to authenticate with.</p>
</li>
<li>
<p>To test connection to the proxy, click the <strong>Test Connection</strong> button.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Content</strong> tab.</p>
</li>
<li>
<p>Set the <strong>Default HTTP Proxy</strong> setting to the created HTTP proxy.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-default-http-proxy_foreman" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Verify that the <code>http_proxy</code>, <code>https_proxy</code>, and <code>no_proxy</code> variables are not set.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># unset http_proxy
# unset https_proxy
# unset no_proxy</pre>
</div>
</div>
</li>
<li>
<p>Add an HTTP proxy entry to Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer http-proxy create --name=<em>myproxy</em> \
--url http://<em>myproxy.example.com</em>:8080  \
--username=<em>proxy_username</em> \
--password=<em>proxy_password</em></pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use this HTTP proxy by default:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name=content_default_http_proxy --value=<em>myproxy</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-selinux-to-ensure-access-on-custom-ports_foreman">4.2.2. Configuring SELinux to Ensure Access to Foreman on Custom Ports</h4>
<div class="paragraph">
<p>SELinux ensures access of Foreman only to specific ports.
In the case of the HTTP cache, the TCP ports are 8080, 8118, 8123, and 10001 - 10010.
If you use a port that does not have SELinux type <code>http_cache_port_t</code>, complete the following steps.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman, to verify the ports that are permitted by SELinux for the HTTP cache, enter a command as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># semanage port -l | grep http_cache
http_cache_port_t       tcp    8080, 8118, 8123, 10001-10010
<em>[output truncated]</em></pre>
</div>
</div>
</li>
<li>
<p>To configure SELinux to permit a port for the HTTP cache, for example 8088, enter a command as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># semanage port -a -t http_cache_port_t -p tcp 8088</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="using-an-http-proxy-for-all-http-requests_foreman">4.2.3. Using an HTTP Proxy for all Foreman HTTP Requests</h4>
<div class="paragraph">
<p>If your Foreman&#160;server must remain behind a firewall that blocks HTTP and HTTPS, you can configure a proxy for communication with external systems, including compute resources.</p>
</div>
<div class="paragraph">
<p>Note that if you are using compute resources for provisioning, and you want to use a different HTTP proxy with the compute resources, the proxy that you set for all Foreman communication takes precedence over the proxies that you set for compute resources.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>In the <strong>HTTP(S) proxy</strong> row, select the adjacent <strong>Value</strong> column and enter the proxy URL.</p>
</li>
<li>
<p>Click the tick icon to save your changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name=http_proxy --value=<em>Proxy_URL</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="excluding-hosts-from-receiving-proxied-requests_foreman">4.2.4. Excluding Hosts from Receiving Proxied Requests</h4>
<div class="paragraph">
<p>If you use an HTTP Proxy for all Foreman HTTP or HTTPS requests, you can prevent certain hosts from communicating through the proxy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>In the <strong>HTTP(S) proxy except hosts</strong> row, select the adjacent <strong>Value</strong> column and enter the names of one or more hosts that you want to exclude from proxy requests.</p>
</li>
<li>
<p>Click the tick icon to save your changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name=http_proxy_except_list --value=[<em>hostname1.hostname2...</em>]</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-proxy-for-pxe-files_foreman">4.2.5. Configuring a proxy for PXE files downloads</h4>
<div class="paragraph">
<p>For Red Hat content served through the Content Delivery Network, Smart&#160;Proxy downloads PXE files from synchronized repositories.
However, when configuring and installing an operating system using Installation Media, Smart&#160;Proxy connects directly using the <code>wget</code> utility.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Smart&#160;Proxy with the TFTP feature, to verify the ports that are permitted by SELinux for the HTTP cache, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl edit foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Insert the following test into the editor:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[Service]
Environment="http_proxy=http://proxy.example.com:8888"
Environment="https_proxy=https://proxy.example.com:8888"</pre>
</div>
</div>
</li>
<li>
<p>Save the file.
Verify that the file appears as <code>/etc/systemd/system/foreman-proxy.service.d/overrides.conf</code>.</p>
</li>
<li>
<p>Restart the <code>foreman-proxy</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Create a host or enter build mode for an existing host to re-download PXE files to the TFTP Smart&#160;Proxy.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="resetting-the-http-proxy_foreman">4.2.6. Resetting the HTTP Proxy</h4>
<div class="paragraph">
<p>If you want to reset the current HTTP proxy setting, unset the <strong>Default HTTP Proxy</strong> setting.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Content</strong> tab.</p>
</li>
<li>
<p>Set the <strong>Default HTTP Proxy</strong> setting to <strong>no global default</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Set the <code>content_default_http_proxy</code> setting to an empty string:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name=content_default_http_proxy --value=""</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-power-management-on-managed-hosts_foreman">4.3. Enabling Power Management on Managed Hosts</h3>
<div class="paragraph">
<p>To perform power management tasks on managed hosts using the intelligent platform management interface (IPMI) or a similar protocol, you must enable the baseboard management controller (BMC) module on Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All managed hosts must have a network interface of BMC type.
Foreman&#160;server uses this NIC to pass the appropriate credentials to the host.
For more information, see <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#adding-a-bmc-interface">Adding a Baseboard Management Controller (BMC) Interface</a> in <em>Managing Hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable BMC, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-bmc "true" \
--foreman-proxy-bmc-default-provider "freeipmi"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-dns-dhcp-and-tftp_foreman">4.4. Configuring DNS, DHCP, and TFTP on Foreman&#160;server</h3>
<div class="paragraph">
<p>To configure the DNS, DHCP, and TFTP services on Foreman&#160;server, use the <code>foreman-installer</code> command with the options appropriate for your environment.
To view a complete list of configurable options, enter the <code>foreman-installer --scenario katello --help</code> command.</p>
</div>
<div class="paragraph">
<p>Any changes to the settings require entering the <code>foreman-installer</code> command again.
You can enter the command multiple times and each time it updates all configuration files with the changed values.</p>
</div>
<div class="paragraph">
<p>To use external DNS, DHCP, and TFTP services instead, see <a href="#configuring-external-services">Configuring Foreman&#160;server with External Services</a>.</p>
</div>
<div class="paragraph">
<div class="title">Adding Multihomed DHCP details</div>
<p>If you want to use Multihomed DHCP, you must inform the installer.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the following information is available to you:</p>
<div class="ulist">
<ul>
<li>
<p>DHCP IP address ranges</p>
</li>
<li>
<p>DHCP gateway IP address</p>
</li>
<li>
<p>DHCP nameserver IP address</p>
</li>
<li>
<p>DNS information</p>
</li>
<li>
<p>TFTP server name</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use the FQDN instead of the IP address where possible in case of network changes.</p>
</li>
<li>
<p>Contact your network administrator to ensure that you have the correct settings.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the <code>foreman-installer</code> command with the options appropriate for your environment.
The following example shows configuring full provisioning services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario katello \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-interface <em>eth0</em> \
--foreman-proxy-dns-zone <em>example.com</em> \
--foreman-proxy-dns-reverse <em>2.0.192.in-addr.arpa</em> \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-interface <em>eth0</em> \
--foreman-proxy-dhcp-additional-interfaces <em>eth1</em> \
--foreman-proxy-dhcp-additional-interfaces <em>eth2</em> \
--foreman-proxy-dhcp-range "<em>192.0.2.100</em> <em>192.0.2.150</em>" \
--foreman-proxy-dhcp-gateway <em>192.0.2.1</em> \
--foreman-proxy-dhcp-nameservers <em>192.0.2.2</em> \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true \
--foreman-proxy-tftp-servername <em>192.0.2.3</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can monitor the progress of the <code>foreman-installer</code> command displayed in your prompt.
You can view the logs in <code>/var/log/foreman-installer/foreman.log</code>.
You can view the settings used, including the <code>initial_admin_password</code> parameter, in the <code>/etc/foreman-installer/scenarios.d/foreman-answers.yaml</code> file.</p>
</div>
<div class="paragraph">
<p>For more information about configuring DHCP, DNS, and TFTP services, see the <a href="https://docs.theforeman.org/2.5/Provisioning_Guide/index-foreman-el.html#Configuring_Networking-Configuring_Network_Services_for_PXE_Boot">Configuring Network Services</a> section in the <em>Provisioning Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="disabling-dns-dhcp-tftp-for-unmanaged-networks_foreman">4.5. Disabling DNS, DHCP, and TFTP for Unmanaged Networks</h3>
<div class="paragraph">
<p>If you want to manage TFTP, DHCP, and DNS services manually, you must prevent Foreman from maintaining these services on the operating system and disable orchestration to avoid DHCP and DNS validation errors.
However, Foreman does not remove the back-end services on the operating system.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dhcp false \
--foreman-proxy-dns false \
--foreman-proxy-tftp false</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select a subnet.</p>
</li>
<li>
<p>Click the <strong>Smart&#160;Proxies</strong> tab and clear the <strong>DHCP Smart&#160;Proxy</strong>, <strong>TFTP Smart&#160;Proxy</strong>, and <strong>Reverse DNS Smart&#160;Proxy</strong> fields.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and select a domain.</p>
</li>
<li>
<p>Clear the <strong>DNS Smart&#160;Proxy</strong> field.</p>
</li>
<li>
<p>Optional: If you use a DHCP service supplied by a third party, configure your DHCP server to pass the following options:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Option 66: <em>IP address of Foreman or Smart&#160;Proxy</em>
Option 67: /pxelinux.0</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about DHCP options, see <a href="https://tools.ietf.org/html/rfc2132">RFC 2132</a>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Foreman does not perform orchestration when a Smart&#160;Proxy is not set for a given subnet and domain.
When enabling or disabling Smart&#160;Proxy associations, orchestration commands for existing hosts can fail if the expected records and configuration files are not present.
When associating a Smart&#160;Proxy to turn orchestration on, make sure the required DHCP and DNS records as well as the TFTP files are in place for the existing Foreman hosts in order to prevent host deletion failures in the future.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-satellite-for-outgoing-emails_foreman">4.6. Configuring Foreman&#160;server for Outgoing Emails</h3>
<div class="paragraph">
<p>To send email messages from Foreman&#160;server, you can use either an SMTP server, or the <code>sendmail</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Some SMTP servers with anti-spam protection or grey-listing features are known to cause problems. To setup outgoing email with such a service either install and configure a vanilla SMTP service on Foreman&#160;server for relay or use the <code>sendmail</code> command instead.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &#8594; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click the <strong>Email</strong> tab and set the configuration options to match your preferred delivery method.
The changes have an immediate effect.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The following example shows the configuration options for using an SMTP server:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Using an SMTP server as a delivery method</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivery method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>smtp.example.com</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP HELO/EHLO domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>example.com</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user@example.com</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>SMTP username</code> and <code>SMTP password</code> specify the login credentials for the SMTP server.</p>
</div>
</li>
<li>
<p>The following example uses <strong>gmail.com</strong> as an SMTP server:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Using gmail.com as an SMTP server</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivery method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp.gmail.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">plain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP HELO/EHLO domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp.gmail.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP enable StartTLS auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">587</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user</em>@gmail.com</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>The following example uses the <code>sendmail</code> command as a delivery method:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Using sendmail as a delivery method</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivery method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sendmail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sendmail arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-i -t -G</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>Sendmail arguments</code> specify the options passed to the <code>sendmail</code> command.
The default value is <code>-i -t</code>.
For more information see the <strong>sendmail 1</strong> man page.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you decide to send email using an SMTP server which uses TLS authentication, also perform one of the following steps:</p>
<div class="ulist">
<ul>
<li>
<p>Mark the CA certificate of the SMTP server as trusted.
To do so, execute the following commands on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp mailca.crt /etc/pki/ca-trust/source/anchors/
# update-ca-trust enable
# update-ca-trust</pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>mailca.crt</em></code> is the CA certificate of the SMTP server.</p>
</div>
</li>
<li>
<p>Alternatively, in the web UI, set the <code>SMTP enable StartTLS auto</code> option to <code>No</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Test email</strong> to send a test message to the user&#8217;s email address to confirm the configuration is working.
If a message fails to send, the web UI displays an error.
See the log at <code>/var/log/foreman/production.log</code> for further details.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For information on configuring email notifications for individual users or user groups, see <a href="https://docs.theforeman.org/2.5/Administering_Red_Hat_Satellite/index-foreman-el.html#configuring-email-notifications_admin">Configuring Email Notifications</a> in <em>Administering Foreman</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-an-alternate-cname_foreman">4.7. Configuring an Alternate CNAME for Foreman</h3>
<div class="paragraph">
<p>You can configure an alternate CNAME for Foreman.
This might be useful if you want to deploy the Foreman web interface on a different domain name than the one that is used by client systems to connect to Foreman.
You must plan the alternate CNAME configuration in advance prior to installing Smart&#160;Proxies and registering hosts to Foreman to avoid redeploying new certificates to hosts.</p>
</div>
<div class="paragraph">
<p>This procedure is only for Katello plug-in users.</p>
</div>
<div class="sect3">
<h4 id="configuring-project-with-an-alternate-cname_foreman">4.7.1. Configuring Foreman with an Alternate CNAME</h4>
<div class="paragraph">
<p>Use this procedure to configure Foreman with an alternate CNAME.
Note that the procedures for users of a default Foreman certificate and custom certificate differ.</p>
</div>
<div class="ulist">
<div class="title">For Default Foreman Certificate Users</div>
<ul>
<li>
<p>If you have installed Foreman with a default Foreman certificate and want to configure Foreman with an alternate CNAME, enter the following command on Foreman to generate a new default Foreman SSL certificate with an additional CNAME.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --certs-cname <em>alternate_fqdn</em> --certs-update-server</pre>
</div>
</div>
</li>
<li>
<p>If you have not installed Foreman, you can add the <code>--certs-cname <em>alternate_fqdn</em></code> option to the <code>foreman-installer</code> command to install Foreman with an alternate CNAME.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">For Custom Certificate Users</div>
<p>If you use Foreman with a custom certificate, when creating a custom certificate, include the alternate CNAME records to the custom certificate.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#creating-a-custom-certificate_foreman">Creating a Custom SSL Certificate for Foreman Server</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hosts-to-use-an-alternate-cname-for-content-management_foreman">4.7.2. Configuring Hosts to Use an Alternate Foreman CNAME for Content Management</h4>
<div class="paragraph">
<p>If Foreman is configured with an alternate CNAME, you can configure hosts to use the alternate Foreman CNAME for content management.
To do this, you must point hosts to the alternate Foreman CNAME prior to registering the hosts to Foreman.
You can do this using the bootstrap script or manually.</p>
</div>
<div class="paragraph">
<div class="title">Configuring Hosts with the bootstrap Script</div>
<p>On the host, run the bootstrap script with the <code>--server <em>alternate_fqdn.example.com</em></code> option to register the host to the alternate Foreman CNAME:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ./bootstrap.py --server <em>alternate_fqdn.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Configuring Hosts Manually</div>
<p>On the host, edit the <code>/etc/rhsm/rhsm.conf</code> file to update <code>hostname</code> and <code>baseurl</code> settings to point to the alternate host name, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[server]
# Server hostname:
hostname = <em>alternate_fqdn.example.com</em>

<em>content omitted</em>

[rhsm]
# Content base URL:
baseurl=https://<em>alternate_fqdn.example.com</em>/pulp/content/</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can register the host with the <code>subscription-manager</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-satellite-custom-server-certificate_foreman">4.8. Configuring Foreman&#160;server with a Custom SSL Certificate</h3>
<div class="paragraph">
<p>This procedure is only for Katello plug-in users.</p>
</div>
<div class="paragraph">
<p>By default, Foreman uses a self-signed SSL certificate to enable encrypted communications between Foreman&#160;server, external Smart&#160;Proxy&#160;servers, and all hosts.
If you cannot use a Foreman self-signed certificate, you can configure Foreman&#160;server to use an SSL certificate signed by an external Certificate Authority.</p>
</div>
<div class="paragraph">
<p>To configure your Foreman&#160;server with a custom certificate, complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-custom-certificate_foreman">Creating a Custom SSL Certificate for Foreman&#160;server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-satellite-server_foreman">Deploying a Custom SSL Certificate to Foreman&#160;server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-hosts_foreman">Deploying a Custom SSL Certificate to Hosts</a></p>
</li>
<li>
<p>If you have external Smart&#160;Proxy&#160;servers registered to Foreman&#160;server, you must configure them with custom SSL certificates.
The same Certificate Authority must sign certificates for Foreman&#160;server and Smart&#160;Proxy&#160;server.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Proxy_on_Red_Hat/index-foreman-el.html#configuring-capsule-custom-server-certificate_smart-proxy">Configuring Smart&#160;Proxy&#160;server with a Custom SSL Certificate</a> in <em>Installing Smart&#160;Proxy&#160;server</em>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="creating-a-custom-certificate_foreman">4.8.1. Creating a Custom SSL Certificate for Foreman&#160;server</h4>
<div class="paragraph">
<p>Use this procedure to create a custom SSL certificate for Foreman&#160;server.
If you already have a custom SSL certificate for Foreman&#160;server, skip this procedure.</p>
</div>
<div class="paragraph">
<p>When you configure Foreman&#160;server with custom certificates, note the following considerations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must use the Privacy-Enhanced Mail (PEM) encoding for the SSL certificates.</p>
</li>
<li>
<p>You cannot use the same certificate for both Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
</li>
<li>
<p>The same Certificate Authority must sign certificates for Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/foreman_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the Certificate Signing Request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted.
If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this Foreman&#160;server, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/foreman_cert/foreman_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/foreman_cert/openssl.cnf</code> configuration file for the Certificate Signing Request (CSR) and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
x509_extensions = usr_cert
prompt = no

[ req_distinguished_name ] <b class="conum">(1)</b>
C  = <em>Country Name (2 letter code)</em>
ST = <em>State or Province Name (full name)</em>
L  = <em>Locality Name (eg, city)</em>
O  = <em>Organization Name (eg, company)</em>
OU = <em>The division of your organization handling the certificate</em>
CN = <em>foreman.example.com</em> <b class="conum">(2)</b>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
subjectAltName = @alt_names

[ usr_cert ]
basicConstraints=CA:FALSE
nsCertType = client, server, email
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
nsComment = "OpenSSL Generated Certificate"
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

[ alt_names ]
DNS.1 = <em>foreman.example.com</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In the <code>[ req_distinguished_name ]</code> section, enter information about your organization.</p>
</li>
<li>
<p>Set the certificate&#8217;s Common Name <code>CN</code> to match the fully qualified domain name (FQDN) of your Foreman&#160;server.
To confirm a FQDN, on that Foreman&#160;server, enter the <code>hostname -f</code> command.
This is required to ensure that the <code>katello-certs-check</code> command validates the certificate correctly.</p>
</li>
<li>
<p>Set the Subject Alternative Name (SAN) <code>DNS.1</code> to match the fully qualified domain name (FQDN) of your server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the Certificate Signing Request (CSR):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/foreman_cert/foreman_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/foreman_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/foreman_cert/foreman_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key.</p>
</li>
<li>
<p>Path to the configuration file.</p>
</li>
<li>
<p>Path to the CSR to generate.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the Certificate Authority.
The same Certificate Authority must sign certificates for Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate.
The method for sending the certificate request varies, so consult the Certificate Authority for the preferred method.
In response to the request, you can expect to receive a Certificate Authority bundle and a signed certificate, in separate files.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-a-custom-ssl-certificate-to-satellite-server_foreman">4.8.2. Deploying a Custom SSL Certificate to Foreman&#160;server</h4>
<div class="paragraph">
<p>Use this procedure to configure your Foreman&#160;server to use a custom SSL certificate signed by a Certificate Authority.
The <code>katello-certs-check</code> command validates the input certificate files and returns the commands necessary to deploy a custom SSL certificate to Foreman&#160;server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Validate the custom SSL certificate input files.
Note that for the <code>katello-certs-check</code> command to work correctly, Common Name (CN) in the certificate must match the FQDN of Foreman&#160;server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-certs-check \
-c <em>/root/satellite_cert/satellite_cert.pem</em> \      <b class="conum">(1)</b>
-k <em>/root/satellite_cert/satellite_cert_key.pem</em> \  <b class="conum">(2)</b>
-b <em>/root/satellite_cert/ca_cert_bundle.pem</em>        <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to Foreman&#160;server certificate file that is signed by a Certificate Authority.</p>
</li>
<li>
<p>Path to the private key that was used to sign Foreman&#160;server certificate.</p>
</li>
<li>
<p>Path to the Certificate Authority bundle.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the command is successful, it returns two <code>foreman-installer</code> commands, one of which you must use to deploy a certificate to Foreman&#160;server.</p>
</div>
<div class="listingblock">
<div class="title">To install the Katello main server with the custom certificates, run:</div>
<div class="content">
<pre class="nowrap">  foreman-installer --scenario katello \\
    --certs-server-cert "<em>/root/satellite_cert/satellite_cert.pem</em>" \
    --certs-server-key "<em>/root/satellite_cert/satellite_cert_key.pem</em>" \
    --certs-server-ca-cert "<em>/root/satellite_cert/ca_cert_bundle.pem</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">To update the certificates on a currently running Katello installation, run:</div>
<div class="content">
<pre class="nowrap">  foreman-installer --scenario katello \\
    --certs-server-cert "_/root/satellite_cert/satellite_cert.pem_" \
    --certs-server-key "_/root/satellite_cert/satellite_cert_key.pem_" \
    --certs-server-ca-cert "_/root/satellite_cert/ca_cert_bundle.pem_" \
    --certs-update-server --certs-update-server-ca</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Depending on your requirements, enter the <code>foreman-installer</code> command that installs a new Foreman&#160;server with custom SSL certificates or updates certificates on a currently running Foreman&#160;server.
The output of the <code>katello-certs-check</code> command may not be accurate in some cases.
Therefore, you must follow the steps mentioned above instead of the command outputs.</p>
<div class="paragraph">
<p>If you are unsure which command to run, you can verify that Foreman is installed by checking if the file <code>/etc/foreman-installer/scenarios.d/.installed</code> exists.
If the file exists, run the second <code>foreman-installer</code> command that updates certificates.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate.
It is required, for example, when upgrading Foreman&#160;server.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>On a computer with network access to Foreman&#160;server, navigate to the following URL: <code>\https://<em>foreman.example.com</em></code>.</p>
</li>
<li>
<p>In your browser, view the certificate details to verify the deployed certificate.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-a-custom-ssl-certificate-to-hosts_foreman">4.8.3. Deploying a Custom SSL Certificate to Hosts</h4>
<div class="paragraph">
<p>After you configure Foreman&#160;server to use a custom SSL certificate, you must also install the <code>katello-ca-consumer</code> package on every host that is registered to this Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On each host, install the <code>katello-ca-consumer</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall \
http://<em>foreman.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-external-databases_foreman">4.9. Using External Databases with Foreman</h3>
<div class="paragraph">
<p>For Red Hat systems only.</p>
</div>
<div class="paragraph">
<p>As part of the installation process for Foreman, the <strong>foreman-installer</strong> command installs PostgreSQL databases on the same server as Foreman.
In certain Foreman deployments, using external databases instead of the default local databases can help with the server load.</p>
</div>
<div class="paragraph">
<p>To create and use external databases for Foreman, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#preparing-a-host-for-external-databases_foreman">Preparing a Host for External Databases</a>.
Prepare a Red&#160;Hat Enterprise Linux 7 server to host the external databases.</p>
</li>
<li>
<p><a href="#installing-postgresql_foreman">Installing PostgreSQL</a>.
Prepare PostgreSQL with databases for Foreman, Candlepin and Pulp with dedicated users owning them.</p>
</li>
<li>
<p><a href="#configuring-satellite-to-use-external-databases_foreman">Configuring Satellite to use External Databases</a>.
Edit the parameters of <code>foreman-installer</code> to point to the new databases, and run <code>foreman-installer</code>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="postgresql-as-an-external-database-considerations_foreman">4.9.1. PostgreSQL as an External Database Considerations</h4>
<div class="paragraph">
<p>Foreman, Katello, and Candlepin use the PostgreSQL database.
If you want to use PostgreSQL as an external database, the following information can help you decide if this option is right for your Foreman configuration.
Foreman supports PostgreSQL version 12.1.</p>
</div>
<div class="ulist">
<div class="title">Advantages of External PostgreSQL:</div>
<ul>
<li>
<p>Increase in free memory and free CPU on Foreman</p>
</li>
<li>
<p>Flexibility to set <code>shared_buffers</code> on the PostgreSQL database to a high number without the risk of interfering with other services on Foreman</p>
</li>
<li>
<p>Flexibility to tune the PostgreSQL server&#8217;s system without adversely affecting Foreman operations</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Disadvantages of External PostgreSQL</div>
<ul>
<li>
<p>Increase in deployment complexity that can make troubleshooting more difficult</p>
</li>
<li>
<p>The external PostgreSQL server is an additional system to patch and maintain</p>
</li>
<li>
<p>If either Foreman or the PostgreSQL database server suffers a hardware or storage failure, Foreman is not operational</p>
</li>
<li>
<p>If there is latency between the Foreman server and database server, performance can suffer</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="preparing-a-host-for-external-databases_foreman">4.9.2. Preparing a Host for External Databases</h4>
<div class="paragraph">
<p>Install a freshly provisioned system with the latest Red&#160;Hat Enterprise Linux 7 server to host the external databases.</p>
</div>
<div class="paragraph">
<p>Subscriptions for Red&#160;Hat Software Collections and Red&#160;Hat Enterprise Linux do not provide the correct service level agreement for using Foreman with external databases.
You must also attach a Foreman subscription to the base operating system that you want to use for the external databases.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Red&#160;Hat Enterprise Linux 7 server must meet Foreman&#8217;s <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#storage-requirements_foreman">Storage Requirements</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use the instructions in <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#attaching-satellite-infrastructure-subscription_foreman">Attaching the Foreman Infrastructure Subscription</a> to attach a Foreman subscription to your server.</p>
</li>
<li>
<p>Disable all repositories and enable only the following repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --disable '*'
# subscription-manager repos --enable=rhel-server-rhscl-7-rpms \
--enable=rhel-7-server-rpms --enable=rhel-7-server-satellite-6.10-rpms</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="installing-postgresql_foreman">4.9.3. Installing PostgreSQL</h4>
<div class="paragraph">
<p>You can install only the same version of PostgreSQL that is installed with the <code>foreman-installer</code> tool during an internal database installation.
You can install PostgreSQL using Red Hat Enterprise Linux Server 7 repositories or from an external source, as long as the version is supported.
Foreman supports PostgreSQL version 12.1.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To install PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># yum install rh-postgresql12-postgresql-server \
rh-postgresql12-syspaths \
rh-postgresql12-postgresql-evr</pre>
</div>
</div>
</li>
<li>
<p>To initialize PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgresql-setup initdb</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</pre>
</div>
</div>
</li>
<li>
<p>Remove the <code>#</code> and edit to listen to inbound connections:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">listen_addresses = '*'</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</pre>
</div>
</div>
</li>
<li>
<p>Add the following line to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  host  all   all   <em>Foreman_ip</em>/24   md5</pre>
</div>
</div>
</li>
<li>
<p>To start, and enable PostgreSQL service, enter the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start postgresql
# systemctl enable postgresql</pre>
</div>
</div>
</li>
<li>
<p>Open the <strong>postgresql</strong> port on the external PostgreSQL server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service=postgresql
# firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>Switch to the <code>postgres</code> user and start the PostgreSQL client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ su - postgres -c psql</pre>
</div>
</div>
</li>
<li>
<p>Create three databases and dedicated roles: one for Foreman, one for Candlepin, and one for Pulp:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">CREATE USER "foreman" WITH PASSWORD '<em>Foreman_Password</em>';
CREATE USER "candlepin" WITH PASSWORD '<em>Candlepin_Password</em>';
CREATE USER "pulp" WITH PASSWORD '<em>Pulpcore_Password</em>';
CREATE DATABASE foreman OWNER foreman;
CREATE DATABASE candlepin OWNER candlepin;
CREATE DATABASE pulpcore OWNER pulp;</pre>
</div>
</div>
</li>
<li>
<p>Exit the <code>postgres</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># \q</pre>
</div>
</div>
</li>
<li>
<p>From Foreman&#160;server, test that you can access the database.
If the connection succeeds, the commands return <code>1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># PGPASSWORD='<em>Foreman_Password</em>' psql -h <em>postgres.example.com</em>  -p 5432 -U foreman -d foreman -c "SELECT 1 as ping"
# PGPASSWORD='<em>Candlepin_Password</em>' psql -h <em>postgres.example.com</em> -p 5432 -U candlepin -d candlepin -c "SELECT 1 as ping"
# PGPASSWORD='<em>Pulpcore_Password</em>' psql -h <em>postgres.example.com</em> -p 5432 -U pulp -d pulpcore -c "SELECT 1 as ping"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-satellite-to-use-external-databases_foreman">4.9.4. Configuring Satellite to use External Databases</h4>
<div class="paragraph">
<p>Use the <code>foreman-installer</code> command to configure Foreman to connect to an external PostgreSQL database.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed and configured a PostgreSQL database on a Red&#160;Hat Enterprise Linux server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To configure the external databases for Foreman, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer --scenario katello \
  --foreman-db-host <em>postgres.example.com</em> \
  --foreman-db-password <em>Foreman_Password</em> \
  --foreman-db-database foreman \
  --foreman-db-manage false \
  --katello-candlepin-db-host <em>postgres.example.com</em> \
  --katello-candlepin-db-name candlepin \
  --katello-candlepin-db-password <em>Candlepin_Password</em> \
  --katello-candlepin-manage-db false \
  --foreman-proxy-content-pulpcore-manage-postgresql false \
  --foreman-proxy-content-pulpcore-postgresql-host <em>postgres.example.com</em> \
  --foreman-proxy-content-pulpcore-postgresql-db-name pulpcore \
  --foreman-proxy-content-pulpcore-postgresql-password <em>Pulpcore_Password</em>
  --foreman-proxy-content-pulpcore-postgresql-user pulp</pre>
</div>
</div>
<div class="paragraph">
<p>To enable the Secure Sockets Layer (SSL) protocol for these external databases, add the following options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--foreman-db-sslmode verify-full
--foreman-db-root-cert &lt;path_to_CA&gt;
--katello-candlepin-db-ssl true
--katello-candlepin-db-ssl-verify true
--foreman-proxy-content-pulpcore-postgresql-ssl true
--foreman-proxy-content-pulpcore-postgresql-ssl-root-ca &lt;path_to_CA&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tuning-with-predefined-profiles_foreman">4.10. Tuning Foreman&#160;server with Predefined Profiles</h3>
<div class="paragraph">
<p>If your Foreman deployment includes more than 5000 hosts, you can use predefined tuning profiles to improve performance of Foreman.</p>
</div>
<div class="paragraph">
<p>Note that you cannot use tuning profiles on Smart&#160;Proxies.</p>
</div>
<div class="paragraph">
<p>You can choose one of the profiles depending on the number of hosts your Foreman manages and available hardware resources.</p>
</div>
<div class="paragraph">
<p>The tuning profiles are available in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes</code> directory.</p>
</div>
<div class="paragraph">
<p>When you run the <code>foreman-installer</code> command with the <code>--tuning</code> option, deployment configuration settings are applied to Foreman in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The default tuning profile defined in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code> file</p>
</li>
<li>
<p>The tuning profile that you want to apply to your deployment and is defined in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes/</code> directory</p>
</li>
<li>
<p>Optional: If you have configured a <code>/etc/foreman-installer/custom-hiera.yaml</code> file, Foreman applies these configuration settings.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the configuration settings that are defined in the <code>/etc/foreman-installer/custom-hiera.yaml</code> file override the configuration settings that are defined in the tuning profiles.</p>
</div>
<div class="paragraph">
<p>Therefore, before applying a tuning profile, you must compare the configuration settings that are defined in the default tuning profile in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code>, the tuning profile that you want to apply and your <code>/etc/foreman-installer/custom-hiera.yaml</code> file, and remove any duplicated configuration from the <code>/etc/foreman-installer/custom-hiera.yaml</code> file.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">default</dt>
<dd>
<p>Number of managed hosts: 0-5000</p>
<div class="paragraph">
<p>RAM: 20G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 4</p>
</div>
</dd>
<dt class="hdlist1">medium</dt>
<dd>
<p>Number of managed hosts: 5001-10000</p>
<div class="paragraph">
<p>RAM: 32G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 8</p>
</div>
</dd>
<dt class="hdlist1">large</dt>
<dd>
<p>Number of managed hosts: 10001-20000</p>
<div class="paragraph">
<p>RAM: 64G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 16</p>
</div>
</dd>
<dt class="hdlist1">extra-large</dt>
<dd>
<p>Number of managed hosts: 20001-60000</p>
<div class="paragraph">
<p>RAM: 128G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 32</p>
</div>
</dd>
<dt class="hdlist1">extra-extra-large</dt>
<dd>
<p>Number of managed hosts: 60000+</p>
<div class="paragraph">
<p>RAM: 256G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 48+</p>
</div>
</dd>
</dl>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: If you have configured the <code>custom-hiera.yaml</code> file on Foreman&#160;server, back up the <code>/etc/foreman-installer/custom-hiera.yaml</code> file to <code>custom-hiera.original</code>.
You can use the backup file to restore the <code>/etc/foreman-installer/custom-hiera.yaml</code> file to its original state if it becomes corrupted:</p>
<div class="listingblock">
<div class="content">
<pre># cp /etc/foreman-installer/custom-hiera.yaml \
/etc/foreman-installer/custom-hiera.original</pre>
</div>
</div>
</li>
<li>
<p>Optional: If you have configured the <code>custom-hiera.yaml</code> file on Foreman&#160;server, review the definitions of the default tuning profile in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code> and the tuning profile that you want to apply in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes/</code>.
Compare the configuration entries against the entries in your <code>/etc/foreman-installer/custom-hiera.yaml</code> file and remove any duplicated configuration settings in your <code>/etc/foreman-installer/custom-hiera.yaml</code> file.</p>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command with the <code>--tuning</code> option for the profile that you want to apply.
For example, to apply the medium tuning profile settings, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --tuning medium</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-external-services">5. Configuring Foreman&#160;server with External Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you do not want to configure the DNS, DHCP, and TFTP services on Foreman&#160;server, use this section to configure your Foreman&#160;server to work with external DNS, DHCP and TFTP services.</p>
</div>
<div class="sect2">
<h3 id="configuring-external-dns_foreman">5.1. Configuring Foreman&#160;server with External DNS</h3>
<div class="paragraph">
<p>You can configure Foreman&#160;server with external DNS.
Foreman&#160;server uses the <code>nsupdate</code> utility to update DNS records on the remote server.</p>
</div>
<div class="paragraph">
<p>To make any changes persistent, you must enter the <code>foreman-installer</code> command with the options appropriate for your environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a configured external DNS server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Unlock packages to enable installation of new packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain packages unlock</pre>
</div>
</div>
</li>
<li>
<p>Install BIND and the utility packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install bind bind-utils</pre>
</div>
</div>
</li>
<li>
<p>Lock the packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain packages lock</pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the external DNS server to Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp root@<em>dns.example.com</em>:/etc/rndc.key /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Configure the ownership, permissions, and SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/rndc.key
# chown -v root:named /etc/rndc.key
# chmod -v 640 /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To test the <code>nsupdate</code> utility, add a host remotely:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server <em>DNS_IP_Address</em>\n \
update add aaa.virtual.lan 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/rndc.key
# nslookup aaa.virtual.lan <em>DNS_IP_Address</em>
# echo -e "server <em>DNS_IP_Address</em>\n \
update delete aaa.virtual.lan 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.
Normally, foreman-installer ensures that the <code>foreman-proxy</code> user belongs to the <code>named</code> UNIX group, however, in this scenario Foreman does not manage users and groups, therefore you need to assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G named foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dns.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dns=true \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>DNS_IP_Address</em>" \
--foreman-proxy-keyfile=/etc/rndc.key \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
<li>
<p>Restart the foreman-proxy service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Log in to Foreman&#160;server web UI.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>, locate the Foreman&#160;server, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Associate the DNS service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-dhcp_foreman">5.2. Configuring Foreman&#160;server with External DHCP</h3>
<div class="paragraph">
<p>To configure Foreman&#160;server with external DHCP, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#configuring-an-external-dhcp-server_foreman">Configuring an External DHCP Server to Use with Foreman&#160;server</a></p>
</li>
<li>
<p><a href="#configuring-satellite-deployment-with-an-external-dhcp-server_foreman">Configuring Foreman&#160;server with an External DHCP Server</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="configuring-an-external-dhcp-server_foreman">5.2.1. Configuring an External DHCP Server to Use with Foreman&#160;server</h4>
<div class="paragraph">
<p>To configure an external DHCP server to use with Foreman&#160;server, on a Red&#160;Hat Enterprise Linux server, you must install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) packages.
You must also share the DHCP configuration and lease files with Foreman&#160;server.
The example in this procedure uses the distributed Network File System (NFS) protocol to share the DHCP configuration and lease files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you use dnsmasq as an external DHCP server, enable the <code>dhcp-no-override</code> setting.
This is required because Foreman creates configuration files on the TFTP server under the <code>grub2/</code> subdirectory.
If the <code>dhcp-no-override</code> setting is disabled, clients fetch the bootloader and its configuration from the root directory, which might cause an error.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On a Red&#160;Hat Enterprise Linux Server server, install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install dhcp bind</pre>
</div>
</div>
</li>
<li>
<p>Generate a security token:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnssec-keygen -a HMAC-MD5 -b 512 -n HOST omapi_key</pre>
</div>
</div>
<div class="paragraph">
<p>As a result, a key pair that consists of two files is created in the current directory.</p>
</div>
</li>
<li>
<p>Copy the secret hash from the key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat Komapi_key.+*.private |grep ^Key|cut -d ' ' -f2</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>dhcpd</code> configuration file for all of the subnets and add the key.
The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/dhcp/dhcpd.conf
default-lease-time 604800;
max-lease-time 2592000;
log-facility local7;

subnet <em>192.168.38.0</em> netmask <em>255.255.255.0</em> {
	range <em>192.168.38.10 192.168.38.100</em>;
	option routers <em>192.168.38.1</em>;
	option subnet-mask <em>255.255.255.0</em>;
	option domain-search "<em>virtual.lan</em>";
	option domain-name "<em>virtual.lan</em>";
	option domain-name-servers <em>8.8.8.8</em>;
}

omapi-port 7911;
key omapi_key {
	algorithm HMAC-MD5;
	secret "jNSE5YI3H1A8Oj/tkV4...A2ZOHb6zv315CkNAY7DMYYCj48Umw==";
};
omapi-key omapi_key;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>option routers</code> value is the Foreman or Smart&#160;Proxy IP address that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>Delete the two key files from the directory that they were created in.</p>
</li>
<li>
<p>On Foreman&#160;server, define each subnet.
Do not set DHCP Smart&#160;Proxy for the defined Subnet yet.</p>
<div class="paragraph">
<p>To prevent conflicts, set up the lease and reservation ranges separately.
For example, if the lease range is 192.168.38.10 to 192.168.38.100, in the Foreman web UI define the reservation range as 192.168.38.101 to 192.168.38.250.</p>
</div>
</li>
<li>
<p>Configure the firewall for external access to the DHCP server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service dhcp \
&amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, determine the UID and GID of the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id -u foreman
<em>993</em>
# id -g foreman
<em>990</em></pre>
</div>
</div>
</li>
<li>
<p>On the DHCP server, create the <code>foreman</code> user and group with the same IDs as determined in a previous step:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># groupadd -g <em>990</em> foreman
# useradd -u <em>993</em> -g <em>990</em> -s /sbin/nologin foreman</pre>
</div>
</div>
</li>
<li>
<p>To ensure that the configuration files are accessible, restore the read and execute flags:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod o+rx /etc/dhcp/
# chmod o+r /etc/dhcp/dhcpd.conf
# chattr +i /etc/dhcp/ /etc/dhcp/dhcpd.conf</pre>
</div>
</div>
</li>
<li>
<p>Start the DHCP service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Export the DHCP configuration and lease files using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install nfs-utils
# systemctl enable rpcbind nfs-server
# systemctl start rpcbind nfs-server nfs-lock nfs-idmapd</pre>
</div>
</div>
</li>
<li>
<p>Create directories for the DHCP configuration and lease files that you want to export using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /exports/var/lib/dhcpd /exports/etc/dhcp</pre>
</div>
</div>
</li>
<li>
<p>To create mount points for the created directories, add the following line to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/var/lib/dhcpd /exports/var/lib/dhcpd none bind,auto 0 0
/etc/dhcp /exports/etc/dhcp none bind,auto 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Ensure the following lines are present in <code>/etc/exports</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/exports <em>192.168.38.1</em>(rw,async,no_root_squash,fsid=0,no_subtree_check)

/exports/etc/dhcp <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)

/exports/var/lib/dhcpd <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the IP address that you enter is the Foreman or Smart&#160;Proxy IP address that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>Reload the NFS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># exportfs -rva</pre>
</div>
</div>
</li>
<li>
<p>Configure the firewall for the DHCP omapi port 7911:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="7911/tcp" \
&amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>Optional: Configure the firewall for external access to NFS.
Clients are configured using NFSv3.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --zone public --add-service mountd \
&amp;&amp; firewall-cmd --zone public --add-service rpc-bind \
&amp;&amp; firewall-cmd --zone public --add-service nfs \
&amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-satellite-deployment-with-an-external-dhcp-server_foreman">5.2.2. Configuring Foreman&#160;server with an External DHCP Server</h4>
<div class="paragraph">
<p>You can configure Foreman&#160;server with an external DHCP server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that you have configured an external DHCP server and that you have shared the DHCP configuration and lease files with Foreman&#160;server.
For more information, see <a href="#configuring-an-external-dhcp-server_foreman">Configuring an External DHCP Server to Use with Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>nfs-utils</code> utility:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install nfs-utils</pre>
</div>
</div>
</li>
<li>
<p>Create the DHCP directories for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/etc/dhcp /mnt/nfs/var/lib/dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Change the file owner:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman-proxy /mnt/nfs</pre>
</div>
</div>
</li>
<li>
<p>Verify communication with the NFS server and the Remote Procedure Call (RPC) communication paths:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># showmount -e <em>DHCP_Server_FQDN</em>
# rpcinfo -p <em>DHCP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Add the following lines to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>DHCP_Server_FQDN</em>:/exports/etc/dhcp /mnt/nfs/etc/dhcp nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcp_etc_t:s0" 0 0

<em>DHCP_Server_FQDN</em>:/exports/var/lib/dhcpd /mnt/nfs/var/lib/dhcpd nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcpd_state_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems on <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>To verify that the <code>foreman-proxy</code> user can access the files that are shared over the network, display the DHCP configuration and lease files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su foreman-proxy -s /bin/bash
bash-4.2$ cat /mnt/nfs/etc/dhcp/dhcpd.conf
bash-4.2$ cat /mnt/nfs/var/lib/dhcpd/dhcpd.leases
bash-4.2$ exit</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dhcp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dhcp=true \
--foreman-proxy-dhcp-provider=remote_isc \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-config /mnt/nfs/etc/dhcp/dhcpd.conf \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-leases /mnt/nfs/var/lib/dhcpd/dhcpd.leases \
--foreman-proxy-plugin-dhcp-remote-isc-key-name=omapi_key \
--foreman-proxy-plugin-dhcp-remote-isc-key-secret=jNSE5YI3H1A8Oj/tkV4...A2ZOHb6zv315CkNAY7DMYYCj48Umw== \
--foreman-proxy-plugin-dhcp-remote-isc-omapi-port=7911 \
--enable-foreman-proxy-plugin-dhcp-remote-isc \
--foreman-proxy-dhcp-server=<em>DHCP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>foreman-proxy</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Log in to Foreman&#160;server web UI.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>, locate the Foreman&#160;server, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Associate the DHCP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-tftp_foreman">5.3. Configuring Foreman&#160;server with External TFTP</h3>
<div class="paragraph">
<p>You can configure Foreman&#160;server with external TFTP services.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the TFTP directory for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/var/lib/tftpboot</pre>
</div>
</div>
</li>
<li>
<p>In the <code>/etc/fstab</code> file, add the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>TFTP_Server_IP_Address</em>:/exports/var/lib/tftpboot /mnt/nfs/var/lib/tftpboot nfs rw,vers=3,auto,nosharecache,context="system_u:object_r:tftpdir_rw_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/tftp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-tftp=true \
--foreman-proxy-tftp-root /mnt/nfs/var/lib/tftpboot</pre>
</div>
</div>
</li>
<li>
<p>If the TFTP service is running on a different server than the DHCP service, update the <code>tftp_servername</code> setting with the FQDN or IP address of the server that the TFTP service is running on:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-tftp-servername=<em>TFTP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Log in to Foreman&#160;server web UI.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>, locate the Foreman&#160;server, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Associate the TFTP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-idm-dns_foreman">5.4. Configuring Foreman&#160;server with External IdM DNS</h3>
<div class="paragraph">
<p>When Foreman&#160;server adds a DNS record for a host, it first determines which Smart&#160;Proxy is providing DNS for that domain.
It then communicates with the Smart&#160;Proxy that is configured to provide DNS service for your deployment and adds the record.
The hosts are not involved in this process.
Therefore, you must install and configure the IdM client on the Foreman or Smart&#160;Proxy that is currently configured to provide a DNS service for the domain you want to manage using the IdM server.</p>
</div>
<div class="paragraph">
<p>Foreman&#160;server can be configured to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service.
For more information about Red&#160;Hat Identity Management, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/linux_domain_identity_authentication_and_policy_guide/">Linux Domain Identity, Authentication, and Policy Guide</a>.</p>
</div>
<div class="paragraph">
<p>To configure Foreman&#160;server to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service, use one of the following procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_foreman">Configuring Dynamic DNS Update with GSS-TSIG Authentication</a></p>
</li>
<li>
<p><a href="#configuring-dynamic-dns-update-with-tsig-authentication_foreman">Configuring Dynamic DNS Update with TSIG Authentication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To revert to internal DNS service, use the following procedure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#reverting-to-internal-dns-service_foreman">Reverting to Internal DNS Service</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You are not required to use Foreman&#160;server to manage DNS.
When you are using the realm enrollment feature of Foreman, where provisioned hosts are enrolled automatically to IdM, the <code>ipa-client-install</code> script creates DNS records for the client.
Configuring Foreman&#160;server with external IdM DNS and realm enrollment are mutually exclusive.
For more information about configuring realm enrollment, see <a href="https://docs.theforeman.org/2.5/Administering_Red_Hat_Satellite/index-foreman-el.html#sect-Administering-Configuring_External_Authentication-External_Authentication_for_Provisioned_Hosts">External Authentication for Provisioned Hosts</a> in <em>Administering Foreman</em>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-gss-tsig-authentication_foreman">5.4.1. Configuring Dynamic DNS Update with GSS-TSIG Authentication</h4>
<div class="paragraph">
<p>You can configure the IdM server to use the generic security service algorithm for secret key transaction (GSS-TSIG) technology defined in <a href="https://tools.ietf.org/html/rfc3645">RFC3645</a>.
To configure the IdM server to use the GSS-TSIG technology, you must install the IdM client on the Foreman&#160;server base operating system.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/installing-ipa#prereq-ports">Port Requirements</a> in the <em>Linux Domain Identity, Authentication, and Policy Guide</em>.</p>
</li>
<li>
<p>You must contact the IdM server administrator to ensure that you obtain an account on the IdM server with permissions to create zones on the IdM server.</p>
</li>
<li>
<p>You must confirm whether Foreman&#160;server or Smart&#160;Proxy&#160;server is configured to provide DNS service for your deployment.</p>
</li>
<li>
<p>You must configure DNS, DHCP and TFTP services on the base operating system of either the Foreman or Smart&#160;Proxy that is managing the DNS service for your deployment.</p>
</li>
<li>
<p>You must create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#configuring-server_foreman">Configuring Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with GSS-TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Creating a Kerberos Principal on the IdM Server</div>
<ol class="arabic">
<li>
<p>Obtain a Kerberos ticket for the account obtained from the IdM administrator:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>idm_user</em></pre>
</div>
</div>
</li>
<li>
<p>Create a new Kerberos principal for Foreman&#160;server to use to authenticate on the IdM server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa service-add <em>foreman.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Installing and Configuring the IdM Client</div>
<ol class="arabic">
<li>
<p>On the base operating system of either the Foreman or Smart&#160;Proxy that is managing the DNS service for your deployment, install the <code>ipa-client</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the IdM client by running the installation script and following the on-screen prompts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install</pre>
</div>
</div>
</li>
<li>
<p>Obtain a Kerberos ticket:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit admin</pre>
</div>
</div>
</li>
<li>
<p>Remove any preexisting <code>keytab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Obtain the <code>keytab</code> for this system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-getkeytab -p smart-proxy/<em>foreman.example.com@EXAMPLE.COM</em> \
-s <em>idm1.example.com</em> -k /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When adding a keytab to a standby system with the same host name as the original system in service, add the <code>r</code> option to prevent generating new credentials and rendering the credentials on the original system invalid.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For the <code>dns.keytab</code> file, set the group and owner to <code>foreman-proxy</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown foreman-proxy:foreman-proxy /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Optional: To verify that the <code>keytab</code> file is valid, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit -kt /etc/foreman-proxy/dns.keytab \
smart-proxy/<em>foreman.example.com@EXAMPLE.COM</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring DNS Zones in the IdM web UI</div>
<ol class="arabic">
<li>
<p>Create and configure the zone that you want to manage:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Select <strong>Add</strong> and enter the zone name.
For example, <code>example.com</code>.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the Settings tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant smart-proxy/047<em>foreman.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Enable <strong>Allow PTR sync</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create and configure the reverse zone:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Select <strong>Reverse zone IP network</strong> and add the network address in CIDR format to enable reverse lookups.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Settings</strong> tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant smart-proxy\047<em>foreman.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring the Foreman or Smart&#160;Proxy&#160;server that Manages the DNS Service for the Domain</div>
<ol class="arabic">
<li>
<p>Use the <code>foreman-installer</code> command to configure the Foreman or Smart&#160;Proxy that manages the DNS Service for the domain:</p>
<div class="ulist">
<ul>
<li>
<p>On Foreman, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer --scenario katello \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate_gss \
--foreman-proxy-dns-server="<em>idm1.example.com</em>" \
--foreman-proxy-dns-tsig-principal="smart-proxy/<em>foreman.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab \
--foreman-proxy-dns-reverse="55.168.192.in-addr.arpa" \
--foreman-proxy-dns-zone=<em>example.com</em> \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
<li>
<p>On Smart&#160;Proxy, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer --scenario foreman-proxy-content \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate_gss \
--foreman-proxy-dns-server="<em>idm1.example.com</em>" \
--foreman-proxy-dns-tsig-principal="smart-proxy/<em>foreman.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab \
--foreman-proxy-dns-reverse="55.168.192.in-addr.arpa" \
--foreman-proxy-dns-zone=<em>example.com</em> \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the Foreman or Smart&#160;Proxy&#8217;s Proxy Service.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After you run the <code>foreman-installer</code> command to make any changes to your Smart&#160;Proxy configuration, you must update the configuration of each affected Smart&#160;Proxy in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Updating the Configuration in the Foreman web UI</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>, locate the Foreman&#160;server, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and select the domain name.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, ensure <strong>DNS Smart&#160;Proxy</strong> is set to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>None</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using the IdM server.</p>
</li>
<li>
<p>In the <strong>Smart&#160;Proxies</strong> tab, ensure <strong>Reverse DNS Smart&#160;Proxy</strong> is set to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-tsig-authentication_foreman">5.4.2. Configuring Dynamic DNS Update with TSIG Authentication</h4>
<div class="paragraph">
<p>You can configure an IdM server to use the secret key transaction authentication for DNS (TSIG) technology that uses the <code>rndc.key</code> key file for authentication.
The TSIG protocol is defined in <a href="https://tools.ietf.org/html/rfc2845">RFC2845</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/installing-ipa#prereq-ports">Port Requirements</a> in the <em>Linux Domain Identity, Authentication, and Policy Guide</em>.</p>
</li>
<li>
<p>You must obtain <code>root</code> user access on the IdM server.</p>
</li>
<li>
<p>You must confirm whether Foreman&#160;server or Smart&#160;Proxy&#160;server is configured to provide DNS service for your deployment.</p>
</li>
<li>
<p>You must configure DNS, DHCP and TFTP services on the base operating system of either the Foreman or Smart&#160;Proxy that is managing the DNS service for your deployment.</p>
</li>
<li>
<p>You must create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#configuring-server_foreman">Configuring Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Enabling External Updates to the DNS Zone in the IdM Server</div>
<ol class="arabic">
<li>
<p>On the IdM Server, add the following to the top of the <code>/etc/named.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">########################################################################

include "/etc/rndc.key";
controls  {
inet _IdM_Server_IP_Address_ port 953 allow { _Foreman_IP_Address_; } keys { "rndc-key"; };
};
########################################################################</pre>
</div>
</div>
</li>
<li>
<p>Reload the <code>named</code> service to make the changes take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl reload named</pre>
</div>
</div>
</li>
<li>
<p>In the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong> and click the name of the zone.
In the <strong>Settings</strong> tab, apply the following changes:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the following in the <code>BIND update policy</code> box:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant "rndc-key" zonesub ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Update</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the IdM server to the base operating system of your Foreman&#160;server.
Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /etc/rndc.key root@<em>satellite.example.com</em>:/etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To set the correct ownership, permissions, and SELinux context for the <code>rndc.key</code> file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/rndc.key
# chown -v root:named /etc/rndc.key
# chmod -v 640 /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.
Normally, foreman-installer ensures that the <code>foreman-proxy</code> user belongs to the <code>named</code> UNIX group, however, in this scenario Foreman does not manage users and groups, therefore you need to assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G named foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, enter the following <code>foreman-installer</code> command to configure Foreman to use the external DNS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario katello \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>IdM_Server_IP_Address</em>" \
--foreman-proxy-keyfile=/etc/rndc.key \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Testing External Updates to the DNS Zone in the IdM Server</div>
<ol class="arabic">
<li>
<p>Ensure that the key in the <code>/etc/rndc.key</code> file on Foreman&#160;server is the same key file that is used on the IdM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">key "rndc-key" {
        algorithm hmac-md5;
        secret "<em>secret-key</em>==";
};</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, create a test DNS entry for a host.
For example, host <code><em>test.example.com</em></code> with an A record of <code>192.168.25.20</code> on the IdM server at <code>192.168.25.1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update add <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, test the DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1
Server:		192.168.25.1
Address:	192.168.25.1#53

Name:	test.example.com
Address: 192.168.25.20</pre>
</div>
</div>
</li>
<li>
<p>To view the entry in the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.
Click the name of the zone and search for the host by name.</p>
</li>
<li>
<p>If resolved successfully, remove the test DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update delete <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the DNS entry was removed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1</pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>nslookup</code> command fails and returns the <code>SERVFAIL</code> error message if the record was successfully deleted.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="reverting-to-internal-dns-service_foreman">5.4.3. Reverting to Internal DNS Service</h4>
<div class="paragraph">
<p>You can revert to using Foreman&#160;server and Smart&#160;Proxy&#160;server as your DNS providers.
You can use a backup of the answer file that was created before configuring external DNS, or you can create a backup of the answer file.
For more information about answer files, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#configuring-server_foreman">Configuring Foreman&#160;server</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the Foreman or Smart&#160;Proxy&#160;server that you want to configure to manage DNS service for the domain, complete the following steps:</p>
</div>
<div class="ulist">
<div class="title">Configuring Foreman or Smart&#160;Proxy as a DNS Server</div>
<ul>
<li>
<p>If you have created a backup of the answer file before configuring external DNS, restore the answer file and then enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer</pre>
</div>
</div>
</li>
<li>
<p>If you do not have a suitable backup of the answer file, create a backup of the answer file now.
To configure Foreman or Smart&#160;Proxy as DNS server without using an answer file, enter the following <code>foreman-installer</code> command on Foreman and each affected Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="127.0.0.1"  \
--foreman-proxy-dns-tsig-principal="foremanproxy/<em>foreman.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
<div class="paragraph">
<p>For more information,see <a href="https://docs.theforeman.org/2.5/Installing_Proxy_on_Red_Hat/index-foreman-el.html#configuring-dns-dhcp-and-tftp_smart-proxy">Configuring DNS, DHCP, and TFTP on Smart&#160;Proxy&#160;server</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you run the <code>foreman-installer</code> command to make any changes to your Smart&#160;Proxy configuration, you must update the configuration of each affected Smart&#160;Proxy in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Updating the Configuration in the Foreman web UI</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>For each Smart&#160;Proxy that you want to update, from the <strong>Actions</strong> list, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click the domain name that you want to configure.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, set <strong>DNS Smart&#160;Proxy</strong> to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>DHCP</strong> or <strong>Internal DB</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using Foreman or Smart&#160;Proxy.</p>
</li>
<li>
<p>In the <strong>Smart&#160;Proxies</strong> tab, set <strong>Reverse DNS Smart&#160;Proxy</strong> to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applying-custom-configuration_foreman">Appendix A: Applying Custom Configuration to Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you install and configure Foreman for the first time using <code>foreman-installer</code>, you can specify that the DNS and DHCP configuration files are not to be managed by Puppet using the installer flags <code>--foreman-proxy-dns-managed=false</code> and <code>--foreman-proxy-dhcp-managed=false</code>.
If these flags are not specified during the initial installer run, rerunning of the installer overwrites all manual changes, for example, rerun for upgrade purposes.
If changes are overwritten, you must run the restore procedure to restore the manual changes.
For more information, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-katello.html#restoring-manual-changes-overwritten-by-a-puppet-run_foreman">Restoring Manual Changes Overwritten by a Puppet Run</a>.</p>
</div>
<div class="paragraph">
<p>To view all installer flags available for custom  configuration, run <code>foreman-installer --scenario katello --full-help</code>.
Some Puppet classes are not exposed to the Foreman installer.
To manage them manually and prevent the installer from overwriting their values, specify the configuration values by adding entries to configuration file <code>/etc/foreman-installer/custom-hiera.yaml</code>.
This configuration file is in YAML format, consisting of one entry per line in the format of <code>&lt;puppet class&gt;::&lt;parameter name&gt;: &lt;value&gt;</code>.
Configuration values specified in this file persist across installer reruns.</p>
</div>
<div class="paragraph">
<p>Common examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Apache, to set the ServerTokens directive to only return the Product name:</p>
<div class="listingblock">
<div class="content">
<pre>apache::server_tokens: Prod</pre>
</div>
</div>
</li>
<li>
<p>To turn off the Apache server signature entirely:</p>
<div class="listingblock">
<div class="content">
<pre>apache::server_signature: Off</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Puppet modules for the Foreman installer are stored under <code>/usr/share/foreman-installer/modules</code>.
Check the <code>.pp</code> files (for example: <em>moduleName</em>/manifests/<em>example</em>.pp) to look up the classes, parameters, and values.
Alternatively, use the <code>grep</code> command to do keyword searches.</p>
</div>
<div class="paragraph">
<p>Setting some values may have unintended consequences that affect the performance or functionality of Foreman.
Consider the impact of the changes before you apply them, and test the changes in a non-production environment first.
If you do not have a non-production Foreman environment, run the Foreman installer with the <code>--noop</code> and <code>--verbose</code> options.
If your changes cause problems, remove the offending lines from <code>custom-hiera.yaml</code> and rerun the Foreman installer.
If you have any specific questions about whether a particular value is safe to alter, contact Red Hat support.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restoring-manual-changes-overwritten-by-a-puppet-run_foreman">Appendix B: Restoring Manual Changes Overwritten by a Puppet Run</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your manual configuration has been overwritten by a Puppet run, you can restore the files to the previous state.
The following example shows you how to restore a DHCP configuration file overwritten by a Puppet run.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the file you intend to restore.
This allows you to compare the files to check for any mandatory changes required by the upgrade.
This is not common for DNS or DHCP services.</p>
<div class="listingblock">
<div class="content">
<pre># cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.backup</pre>
</div>
</div>
</li>
<li>
<p>Check the log files to note down the md5sum of the overwritten file.
For example:</p>
<div class="listingblock">
<div class="content">
<pre># journalctl -xe
...
/Stage[main]/Dhcp/File[/etc/dhcp/dhcpd.conf]: Filebucketed /etc/dhcp/dhcpd.conf to puppet with sum 622d9820b8e764ab124367c68f5fa3a1
...</pre>
</div>
</div>
</li>
<li>
<p>Restore the overwritten file:</p>
<div class="listingblock">
<div class="content">
<pre># puppet filebucket restore --local --bucket \
/var/lib/puppet/clientbucket /etc/dhcp/dhcpd.conf \ 622d9820b8e764ab124367c68f5fa3a1</pre>
</div>
</div>
</li>
<li>
<p>Compare the backup file and the restored file, and edit the restored file to include any mandatory changes required by the upgrade.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated Apr 2023
</div>
</div>
</body>
</html>