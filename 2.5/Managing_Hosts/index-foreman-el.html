<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Managing Hosts</title>
<link rel="stylesheet" href="./foreman-el.css">
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Managing Hosts</h1>
<div class="details">
<span id="revnumber">version 2.5 (unsupported),</span>
<span id="revdate">published Apr 17 2023</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview-of-hosts-in-satellite">1. Overview of Hosts in Foreman</a></li>
<li><a href="#Administering_Hosts">2. Administering Hosts</a>
<ul class="sectlevel2">
<li><a href="#creating-a-host-in-satellite">2.1. Creating a Host in Foreman</a></li>
<li><a href="#changing-a-module-stream-for-a-host">2.2. Changing a Module Stream for a Host</a></li>
<li><a href="#creating-a-host-group">2.3. Creating a Host Group</a></li>
<li><a href="#creating-a-host-group-for-each-lifecycle-environment">2.4. Creating a Host Group for Each LifeCycle Environment</a></li>
<li><a href="#changing-the-group-of-a-host">2.5. Changing the Group of a Host</a></li>
<li><a href="#changing-the-environment-of-a-host">2.6. Changing the Environment of a Host</a></li>
<li><a href="#changing-the-managed-status-of-a-host">2.7. Changing the Managed Status of a Host</a></li>
<li><a href="#assinging-a-host-to-a-specific-organization">2.8. Assigning a Host to a Specific Organization</a></li>
<li><a href="#assigning-a-host-to-a-specific-location">2.9. Assigning a Host to a Specific Location</a></li>
<li><a href="#removing-a-host-from-satellite">2.10. Removing a Host from Foreman</a></li>
</ul>
</li>
<li><a href="#registering-a-host_managing-hosts">3. Registering a Host to Foreman</a>
<ul class="sectlevel2">
<li><a href="#customizing-the-registration-templates_managing-hosts">3.1. Customizing the Registration Templates</a></li>
<li><a href="#migrating-from-katello-agent-to-remote-execution_managing-hosts">3.2. Migrating from Katello Agent to Remote Execution</a></li>
</ul>
</li>
<li><a href="#Adding_Network_Interfaces">4. Adding Network Interfaces</a>
<ul class="sectlevel2">
<li><a href="#adding-a-physical-interface">4.1. Adding a Physical Interface</a></li>
<li><a href="#adding-a-virtual-interface">4.2. Adding a Virtual Interface</a></li>
<li><a href="#adding-a-bonded-interface">4.3. Adding a Bonded Interface</a></li>
<li><a href="#adding-a-bmc-interface">4.4. Adding a Baseboard Management Controller (BMC) Interface</a></li>
</ul>
</li>
<li><a href="#upgrading-hosts-from-rhel7-to-rhel8_managing-hosts">5. Upgrading Hosts from RHEL 7 to RHEL 8</a></li>
<li><a href="#host_management_and_monitoring_using_red_hat_web_console">6. Host Management and Monitoring Using Cockpit</a>
<ul class="sectlevel2">
<li><a href="#integrating_satellite_with_red_hat_web_console">6.1. Integrating Foreman with Cockpit</a></li>
<li><a href="#managing_and_monitoring_hosts_using_red_hat_web_console">6.2. Managing and Monitoring Hosts Using Cockpit</a></li>
</ul>
</li>
<li><a href="#using_report_templates">7. Using Report Templates to Monitor Hosts</a>
<ul class="sectlevel2">
<li><a href="#chap-Managing_Hosts-Generating_Host_Monitoring_Reports">7.1. Generating Host Monitoring Reports</a></li>
<li><a href="#proc_creating_a_report_template">7.2. Creating a Report Template</a></li>
<li><a href="#exporting_report_templates">7.3. Exporting Report Templates</a></li>
<li><a href="#proc_exporting_report_templates_api">7.4. Exporting Report Templates Using the Foreman API</a></li>
<li><a href="#importing_report_templates">7.5. Importing Report Templates</a></li>
<li><a href="#proc_importing_report_templates_api">7.6. Importing Report Templates Using the Foreman API</a></li>
<li><a href="#con_report_templates_safe_mode">7.7. Report Template Safe Mode</a></li>
</ul>
</li>
<li><a href="#chap-Red_Hat_Satellite-Managing_Hosts-Configuring_Host_Collections">8. Configuring Host Collections</a>
<ul class="sectlevel2">
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Creating_a_Host_Collection">8.1. Creating a Host Collection</a></li>
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Cloning_a_Host_Collection">8.2. Cloning a Host Collection</a></li>
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Removing_a_Host_Collection">8.3. Removing a Host Collection</a></li>
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Adding_a_Host_to_a_Host_Collection">8.4. Adding a Host to a Host Collection</a></li>
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Removing_a_Host_from_a_Host_Collection">8.5. Removing a Host from a Host Collection</a></li>
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Configuring_Host_Collections-Adding_Content_to_a_Host_Collection">8.6. Adding Content to a Host Collection</a></li>
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Removing_Content_from_a_Host_Collection">8.7. Removing Content from a Host Collection</a></li>
<li><a href="#sect-Red_Hat_Satellite-Managing_Hosts-Changing_the_Life_Cycle_Environment_or_Content_View_of_a_Host_Collection">8.8. Changing the Life Cycle Environment or Content View of a Host Collection</a></li>
</ul>
</li>
<li><a href="#configuring-and-setting-up-remote-jobs_managing-hosts">9. Configuring and Setting up Remote Jobs</a>
<ul class="sectlevel2">
<li><a href="#about-running-jobs-on-hosts_managing-hosts">9.1. About Running Jobs on Hosts</a></li>
<li><a href="#remote-execution-workflow_managing-hosts">9.2. Remote Execution Workflow</a></li>
<li><a href="#permissions-for-remote-execution_managing-hosts">9.3. Permissions for Remote Execution</a></li>
<li><a href="#creating-a-job-template_managing-hosts">9.4. Creating a Job Template</a></li>
<li><a href="#configuring-the-fallback-to-any-smartproxy-setting_managing-hosts">9.5. Configuring the Fallback to Any Smart&#160;Proxy Remote Execution Setting in Foreman</a></li>
<li><a href="#configuring-the-global-smartproxy-remote-execution-setting_managing-hosts">9.6. Configuring the Global Smart&#160;Proxy Remote Execution Setting in Foreman</a></li>
<li><a href="#configuring-an-alternative-directory-to-execute-remote-jobs-on-hosts_managing-hosts">9.7. Configuring Foreman to Use an Alternative Directory to Execute Remote Jobs on Hosts</a></li>
<li><a href="#ssh-keys-for-remote-execution-overview_managing-hosts">9.8. Distributing SSH Keys for Remote Execution</a></li>
<li><a href="#distributing-ssh-keys-for-remote-execution-manually_managing-hosts">9.9. Distributing SSH Keys for Remote Execution Manually</a></li>
<li><a href="#using-the-api-to-obtain-ssh-keys-for-remote-execution_managing-hosts">9.10. Using the Foreman API to Obtain SSH Keys for Remote Execution</a></li>
<li><a href="#configuring-a-kickstart-template-to-distribute-ssh-keys-during-provisioning_managing-hosts">9.11. Configuring a Kickstart Template to Distribute SSH Keys during Provisioning</a></li>
<li><a href="#configuring-a-keytab-for-kerberos-ticket-granting-tickets_managing-hosts">9.12. Configuring a keytab for Kerberos Ticket Granting Tickets</a></li>
<li><a href="#configuring-kerberos-authentication-for-remote-execution_managing-hosts">9.13. Configuring Kerberos Authentication for Remote Execution</a></li>
<li><a href="#setting-up-job-templates_managing-hosts">9.14. Setting up Job Templates</a></li>
<li><a href="#executing-a-remote-job_managing-hosts">9.15. Executing a Remote Job</a></li>
<li><a href="#monitoring-remote-jobs_managing-hosts">9.16. Monitoring Jobs</a></li>
<li><a href="#Synchronizing_Templates_Repositories">9.17. Synchronizing Template Repositories</a></li>
</ul>
</li>
<li><a href="#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Appendix A: Template Writing Reference</a>
<ul class="sectlevel2">
<li><a href="#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference-ui">Accessing the Template Writing Reference in the Foreman web UI</a></li>
<li><a href="#sect-Managing_Hosts-Writing_ERB_Templates">Writing ERB Templates</a></li>
<li><a href="#sect-Managing_Hosts-Troubleshooting_ERB_Templates">Troubleshooting ERB Templates</a></li>
<li><a href="#sect-Managing_Hosts-Satellite_Specific_macros_and_Variables">Generic Foreman-Specific Macros</a></li>
<li><a href="#ref_template_macros">Templates Macros</a></li>
<li><a href="#ref_host_specific_variables_for_templates">Host-Specific Variables</a></li>
<li><a href="#ref_kickstart_specific_variables">Kickstart-Specific Variables</a></li>
<li><a href="#ref_writing_conditional_statements">Conditional Statements</a></li>
<li><a href="#ref_working_with_arrays">Parsing Arrays</a></li>
<li><a href="#ref_example_template_snippets">Example Template Snippets</a></li>
</ul>
</li>
<li><a href="#job-template-examples-and-extensions">Appendix B: Job Template Examples and Extensions</a>
<ul class="sectlevel2">
<li><a href="#customizing-templates_managing-hosts">Customizing Job Templates</a></li>
<li><a href="#default-job-template-categories_managing-hosts">Default Job Template Categories</a></li>
<li><a href="#default-example-restorecon-template_managing-hosts">Example restorecon Template</a></li>
<li><a href="#example-rendering-of-the-restorecon-template_managing-hosts">Rendering a restorecon Template</a></li>
<li><a href="#default-example-of-executing-restorecon-on-multiple-hosts_managing-hosts">Executing a restorecon Template on Multiple Hosts</a></li>
<li><a href="#example-including-power-actions-in-a-job-template_managing-hosts">Including Power Actions in Templates</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="overview-of-hosts-in-satellite">1. Overview of Hosts in Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A host is any Linux client that Foreman manages.
Hosts can be physical or virtual.
Virtual hosts can be deployed on any platform supported by Foreman, such as KVM, VMware vSphere, OpenStack, Amazon EC2, Rackspace Cloud Services or Google Compute Engine.</p>
</div>
<div class="paragraph">
<p>Foreman enables host management at scale, including monitoring, provisioning, remote execution, configuration management, software management, and subscription management.
You can manage your hosts from the Foreman web UI or from the command line.</p>
</div>
<div class="paragraph">
<p>In the Foreman web UI, you can browse all hosts recognized by Foreman&#160;server, grouped by type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>All Hosts</strong> - a list of all hosts recognized by Foreman&#160;server.</p>
</li>
<li>
<p><strong>Discovered Hosts</strong> - a list of bare-metal hosts detected on the provisioning network by the Discovery plug-in.</p>
</li>
<li>
<p><strong>Content Hosts</strong> - a list of hosts that manage tasks related to content and subscriptions.</p>
</li>
<li>
<p><strong>Host Collections</strong> - a list of user-defined collections of hosts used for bulk actions such as errata installation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To search for a host, type in the <strong>Search</strong> field, and use an asterisk (*) to perform a partial string search.
For example, if searching for a content host named <code>dev-node.example.com</code>, click the <strong>Content Hosts</strong> page and type <code>dev-node*</code> in the <strong>Search</strong> field.
Alternatively, <code>*node*</code> will also find the content host <code>dev-node.example.com.</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Foreman&#160;server is listed as a host itself even if it is not self-registered.
Do not delete Foreman&#160;server from the list of hosts.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Administering_Hosts">2. Administering Hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes creating, registering, administering, and removing hosts.</p>
</div>
<div class="sect2">
<h3 id="creating-a-host-in-satellite">2.1. Creating a Host in Foreman</h3>
<div class="paragraph">
<p>Use this procedure to create a host in Foreman.
To use the CLI instead of the web UI, see the <a href="#cli-creating-a-host_managing-hosts">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, click <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>On the <strong>Host</strong> tab, enter the required details.</p>
</li>
<li>
<p>Click the <strong>Ansible Roles</strong> tab, and from the <strong>Ansible Roles</strong> list, select one or more roles that you want to add to the host.
Use the <strong>arrow</strong> icon to manage the roles that you add or remove.</p>
</li>
<li>
<p>On the <strong>Puppet Classes</strong> tab, select the Puppet classes you want to include.</p>
</li>
<li>
<p>On the <strong>Interfaces</strong> tab:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For each interface, click <strong>Edit</strong> in the <strong>Actions</strong> column and configure the following settings as required:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Type</strong>&#8201;&#8212;&#8201;For a Bond or BMC interface, use the <strong>Type</strong> list and select the interface type.</p>
</li>
<li>
<p><strong>MAC address</strong>&#8201;&#8212;&#8201;Enter the MAC address.</p>
</li>
<li>
<p><strong>DNS name</strong>&#8201;&#8212;&#8201;Enter the DNS name that is known to the DNS server.
This is used for the host part of the FQDN.</p>
</li>
<li>
<p><strong>Domain</strong>&#8201;&#8212;&#8201;Select the domain name of the provisioning network.
This automatically updates the <strong>Subnet</strong> list with a selection of suitable subnets.</p>
</li>
<li>
<p><strong>IPv4 Subnet</strong>&#8201;&#8212;&#8201;Select an IPv4 subnet for the host from the list.</p>
</li>
<li>
<p><strong>IPv6 Subnet</strong>&#8201;&#8212;&#8201;Select an IPv6 subnet for the host from the list.</p>
</li>
<li>
<p><strong>IPv4 address</strong>&#8201;&#8212;&#8201;If IP address management (IPAM) is enabled for the subnet, the IP address is automatically suggested.
Alternatively, you can enter an address.
The address can be omitted if provisioning tokens are enabled, if the domain does not mange DNS, if the subnet does not manage reverse DNS, or if the subnet does not manage DHCP reservations.</p>
</li>
<li>
<p><strong>IPv6 address</strong>&#8201;&#8212;&#8201;If IP address management (IPAM) is enabled for the subnet, the IP address is automatically suggested.
Alternatively, you can enter an address.</p>
</li>
<li>
<p><strong>Managed</strong>&#8201;&#8212;&#8201;Select this check box to configure the interface during provisioning to use the Smart&#160;Proxy provided DHCP and DNS services.</p>
</li>
<li>
<p><strong>Primary</strong>&#8201;&#8212;&#8201;Select this check box to use the DNS name from this interface as the host portion of the FQDN.</p>
</li>
<li>
<p><strong>Provision</strong>&#8201;&#8212;&#8201;Select this check box to use this interface for provisioning.
This means TFTP boot will take place using this interface, or in case of image based provisioning, the script to complete the provisioning will be executed through this interface.
Note that many provisioning tasks, such as downloading RPMs by <strong>anaconda</strong>, Puppet setup in a <code>%post</code> script, will use the primary interface.</p>
</li>
<li>
<p><strong>Virtual NIC</strong>&#8201;&#8212;&#8201;Select this check box if this interface is not a physical device.
This setting has two options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Tag</strong>&#8201;&#8212;&#8201;Optionally set a VLAN tag.
If unset, the tag will be the VLAN ID of the subnet.</p>
</li>
<li>
<p><strong>Attached to</strong>&#8201;&#8212;&#8201;Enter the device name of the interface this virtual interface is attached to.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save the interface configuration.</p>
</li>
<li>
<p>Optionally, click <strong>Add Interface</strong> to include an additional network interface.
See <a href="#Adding_Network_Interfaces">Adding Network Interfaces</a> for details.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to apply the changes and exit.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On the <strong>Operating System</strong> tab, enter the required details.
For Red&#160;Hat operating systems, select <strong>Synced Content</strong> for <strong>Media Selection</strong>.
If you want to use non Red Hat operating systems, select <strong>All Media</strong>, then select the installation media from the <strong>Media Selection</strong> list.
You can select a partition table from the list or enter a custom partition table in the <strong>Custom partition table</strong> field.
You cannot specify both.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add Parameter</strong> to add any parameter variables that you want to pass to job templates at run time.
This includes all Puppet Class, Ansible playbook parameters and host parameters that you want to associate with the host.
To use a parameter variable with an Ansible job template, you must add a <strong>Host Parameter</strong>.</p>
</li>
<li>
<p>On the <strong>Additional Information</strong> tab, enter additional information about the host.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to complete your provisioning request.</p>
</li>
</ol>
</div>
<div id="cli-creating-a-host_managing-hosts" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a host associated to a host group, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--name "<em>host_name</em>" \
--hostgroup "<em>hostgroup_name</em>" \
--interface="primary=true, \
            provision=true, \
            mac=<em>mac_address</em>, \
            ip=<em>ip_address</em>" \
--organization "<em>Your_Organization</em>" \
--location "<em>Your_Location</em>" \
--ask-root-password yes</pre>
</div>
</div>
<div class="paragraph">
<p>This command prompts you to specify the root password.
It is required to specify the host&#8217;s IP and MAC address.
Other properties of the primary network interface can be inherited from the host group or set using the <code>--subnet</code>, and <code>--domain</code> parameters.
You can set additional interfaces using the <code>--interface</code> option, which accepts a list of key-value pairs.
For the list of available interface settings, enter the <code>hammer host create --help</code> command.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="changing-a-module-stream-for-a-host">2.2. Changing a Module Stream for a Host</h3>
<div class="paragraph">
<p>If you have a Red&#160;Hat Enterprise Linux 8 or clone operating system host, you can modify the module stream for the repositories you install.</p>
</div>
<div class="paragraph">
<p>After you create the host, you can enable, disable, install, update, and remove module streams from your host in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Content Hosts</strong> and click the name of the host that contains the modules you want to change.</p>
</li>
<li>
<p>Click the <strong>Module Streams</strong> tab.</p>
</li>
<li>
<p>From the <strong>Available Module Streams</strong> list, locate the module that you want to change.
You can use the <strong>Filter</strong> field to refine the list entries.
You can also use the <strong>Filter Status</strong> list to search for modules with a specific status.</p>
</li>
<li>
<p>From the <strong>Actions</strong> list, select the change that you want to make to the module.</p>
</li>
<li>
<p>In the <strong>Job Invocation</strong> window, ensure that the job information is accurate.
Change any details that you require, and then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-host-group">2.3. Creating a Host Group</h3>
<div class="paragraph">
<p>If you create a high volume of hosts, many of the hosts can have common settings and attributes.
Adding these settings and attributes for every new host is time consuming.
If you use host groups, you can apply common attributes to hosts that you create.</p>
</div>
<div class="paragraph">
<p>A host group functions as a template for common host settings, containing many of the same details that you provide to hosts.
When you create a host with a host group, the host inherits the defined settings from the host group.
You can then provide additional details to individualize the host.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the web UI, see the <a href="#cli-creating-a-host-group_managing-hosts">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">Host Group Hierarchy</div>
<p>You can create a hierarchy of host groups.
Aim to have one base level host group that represents all hosts in your organization and provide general settings, and then nested groups to provide specific settings.
For example, you can have a base level host group that defines the operating system, and two nested host groups that inherit the base level host group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Hostgroup:</strong> <code>Base</code> (Red Hat Enterprise Linux 7.6)</p>
<div class="ulist">
<ul>
<li>
<p><strong>Hostgroup:</strong> <code>Webserver</code> (applies the <code>httpd</code> Puppet class)</p>
<div class="ulist">
<ul>
<li>
<p><strong>Host:</strong> <code>webserver1.example.com</code> (web server)</p>
</li>
<li>
<p><strong>Host:</strong> <code>webserver2.example.com</code> (web server)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Hostgroup:</strong> <code>Storage</code> (applies the <code>nfs</code> Puppet class)</p>
<div class="ulist">
<ul>
<li>
<p><strong>Host:</strong> <code>storage1.example.com</code> (storage server)</p>
</li>
<li>
<p><strong>Host:</strong> <code>storage2.example.com</code> (storage server)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Host:</strong> <code>custom.example.com</code> (custom host)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example, all hosts use Red Hat Enterprise Linux 7.6 as their operating system because of their inheritance of the <code>Base</code> host group.
The two web server hosts inherit the settings from the <code>Webserver</code> host group, which includes the <code>httpd</code> Puppet class and the settings from the <code>Base</code> host group.
The two storage servers inherit the settings from the <code>Storage</code> host group, which includes the <code>nfs</code> Puppet class and the settings from the <code>Base</code> host group.
The custom host only inherits the settings from the <code>Base</code> host group.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong> and click <strong>Create Host Group</strong>.</p>
</li>
<li>
<p>If you have an existing host group that you want to inherit attributes from, you can select a host group from the <strong>Parent</strong> list.
If you do not, leave this field blank.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the new host group.</p>
</li>
<li>
<p>Enter any further information that you want future hosts to inherit.</p>
</li>
<li>
<p>Click the <strong>Ansible Roles</strong> tab, and from the <strong>Ansible Roles</strong> list, select one or more roles that you want to add to the host.
Use the <strong>arrow</strong> icon to manage the roles that you add or remove.</p>
</li>
<li>
<p>Click the additional tabs and add any details that you want to attribute to the host group.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Puppet fails to retrieve the Puppet CA certificate while registering a host with a host group associated with a Puppet environment created inside a <code>Production</code> environment.</p>
</div>
<div class="paragraph">
<p>To create a suitable Puppet environment to be associated with a host group, manually create a directory and change the owner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /etc/puppetlabs/code/environments/<em>example_environment</em>
# chown apache /etc/puppetlabs/code/environments/<em>example_environment</em></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host group.</p>
</li>
</ol>
</div>
<div id="cli-creating-a-host-group_managing-hosts" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host group with the <code>hammer hostgroup create</code> command.
For example:</p>
<div class="listingblock">
<div class="content">
<pre># hammer hostgroup create --name "Base" \
--lifecycle-environment "Production" --content-view "Base" \
--puppet-environment "production" --content-source-id 1 \
--puppet-ca-proxy-id 1 --puppet-proxy-id 1 --domain "example.com" \
--subnet `ACME's Internal Network` --architecture "x86_64" \
--operatingsystem "RedHat 7.2" --medium-id 9 \
--partition-table "Kickstart default" --root-pass "p@55w0rd!" \
--locations "New York" --organizations "ACME"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-host-group-for-each-lifecycle-environment">2.4. Creating a Host Group for Each LifeCycle Environment</h3>
<div class="paragraph">
<p>Use this procedure to create a host group for the Library lifecycle environment and add nested host groups for other lifecycle environments.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a host group for each life cycle environment, run the following Bash script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-Bash" data-lang="Bash">MAJOR="<em>7</em>"
ARCH="<em>x86_64</em>"
ORG="<em>Your Organization</em>"
LOCATIONS="<em>Your Location</em>"
PTABLE_NAME="<em>Kickstart default</em>"
DOMAIN="<em>example.com</em>"

hammer --output csv --no-headers lifecycle-environment list --organization "${ORG}" | cut -d ',' -f 2 | while read LC_ENV; do
  [[ ${LC_ENV} == "Library" ]] &amp;&amp; continue

  hammer hostgroup create --name "rhel-${MAJOR}server-${ARCH}-${LC_ENV}" \
    --architecture "${ARCH}" \
    --partition-table "${PTABLE_NAME}" \
    --domain "${DOMAIN}" \
    --organizations "${ORG}" \
    --query-organization "${ORG}" \
    --locations "${LOCATIONS}" \
    --lifecycle-environment "${LC_ENV}"
done</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changing-the-group-of-a-host">2.5. Changing the Group of a Host</h3>
<div class="paragraph">
<p>Use this procedure to change the group of a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Select the check box of the host you want to change.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Change Group</strong>.
A new option window opens.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select the group that you want for your host.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="changing-the-environment-of-a-host">2.6. Changing the Environment of a Host</h3>
<div class="paragraph">
<p>Use this procedure to change the environment of a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Select the check box of the host you want to change.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Change Environment</strong>.
A new option window opens.</p>
</li>
<li>
<p>From the <strong>Environment</strong> list, select the new environment for your host.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="changing-the-managed-status-of-a-host">2.7. Changing the Managed Status of a Host</h3>
<div class="paragraph">
<p>Hosts provisioned by Foreman are Managed by default.
When a host is set to Managed, you can configure additional host parameters from Foreman&#160;server.
These additional parameters are listed on the <strong>Operating System</strong> tab.
If you change any settings on the <strong>Operating System</strong> tab, they will not take effect until you set the host to build and reboot it.</p>
</div>
<div class="paragraph">
<p>If you need to obtain reports about configuration management on systems using an operating system not supported by Foreman, set the host to Unmanaged.</p>
</div>
<div class="paragraph">
<p>Use this procedure to switch a host between Managed and Unmanaged status.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Select the host.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Click <strong>Manage host</strong> or <strong>Unmanage host</strong> to change the host&#8217;s status.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="assinging-a-host-to-a-specific-organization">2.8. Assigning a Host to a Specific Organization</h3>
<div class="paragraph">
<p>Use this procedure to assign a host to a specific organization.
For general information about organizations and how to configure them, see <a href="https://docs.theforeman.org/2.5/Content_Management_Guide/index-foreman-el.html#Managing_Organizations">Managing Organizations</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Select the check box of the host you want to change.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Assign Organization</strong>.
A new option window opens.</p>
</li>
<li>
<p>From the <strong>Select Organization</strong> list, select the organization that you want to assign your host to.
Select the check box <strong>Fix Organization on Mismatch</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A mismatch happens if there is a resource associated with a host, such as a domain or subnet, and at the same time not associated with the organization you want to assign the host to.
The option <strong>Fix Organization on Mismatch</strong> will add such a resource to the organization, and is therefore the recommended choice.
The option <strong>Fail on Mismatch</strong> will always result in an error message.
For example, reassigning a host from one organization to another will fail, even if there is no actual mismatch in settings.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="assigning-a-host-to-a-specific-location">2.9. Assigning a Host to a Specific Location</h3>
<div class="paragraph">
<p>Use this procedure to assign a host to a specific location.
For general information about locations and how to configure them, see <a href="https://docs.theforeman.org/2.5/Content_Management_Guide/index-foreman-el.html#Managing_Locations-Creating_a_Location">Creating a Location</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Select the check box of the host you want to change.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Assign Location</strong>.
A new option window opens.</p>
</li>
<li>
<p>Navigate to the <strong>Select Location</strong> list and choose the location that you want for your host.
Select the check box <strong>Fix Location on Mismatch</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A mismatch happens if there is a resource associated with a host, such as a domain or subnet, and at the same time not associated with the location you want to assign the host to.
The option <strong>Fix Location on Mismatch</strong> will add such a resource to the location, and is therefore the recommended choice.
The option <strong>Fail on Mismatch</strong> will always result in an error message.
For example, reassigning a host from one location to another will fail, even if there is no actual mismatch in settings.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="removing-a-host-from-satellite">2.10. Removing a Host from Foreman</h3>
<div class="paragraph">
<p>Use this procedure to remove a host from Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong> or <strong>Hosts</strong> &gt; <strong>Content Hosts</strong>.
Note that there is no difference from what page you remove a host, from <strong>All hosts</strong> or <strong>Content Hosts</strong>.
In both cases, Foreman removes a host completely.</p>
</li>
<li>
<p>Select the hosts that you want to remove.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Delete Hosts</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to remove the host from Foreman permanently.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the <code>Destroy associated VM on host delete</code> setting is set to <code>no</code>.
If a host record that is associated with a virtual machine is deleted, the virtual machine will remain on the compute resource.</p>
</div>
<div class="paragraph">
<p>To delete a virtual machine on the compute resource, navigate to <strong>Administer &gt; Settings</strong> and select the <strong>Provisioning</strong> tab.
Setting <code>Destroy associated VM on host delete</code> to <code>yes</code> deletes the virtual machine if the host record that is associated with the virtual machine is deleted.
To avoid deleting the virtual machine in this situation, disassociate the virtual machine from Foreman without removing it from the compute resource or change the setting.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="disassociating-a-virtual-machine" class="olist arabic">
<div class="title">Disassociating A Virtual Machine from Foreman without Removing it from a Hypervisor</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and select the check box to the left of the hosts to be disassociated.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select the <strong>Disassociate Hosts</strong> button.</p>
</li>
<li>
<p>Optionally, select the check box to keep the hosts for future action.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registering-a-host_managing-hosts">3. Registering a Host to Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hosts can be registered to Foreman by generating a <code>curl</code> command on Foreman and running this command on hosts.
This method uses two templates: <code>global registration</code> template and <code>host initial configuration</code> template. That gives you complete control over the host registration process.
You can set default templates by navigating to Administer &gt; Settings, and clicking the Provisioning tab.</p>
</div>
<div class="paragraph">
<p>Note that you can extend the parameters by plug-ins.
For more information, see <a href="https://github.com/theforeman/foreman/blob/develop/developer_docs/how_to_create_a_plugin.asciidoc">How to Create a Plugin</a> and <a href="https://theforeman.github.io/foreman/?path=/docs/introduction-slot-and-fill&#8212;&#8203;page">Slot and Fill</a></p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Foreman user that generates the <code>curl</code> command must have the <code>create_hosts</code> permission.</p>
</li>
<li>
<p>You must have root privileges on the host that you want to register.</p>
</li>
<li>
<p>Optional: If you want to register hosts through Smart&#160;Proxy, ensure that the <strong>Registration</strong> feature is enabled on this Smart&#160;Proxy.</p>
<div class="paragraph">
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>, click the Smart&#160;Proxy that you want to use, and locate the <strong>Registration</strong> feature in the <strong>Active features</strong> list.</p>
</div>
<div class="paragraph">
<p>Optional: If the <strong>Registration</strong> feature is not enabled on your Smart&#160;Proxy, enter the following command on the Smart&#160;Proxy to enable it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-registration true \
--foreman-proxy-templates true \
--foreman-proxy-template-url 'http://smartproxy.example.com'</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Register Host</strong>.</p>
</li>
<li>
<p>Optional: Select a different <strong>Organization</strong>.</p>
</li>
<li>
<p>Optional: Select a different <strong>Location</strong>.</p>
</li>
<li>
<p>Optional: From the <strong>Host Group</strong> list, select the host group to associate the hosts with.
Fields that inherit value from <strong>Host group</strong>: <strong>Operating system</strong>, <strong>Activation Keys</strong> and <strong>Lifecycle environment</strong>.</p>
</li>
<li>
<p>Optional: From the <strong>Smart&#160;Proxy</strong> list, select the Smart&#160;Proxy to register hosts through.</p>
</li>
<li>
<p>Optional: From the <strong>Operating system</strong> list, select the operating system of hosts that you want to register.
Specifying an operating system is required when you register machines without <code>subscription-manager</code>, such as Debian or Ubuntu.</p>
</li>
<li>
<p>Optional: Select the <strong>Insecure</strong> option, if you want to make the first call insecure.
During this first call, hosts download the CA file from Foreman.
Hosts will use this CA file to connect to Foreman with all future calls making them secure.</p>
<div class="paragraph">
<p>It is recommended to avoid insecure calls.</p>
</div>
<div class="paragraph">
<p>If an attacker, located in the network between Foreman and a host, fetches the CA file from the first insecure call, the attacker will be able to access the content of the API calls to and from the registered host and the JSON Web Tokens (JWT).
Therefore, if you have chosen to deploy SSH keys during registration, the attacker will be able to access the host using the SSH key.</p>
</div>
<div class="paragraph">
<p>Instead, you can manually copy and install the CA file on each host before registering the host.</p>
</div>
<div class="paragraph">
<p>To do this, find where Foreman stores the CA file by navigating to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Authentication</strong> and locating the value of the <strong>SSL CA file</strong> setting.</p>
</div>
<div class="paragraph">
<p>Copy the CA file to the <code>/etc/pki/ca-trust/source/anchors/</code> directory on hosts and enter the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># update-ca-trust enable
# update-ca-trust</pre>
</div>
</div>
<div class="paragraph">
<p>Then register the hosts with a secure <code>curl</code> command, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -sS https://foreman.example.com/register ...</pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the <code>curl</code> command with the <code>--insecure</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -sS --insecure https://foreman.example.com/register ...</pre>
</div>
</div>
</li>
<li>
<p>Select the <strong>Advanced</strong> tab.</p>
</li>
<li>
<p>From the <strong>Setup REX</strong> list, select whether you want to deploy Foreman SSH keys to hosts or not.</p>
<div class="paragraph">
<p>If set to <code>Yes</code>, public SSH keys will be installed on the registered host.
The inherited value is based on the <code>host_registration_remote_execution</code> parameter.
It can be inherited, for example from a host group, an operating system, or an organization.
When overridden, the selected value will be stored on host parameter level.</p>
</div>
</li>
<li>
<p>From the <strong>Setup Insights</strong> list, select whether you want to install <code>insights-client</code> and register the hosts to Insights.</p>
<div class="paragraph">
<p>The Insights tool is available for Red&#160;Hat Enterprise Linux only.
It has no effect on other operating systems.</p>
</div>
<div class="paragraph">
<p>You must enable the following repositories on a registered machine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RHEL 6: <code>rhel-6-server-rpms</code></p>
</li>
<li>
<p>RHEL 7: <code>rhel-7-server-rpms</code></p>
</li>
<li>
<p>RHEL 8: <code>rhel-8-for-x86_64-appstream-rpms</code></p>
<div class="paragraph">
<p>The <code>insights-client</code> package is installed by default on RHEL 8 except in environments whereby RHEL 8 was deployed with "Minimal Install" option.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: In the <strong>Token lifetime (hours)</strong> field, change the validity duration of the JSON Web Token (JWT) that Foreman uses for authentication.
The duration of this token defines how long the generated <code>curl</code> command works.
You can set the duration to 0 - 999 999 hours or unlimited.</p>
<div class="paragraph">
<p>Note that Foreman applies the permissions of the user who generates the <code>curl</code> command to authorization of hosts.
If the user loses or gains additional permissions, the permissions of the JWT change too.
Therefore, do not delete, block, or change permissions of the user during the token duration.</p>
</div>
<div class="paragraph">
<p>The scope of the JWTs is limited to the registration endpoints only and cannot be used anywhere else.</p>
</div>
</li>
<li>
<p>Optional: In the <strong>Remote Execution Interface</strong> field, enter the identifier of a network interface that hosts must use for the SSH connection.
If you keep this field blank, Foreman uses the default network interface.</p>
</li>
<li>
<p>Optional: In the <strong>Install packages</strong> field, list the packages (separated with spaces) that you want to install on the host upon registration.
This can be set by the <code>host_packages</code> parameter.</p>
</li>
<li>
<p>Optional: Select the <strong>Update packages</strong> option to update all packages on the host upon registration.
This can be set by the <code>host_update_packages</code> parameter.</p>
</li>
<li>
<p>Optional: In the <strong>Repository</strong> field, enter a repository to be added before the registration is performed.
For example, it can be useful to make the <code>subscription-manager</code> package available for the purpose of the registration.
For Red Hat family distributions, enter the URL of the repository, for example <code>http://rpm.example.com/</code>.
For Debian OS families, enter the whole line of list file content, for example <code>deb http://deb.example.com/ buster 1.0</code>.</p>
</li>
<li>
<p>Optional: In the <strong>Repository GPG key URL</strong> field, specify the public key to verify the signatures of GPG-signed packages.
It needs to be specified in the ASCII form with the GPG public key header.</p>
</li>
<li>
<p>Optional: This step is for the Katello users only.
If you register RHEL or CentOS hosts, in the <strong>Activation Keys</strong> field, enter one or more activation keys to assign to registered hosts.</p>
</li>
<li>
<p>Click the <strong>Generate</strong> button.</p>
</li>
<li>
<p>Copy the generated <code>curl</code> command.</p>
</li>
<li>
<p>On the hosts that you want to register, run the <code>curl</code> command as <code>root</code>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="customizing-the-registration-templates_managing-hosts">3.1. Customizing the Registration Templates</h3>
<div class="paragraph">
<p>Use information in this section if you want to customize the registration process.</p>
</div>
<div class="paragraph">
<p>Note that all default templates in Foreman are locked.
If you want to customize the registration process, you need to clone the default templates and edit the clones.
Then, in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> change the <strong>Default Global registration template</strong> and <strong>Default 'Host initial configuration' template</strong> settings to point to your custom templates.</p>
</div>
<div class="paragraph">
<div class="title">Templates</div>
<p>The registration process uses the following registration templates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Global Registration</strong> template contains steps for registering hosts to Foreman.
This template renders when hosts access the <code>/register</code> endpoint.</p>
</li>
<li>
<p>The <strong>Linux host_init_config default</strong> template contains steps for initial configuration of hosts after they are registered.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Global Parameters</div>
<p>You can configure the following global parameters by navigating to <strong>Configure</strong> &gt; <strong>Global Parameters</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>host_registration_remote_execution</code> parameter is used in the <code>remote_execution_ssh_keys</code> snippet, the default value is <code>true</code>.</p>
</li>
<li>
<p>The <code>host_registration_insights</code> parameter is used in the <code>insights</code> snippet, the default value is <code>false</code>.</p>
</li>
<li>
<p>The <code>host_packages</code> parameter is for installing packages on the host.</p>
</li>
<li>
<p>The <code>remote_execution_ssh_keys</code>, <code>remote_execution_ssh_user</code>, <code>remote_execution_create_user</code> and <code>remote_execution_effective_user_method</code> parameters are used in the <code>remote_execution_ssh_keys</code>. For more details se the details of the snippet.</p>
</li>
<li>
<p>The <code>encrypt_grub</code> parameter is to enable setting of an encrypted bootloader password for the host, the default value is <code>false</code>.</p>
<div class="paragraph">
<p>To actually set the password, use the <code>grub_pass</code> macro in your template.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Snippets</div>
<p>Snippet is used in the <strong>Linux host_init_config default</strong> template:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>remote_execution_ssh_keys</code> snippet deploys SSH keys to the host only when the <code>host_registration_remote_execution</code> parameter is <code>true</code>.</p>
</li>
<li>
<p>The <code>insights</code> snippet downloads and installs the Red&#160;Hat Insights client when global parameter <code>host_registration_insights</code> is set to true.</p>
</li>
<li>
<p>The <code>puppetlabs_repo</code> and <code>puppet_setup</code> snippets downloads and installs puppet agent on the host (only when puppet master is present)</p>
</li>
<li>
<p>The <code>host_init_config_post</code> is empty snippet for user&#8217;s custom actions on during host initial configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Variables</div>
<p>This table describes what variables are used in the <code>Global Registration</code> template.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. The Global Registration Template Variables</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Command argument</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current authenticated user object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@organization</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>organization_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>organization_id</code> is not set, then user&#8217;s default organization is set, or the first organization from user&#8217;s organizations list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>location_id</code> is not set, user&#8217;s default location is set, or the first location from user&#8217;s locations list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@hostgroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hostgroup_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host group of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@operatingsystem</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operatingsystem_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@setup_insights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setup_insights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the value of the <code>host_registration_insights</code> global parameter for the registered host and install insights client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@setup_remote_execution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setup_remote_execution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the value of <code>host_registration_remote_execution</code> global parameter for the registered host and deploy SSH keys for remote execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@setup_remote_execution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setup_remote_execution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set default interface of host for the remote execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@packages</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>packages</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packages to install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@repo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add repository on the host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@repo_gpg_key_url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo_gpg_key_url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set repository GPG key form URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@activation_keys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>activation_keys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Host activation keys snippet is for Katello users only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@registration_url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL for the <code>/register</code> endpoint.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="migrating-from-katello-agent-to-remote-execution_managing-hosts">3.2. Migrating from Katello Agent to Remote Execution</h3>
<div class="paragraph">
<p><code>Remote Execution</code> is the preferred way to manage package content on hosts.
The Katello Agent is deprecated and will be removed in a future Foreman version.
Follow these steps to switch to Remote Execution.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have previously installed the <code>katello-agent</code> package on content hosts.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Stop the goferd service on content hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop goferd.service</pre>
</div>
</div>
</li>
<li>
<p>Disable the goferd service on content hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl disable goferd.service</pre>
</div>
</div>
</li>
<li>
<p>Remove the Katello agent on content hosts:</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If your host is installed on oVirt version 4.4 or lower, do not remove the <code>katello-agent</code> package because the removed dependencies corrupt the host.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum remove katello-agent</pre>
</div>
</div>
</li>
<li>
<p>Distribute the remote execution SSH keys to the content hosts.
For more information, see <a href="#ssh-keys-for-remote-execution-overview_managing-hosts">Distributing SSH Keys for Remote Execution</a>.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Select the <strong>Content</strong> tab.</p>
</li>
<li>
<p>Set the <strong>Use remote execution by default</strong> parameter to <strong>Yes</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Foreman server now uses host management by remote execution instead of katello-agent.</p>
</div>
<div class="paragraph">
<p>The following table shows the remote execution equivalent commands to perform specific package actions.
See <code>hammer job-invocation create --help</code> to learn how to specify search queries to determine the target hosts or host collections.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Hammer Commands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">Katello Agent</th>
<th class="tableblock halign-left valign-top">Remote Execution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install a package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host package install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_package_install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install a package (host collection)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host-collection package install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_package_install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host package remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_package_remove</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a package (host collection)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host-collection package remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_package_remove</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update a package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host package upgrade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_package_update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update a package (host collection)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host-collection package update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_package_update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update all packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host package update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_package_update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install errata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host errata apply</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_errata_install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install errata (host collection)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host-collection errata install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_errata_install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install a package group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host package-group install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_group_install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install a package group (host collection)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host-collection package-group install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_group_install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a package group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host package-group remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_group_remove</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a package group (host collection)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host-collection package-group remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_group_remove</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update a package group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host package-group update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_group_update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update a package group (host collection)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer host-collection package-group update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hammer job-invocation create --feature katello_group_update</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Adding_Network_Interfaces">4. Adding Network Interfaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman supports specifying multiple network interfaces for a single host.
You can configure these interfaces when creating a new host as described in <a href="#creating-a-host-in-satellite">Creating a Host in Foreman</a> or when editing an existing host.</p>
</div>
<div class="paragraph">
<p>There are several types of network interfaces that you can attach to a host.
When adding a new interface, select one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Interface</strong>: Allows you to specify an additional physical or virtual interface.
There are two types of virtual interfaces you can create.
Use <strong>VLAN</strong> when the host needs to communicate with several (virtual) networks using a single interface, while these networks are not accessible to each other.
Use <strong>alias</strong> to add an additional IP address to an existing interface.</p>
<div class="paragraph">
<p>For more information about adding a physical interface, see <a href="#adding-a-physical-interface">Adding a Physical Interface</a>.</p>
</div>
<div class="paragraph">
<p>For more information about adding a virtual interface, see <a href="#adding-a-virtual-interface">Adding a Virtual Interface</a>.</p>
</div>
</li>
<li>
<p><strong>Bond</strong>: Creates a bonded interface.
NIC bonding is a way to bind multiple network interfaces together into a single interface that appears as a single device and has a single MAC address.
This enables two or more network interfaces to act as one, increasing the bandwidth and providing redundancy.
See <a href="#adding-a-bonded-interface">Adding a Bonded Interface</a> for details.</p>
</li>
<li>
<p><strong>BMC</strong>: Baseboard Management Controller (BMC) allows you to remotely monitor and manage the physical state of machines.
For more information about BMC, see <a href="https://docs.theforeman.org/2.5/Installing_Server_on_Red_Hat/index-foreman-el.html#enabling-power-management-on-managed-hosts_foreman">Enabling Power Management on Managed Hosts</a> in <em>Installing Foreman 2.5 server on Enterprise Linux</em>.
For more information about configuring BMC interfaces, see <a href="#adding-a-bmc-interface">Adding a Baseboard Management Controller (BMC) Interface</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Additional interfaces have the <strong>Managed</strong> flag enabled by default, which means the new interface is configured automatically during provisioning by the DNS and DHCP Smart&#160;Proxy&#160;servers associated with the selected subnet.
This requires a subnet with correctly configured DNS and DHCP Smart&#160;Proxy&#160;servers.
If you use a Kickstart method for host provisioning, configuration files are automatically created for managed interfaces in the post-installation phase at <code>/etc/sysconfig/network-scripts/ifcfg-<em>interface_id</em></code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Virtual and bonded interfaces currently require a MAC address of a physical device.
Therefore, the configuration of these interfaces works only on bare-metal hosts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="adding-a-physical-interface">4.1. Adding a Physical Interface</h3>
<div class="paragraph">
<p>Use this procedure to add an additional physical interface to a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> next to the host you want to edit.</p>
</li>
<li>
<p>On the <strong>Interfaces</strong> tab, click <strong>Add Interface</strong>.</p>
</li>
<li>
<p>Keep the <strong>Interface</strong> option selected in the <strong>Type</strong> list.</p>
</li>
<li>
<p>Specify a <strong>MAC address</strong>.
This setting is required.</p>
</li>
<li>
<p>Specify the <strong>Device Identifier</strong>, for example <strong>eth0</strong>.
The identifier is used to specify this physical interface when creating bonded interfaces, VLANs, and aliases.</p>
</li>
<li>
<p>Specify the <strong>DNS name</strong> associated with the host&#8217;s IP address.
Foreman saves this name in Smart&#160;Proxy&#160;server associated with the selected domain (the "DNS A" field) and Smart&#160;Proxy&#160;server associated with the selected subnet (the "DNS PTR" field).
A single host can therefore have several DNS entries.</p>
</li>
<li>
<p>Select a domain from the <strong>Domain</strong> list.
To create and manage domains, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong>.</p>
</li>
<li>
<p>Select a subnet from the <strong>Subnet</strong> list.
To create and manage subnets, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>Specify the <strong>IP address</strong>.
Managed interfaces with an assigned DHCP Smart&#160;Proxy&#160;server require this setting for creating a DHCP lease.
DHCP-enabled managed interfaces are automatically provided with a suggested IP address.</p>
</li>
<li>
<p>Select whether the interface is <strong>Managed</strong>.
If the interface is managed, configuration is pulled from the associated Smart&#160;Proxy&#160;server during provisioning, and DNS and DHCP entries are created.
If using kickstart provisioning, a configuration file is automatically created for the interface.</p>
</li>
<li>
<p>Select whether this is the <strong>Primary</strong> interface for the host.
The DNS name from the primary interface is used as the host portion of the FQDN.</p>
</li>
<li>
<p>Select whether this is the <strong>Provision</strong> interface for the host.
TFTP boot takes place using the provisioning interface.
For image-based provisioning, the script to complete the provisioning is executed through the provisioning interface.</p>
</li>
<li>
<p>Select whether to use the interface for <strong>Remote execution</strong>.</p>
</li>
<li>
<p>Leave the <strong>Virtual NIC</strong> check box clear.</p>
</li>
<li>
<p>Click <strong>OK</strong> to save the interface configuration.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to apply the changes to the host.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-virtual-interface">4.2. Adding a Virtual Interface</h3>
<div class="paragraph">
<p>Use this procedure to configure a virtual interface for a host.
This can be either a VLAN or an alias interface.</p>
</div>
<div class="paragraph">
<p>An alias interface is an additional IP address attached to an existing interface.
An alias interface automatically inherits a MAC address from the interface it is attached to; therefore, you can create an alias without specifying a MAC address.
The interface must be specified in a subnet with boot mode set to <code>static</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> next to the host you want to edit.</p>
</li>
<li>
<p>On the <strong>Interfaces</strong> tab, click <strong>Add Interface</strong>.</p>
</li>
<li>
<p>Keep the <strong>Interface</strong> option selected in the <strong>Type</strong> list.</p>
</li>
<li>
<p>Specify the general interface settings.
The applicable configuration options are the same as for the physical interfaces described in <a href="#adding-a-physical-interface">Adding a Physical Interface</a>.</p>
<div class="paragraph">
<p>Specify a <strong>MAC address</strong> for managed virtual interfaces so that the configuration files for provisioning are generated correctly.
However, a <strong>MAC address</strong> is not required for virtual interfaces that are not managed.</p>
</div>
<div class="paragraph">
<p>If creating a VLAN, specify ID in the form of <strong>eth1.10</strong> in the <strong>Device Identifier</strong> field.
If creating an alias, use ID in the form of <strong>eth1:10</strong>.</p>
</div>
</li>
<li>
<p>Select the <strong>Virtual NIC</strong> check box.
Additional configuration options specific to virtual interfaces are appended to the form:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Tag</strong>: Optionally set a VLAN tag to trunk a network segment from the physical network through to the virtual interface.
If you do not specify a tag, managed interfaces inherit the VLAN tag of the associated subnet.
User-specified entries from this field are not applied to alias interfaces.</p>
</li>
<li>
<p><strong>Attached to</strong>: Specify the identifier of the physical interface to which the virtual interface belongs, for example <strong>eth1</strong>.
This setting is required.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save the interface configuration.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to apply the changes to the host.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-bonded-interface">4.3. Adding a Bonded Interface</h3>
<div class="paragraph">
<p>Use this procedure to configure a bonded interface for a host.
To use the CLI instead of the web UI, see the <a href="#cli-adding-a-bonded-interface_managing-hosts">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> next to the host you want to edit.</p>
</li>
<li>
<p>On the <strong>Interfaces</strong> tab, click <strong>Add Interface</strong>.</p>
</li>
<li>
<p>Select <strong>Bond</strong> from the <strong>Type</strong> list.
Additional type-specific configuration options are appended to the form.</p>
</li>
<li>
<p>Specify the general interface settings.
The applicable configuration options are the same as for the physical interfaces described in <a href="#adding-a-physical-interface">Adding a Physical Interface</a>.</p>
<div class="paragraph">
<p>Bonded interfaces use IDs in the form of <strong>bond0</strong> in the <strong>Device Identifier</strong> field.</p>
</div>
<div class="paragraph">
<p>A single <strong>MAC address</strong> is sufficient.</p>
</div>
</li>
<li>
<p>Specify the configuration options specific to bonded interfaces:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Mode</strong>: Select the bonding mode that defines a policy for fault tolerance and load balancing.
See <a href="#Bonding_Modes_Available_in_Red_Hat_Satellite">Bonding Modes Available in Foreman</a> for a brief description of each bonding mode.</p>
</li>
<li>
<p><strong>Attached devices</strong>: Specify a comma-separated list of identifiers of attached devices.
These can be physical interfaces or VLANs.</p>
</li>
<li>
<p><strong>Bond options</strong>: Specify a space-separated list of configuration options, for example <strong>miimon=100</strong>.
See the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/index">Red&#160;Hat Enterprise Linux 7 Networking Guide</a> for details of the configuration options you can specify for the bonded interface.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save the interface configuration.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to apply the changes to the host.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-bonded-interface_managing-hosts" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a host with a bonded interface, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name bonded_interface \
--hostgroup-id <em>1</em> \
--ip=<em>192.168.100.123</em> \
--mac=<em>52:54:00:14:92:2a</em> \
--subnet-id=<em>1</em> \
--managed true \
   --interface="identifier=<em>eth1</em>, \
               mac=<em>52:54:00:62:43:06</em>, \
               managed=true, \
               type=Nic::Managed, \
               domain_id=<em>1</em>, \
               subnet_id=<em>1</em>" \
   --interface="identifier=<em>eth2</em>, \
               mac=<em>52:54:00:d3:87:8f</em>, \
               managed=true, \
               type=Nic::Managed, \
               domain_id=<em>1</em>, \
               subnet_id=<em>1</em>" \
   --interface="identifier=<em>bond0</em>, \
               ip=<em>172.25.18.123</em>, \
               type=Nic::Bond, \
               mode=active-backup, \
               attached_devices=[<em>eth1,eth2</em>], \
               managed=true, \
               domain_id=<em>1</em>, \
               subnet_id=<em>1</em>" \
--organization "<em>Your_Organization</em>" \
--location "<em>Your_Location</em>" \
--ask-root-password yes</pre>
</div>
</div>
</li>
</ul>
</div>
<table id="Bonding_Modes_Available_in_Red_Hat_Satellite" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Bonding Modes Available in Foreman</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bonding Mode</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">balance-rr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transmissions are received and sent sequentially on each bonded interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">active-backup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transmissions are received and sent through the first available bonded interface.
Another bonded interface is only used if the active bonded interface fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">balance-xor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transmissions are based on the selected hash policy.
In this mode, traffic destined for specific peers is always sent over the same interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broadcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All transmissions are sent on all bonded interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates aggregation groups that share the same settings.
Transmits and receives on all interfaces in the active group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">balance-tlb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The outgoing traffic is distributed according to the current load on each bonded interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">balance-alb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive load balancing is achieved through Address Resolution Protocol (ARP) negotiation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="adding-a-bmc-interface">4.4. Adding a Baseboard Management Controller (BMC) Interface</h3>
<div class="paragraph">
<p>Use this procedure to configure a baseboard management controller (BMC) interface for a host that supports this feature.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The <code>ipmitool</code> package is installed.</p>
</li>
<li>
<p>You know the MAC address, IP address, and other details of the BMC interface on the host, and the appropriate credentials for that interface.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You only need the MAC address for the BMC interface if the BMC interface is managed, so that it can create a DHCP reservation.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable BMC on the Smart&#160;Proxy server if it is not already enabled:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Configure BMC power management on Smart&#160;Proxy&#160;server by running the <code>foreman-installer</code> script with the following options:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-bmc=true \
--foreman-proxy-bmc-default-provider=ipmitool</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>From the list in the <strong>Actions</strong> column, click <strong>Refresh</strong>.
The list in the <strong>Features</strong> column should now include BMC.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> next to the host you want to edit.</p>
</li>
<li>
<p>On the <strong>Interfaces</strong> tab, click <strong>Add Interface</strong>.</p>
</li>
<li>
<p>Select <strong>BMC</strong> from the <strong>Type</strong> list.
Type-specific configuration options are appended to the form.</p>
</li>
<li>
<p>Specify the general interface settings.
The applicable configuration options are the same as for the physical interfaces described in <a href="#adding-a-physical-interface">Adding a Physical Interface</a>.</p>
</li>
<li>
<p>Specify the configuration options specific to BMC interfaces:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Username</strong> and <strong>Password</strong>: Specify any authentication credentials required by BMC.</p>
</li>
<li>
<p><strong>Provider</strong>: Specify the BMC provider.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save the interface configuration.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to apply the changes to the host.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-hosts-from-rhel7-to-rhel8_managing-hosts">5. Upgrading Hosts from RHEL 7 to RHEL 8</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use a job template to upgrade your Red&#160;Hat Enterprise&#160;Linux 7 hosts to Red&#160;Hat Enterprise&#160;Linux 8.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your RHEL 7 hosts meet the requirements for the upgrade to RHEL 8.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/upgrading_from_rhel_7_to_rhel_8/planning-an-upgrade_upgrading-from-rhel-7-to-rhel-8">Planning an upgrade</a> in the <em>Upgrading from RHEL 7 to RHEL 8</em> guide.</p>
</li>
<li>
<p>Prepare your hosts for the upgrade.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/upgrading_from_rhel_7_to_rhel_8/index#preparing-a-rhel-7-system-for-the-upgrade_upgrading-from-rhel-7-to-rhel-8">Preparing a RHEL 7 system for the upgrade</a> in the <em>Upgrading from RHEL 7 to RHEL 8</em> guide.</p>
</li>
<li>
<p>Enable remote execution feature on Foreman.
For more information, see <a href="#configuring-and-setting-up-remote-jobs_managing-hosts">Configuring and Setting up Remote Jobs</a>.</p>
</li>
<li>
<p>Distribute Foreman SSH keys to the hosts that you want to upgrade.
For more information, see <a href="#ssh-keys-for-remote-execution-overview_managing-hosts">Distributing SSH Keys for Remote Execution</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman, enable the <code>foreman_plugin_leapp</code> puppet module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-leapp</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Select the hosts that you want to upgrade to Red&#160;Hat Enterprise&#160;Linux 8.</p>
</li>
<li>
<p>In the upper right of the Hosts window, from the <strong>Select Action</strong> list, select <strong>Preupgrade check with Leapp</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to start the pre-upgrade check.</p>
</li>
<li>
<p>When the check is finished, click the <strong>Leapp preupgrade report</strong> tab to see if LEAPP has found any issues on RHEL 7 hosts.
Issues that have the <strong>Inhibitor</strong> flag are considered crucial and are likely to break the upgrade procedure.
Issues that have the <strong>Has Remediation</strong> flag contain remediation that can help you fix the issue.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click an issue that is flagged as <strong>Has Remediation</strong> to expand it.</p>
<div class="ulist">
<ul>
<li>
<p>If the issue contains a remediation <strong>Command</strong>, you can fix it directly from Foreman using remote execution.
Select the issue.</p>
</li>
<li>
<p>If the issue contains only a remediation <strong>Hint</strong>, use the hint to fix the issue on the host manually.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Repeat this step for other issues.</p>
</div>
</li>
<li>
<p>After you selected any issues with remediation commands, click <strong>Fix Selected</strong> and submit the job.</p>
</li>
<li>
<p>After the issues are fixed, click the <strong>Rerun</strong> button, and then click <strong>Submit</strong> to run the pre-upgrade check again to verify that the hosts you are upgrading do not have any issues and are ready to be upgraded.</p>
</li>
</ol>
</div>
</li>
<li>
<p>When your systems are ready for the upgrade, click the <strong>Run Upgrade</strong> button and click <strong>Submit</strong> to start the upgrade.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="host_management_and_monitoring_using_red_hat_web_console">6. Host Management and Monitoring Using Cockpit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cockpit is an interactive web interface that you can use to perform actions and monitor Red Hat Enterprise Linux hosts.
You can enable a remote-execution feature to integrate Foreman with Cockpit.
When you install Cockpit on a host that you manage with Foreman, you can view the Cockpit dashboards of that host from within the Foreman web UI.
You can also use the features that are integrated with Cockpit, for example, Lorax Composer.</p>
</div>
<div class="sect2">
<h3 id="integrating_satellite_with_red_hat_web_console">6.1. Integrating Foreman with Cockpit</h3>
<div class="paragraph">
<p>By default, Cockpit integration is disabled in Foreman.
If you want to access Cockpit features for your hosts from within Foreman, you must first enable Cockpit integration on Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On Foreman&#160;server, run <code>foreman-installer</code> with the  <code>--enable-foreman-plugin-remote-execution-cockpit</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-remote-execution-cockpit</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="managing_and_monitoring_hosts_using_red_hat_web_console">6.2. Managing and Monitoring Hosts Using Cockpit</h3>
<div class="paragraph">
<p>You can access the Cockpit web UI through the Foreman web UI and use the functionality to manage and monitor hosts in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Cockpit is enabled in Foreman.</p>
</li>
<li>
<p>Cockpit is installed on the host that you want to view:</p>
<div class="ulist">
<ul>
<li>
<p>For more information see <a href="https://cockpit-project.org/running.html">Running Cockpit</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Foreman or Smart&#160;Proxy can authenticate to the host with SSH keys.
For more information, <a href="#ssh-keys-for-remote-execution-overview_managing-hosts">Distributing SSH Keys for Remote Execution</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and select the host that you want to manage and monitor with Cockpit.</p>
</li>
<li>
<p>In the upper right of the host window, click <strong>Web Console</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now access the full range of features available for host monitoring and management, for example, Lorax Composer, through the Cockpit.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using_report_templates">7. Using Report Templates to Monitor Hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use report templates to query Foreman data to obtain information about, for example, host status, registered hosts, applicable errata, applied errata, subscription details, and user activity.
You can use the report templates that ship with Foreman or write your own custom report templates to suit your requirements.
The reporting engine uses the embedded Ruby (ERB) syntax.
For more information about writing templates and ERB syntax, see <a href="#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a>.</p>
</div>
<div class="paragraph">
<p>You can create a template, or clone a template and edit the clone.
For help with the template syntax, click a template and click the <strong>Help</strong> tab.</p>
</div>
<div class="sect2">
<h3 id="chap-Managing_Hosts-Generating_Host_Monitoring_Reports">7.1. Generating Host Monitoring Reports</h3>
<div class="paragraph">
<p>To view the report templates, in the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong>.</p>
</div>
<div class="paragraph">
<p>To schedule reports, you can configure a cron job or use the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong>.</p>
</li>
<li>
<p>To the right of the report template that you want to use, click <strong>Generate</strong>.</p>
</li>
<li>
<p>Optional: To schedule a report, to the right of the <strong>Generate at</strong> field, click the icon to select the date and time you want to generate the report at.</p>
</li>
<li>
<p>Optional: To send a report to an e-mail address, select the <strong>Send report via e-mail</strong> check box, and in the <strong>Deliver to e-mail addresses</strong> field, enter the required e-mail address.</p>
</li>
<li>
<p>Optional: Apply search query filters.
To view all available results, do not populate the filter field with any values.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
A CSV file that contains the report is downloaded.
If you have selected the <strong>Send report via e-mail</strong> check box, the host monitoring report is sent to your e-mail address.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">CLI procedure</div>
<p>To generate a report, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all available report templates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer report-template list</pre>
</div>
</div>
</li>
<li>
<p>Generate a report:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer report-template generate --id <em>template ID</em></pre>
</div>
</div>
<div class="paragraph">
<p>This command waits until the report fully generates before completing.
If you want to generate the report as a background task, you can use the <code>hammer report-template schedule</code> command.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc_creating_a_report_template">7.2. Creating a Report Template</h3>
<div class="paragraph">
<p>In Foreman, you can create a report template and customize the template to suit your requirements.
You can import existing report templates and further customize them with snippets and template macros.</p>
</div>
<div class="paragraph">
<p>Report templates use Embedded Ruby (ERB) syntax.
To view information about working with ERB syntax and macros, in the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong>, and click <strong>Create Template</strong>, and then click the <strong>Help</strong> tab.</p>
</div>
<div class="paragraph">
<p>When you create a report template in Foreman, safe mode is enabled by default.
For more information about safe mode, see <a href="#con_report_templates_safe_mode">Report Template Safe Mode</a>.</p>
</div>
<div class="paragraph">
<p>For more information about writing templates, see the <a href="#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a>.</p>
</div>
<div class="paragraph">
<p>For more information about macros you can use in report templates, see <a href="#ref_template_macros">Templates Macros</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong>, and click <strong>Create Template</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a unique name for your report template.</p>
</li>
<li>
<p>If you want the template to be available to all locations and organizations, select <strong>Default</strong>.</p>
</li>
<li>
<p>Create the template directly in the template editor or import a template from a text file by clicking <strong>Import</strong>.
For more information about importing templates, see <a href="#importing_report_templates">Importing Report Templates</a>.</p>
</li>
<li>
<p>Optional: In the <strong>Audit Comment</strong> field, you can add any useful information about this template.</p>
</li>
<li>
<p>Click the <strong>Input</strong> tab, and in the <strong>Name</strong> field, enter a name for the input that you can reference in the template in the following format: <code>input('name')</code>.
Note that you must save the template before you can reference this input value in the template body.</p>
</li>
<li>
<p>Select whether the input value is mandatory.
If the input value is mandatory, select the <strong>Required</strong> check box.</p>
</li>
<li>
<p>From the <strong>Value Type</strong> list, select the type of input value that the user must input.</p>
</li>
<li>
<p>Optional: If you want to use facts for template input, select the <strong>Advanced</strong> check box.</p>
</li>
<li>
<p>Optional: In the <strong>Options</strong> field, define the options that the user can select from.
If this field remains undefined, the users receive a free-text field in which they can enter the value they want.</p>
</li>
<li>
<p>Optional: In the <strong>Default</strong> field, enter a value, for example, a host name, that you want to set as the default template input.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, you can enter information that you want to display as inline help about the input when you generate the report.</p>
</li>
<li>
<p>Optional: Click the <strong>Type</strong> tab, and select whether this template is a snippet to be included in other templates.</p>
</li>
<li>
<p>Click the <strong>Location</strong> tab and add the locations where you want to use the template.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organizations where you want to use the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="exporting_report_templates">7.3. Exporting Report Templates</h3>
<div class="paragraph">
<p>You can export report templates that you create in Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong>.</p>
</li>
<li>
<p>Locate the template that you want to export, and from the list in the <strong>Actions</strong> column, select <strong>Export</strong>.</p>
</li>
<li>
<p>Repeat this action for every report template that you want to download.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An <code>.erb</code> file that contains the template downloads.</p>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>To view the report templates available for export, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer report-template list</pre>
</div>
</div>
<div class="paragraph">
<p>Note the template ID of the template that you want to export in the output of this command.</p>
</div>
</li>
<li>
<p>To export a report template, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer report-template dump --id <em>template_ID</em> &gt; <em>example_export</em>.erb</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc_exporting_report_templates_api">7.4. Exporting Report Templates Using the Foreman API</h3>
<div class="paragraph">
<p>You can use the Foreman <code>report_templates</code> API to export report templates from Foreman.
For more information about using the Foreman API, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.10/html/api_guide/index">API Guide</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use the following request to retrieve a list of available report templates:</p>
<div class="listingblock">
<div class="title">Example request:</div>
<div class="content">
<pre class="nowrap">$ curl --insecure --user admin:redhat \
--request GET \
--config https://<em>foreman.example.com</em>/api/report_templates \
| json_reformat</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>json_reformat</code> tool is used to format the JSON output.</p>
</div>
<div class="listingblock">
<div class="title">Example response:</div>
<div class="content">
<pre class="nowrap">{
    "total": 6,
    "subtotal": 6,
    "page": 1,
    "per_page": 20,
    "search": null,
    "sort": {
        "by": null,
        "order": null
    },
    "results": [
        {
            "created_at": "2019-11-20 17:49:52 UTC",
            "updated_at": "2019-11-20 17:49:52 UTC",
            "name": "Applicable errata",
            "id": 112
        },
        {
            "created_at": "2019-11-20 17:49:52 UTC",
            "updated_at": "2019-11-20 17:49:52 UTC",
            "name": "Applied Errata",
            "id": 113
        },
        {
            "created_at": "2019-11-30 16:15:24 UTC",
            "updated_at": "2019-11-30 16:15:24 UTC",
            "name": "Hosts - complete list",
            "id": 158
        },
        {
            "created_at": "2019-11-20 17:49:52 UTC",
            "updated_at": "2019-11-20 17:49:52 UTC",
            "name": "Host statuses",
            "id": 114
        },
        {
            "created_at": "2019-11-20 17:49:52 UTC",
            "updated_at": "2019-11-20 17:49:52 UTC",
            "name": "Registered hosts",
            "id": 115
        },
        {
            "created_at": "2019-11-20 17:49:52 UTC",
            "updated_at": "2019-11-20 17:49:52 UTC",
            "name": "Subscriptions",
            "id": 116
        }
    ]
}</pre>
</div>
</div>
</li>
<li>
<p>Note the <code>id</code> of the template that you want to export, and use the following request to export the template:</p>
<div class="listingblock">
<div class="title">Example request:</div>
<div class="content">
<pre class="nowrap">$ curl --insecure --output <em>/tmp/_Example_Export_Template</em>.erb_ \
--user <em>admin:password</em> --request GET --config \
https://<em>foreman.example.com</em>/api/report_templates/<em>158</em>/export</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>158</code> is an example ID of the template to export.</p>
</div>
<div class="paragraph">
<p>In this example, the exported template is redirected to <code>host_complete_list.erb</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="importing_report_templates">7.5. Importing Report Templates</h3>
<div class="paragraph">
<p>You can import a report template into the body of a new template that you want to create.
Note that using the web UI, you can only import templates individually.
For bulk actions, use the Foreman API.
For more information, see <a href="#proc_importing_report_templates_api">Importing Report Templates Using the Foreman API</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>You must have exported templates from Foreman to import them to use in new templates.
For more information see <a href="#exporting_report_templates">Exporting Report Templates</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong>, and in the upper right of the Report Templates window, click <strong>Create Template</strong>.</p>
</li>
<li>
<p>On the upper right of the <strong>Editor</strong> tab, click the folder icon, and select the <code>.erb</code> file that you want to import.</p>
</li>
<li>
<p>Edit the template to suit your requirements, and click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about customizing your new template, see <a href="#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc_importing_report_templates_api">7.6. Importing Report Templates Using the Foreman API</h3>
<div class="paragraph">
<p>You can use the Foreman API to import report templates into Foreman.
Importing report templates using the Foreman API automatically parses the report template metadata and assigns organizations and locations.
For more information about using the Foreman API, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.10/html/api_guide/index">API Guide</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Create a template using <code>.erb</code> syntax or export a template from another Foreman.</p>
<div class="paragraph">
<p>For more information about writing templates, see <a href="#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a>.</p>
</div>
<div class="paragraph">
<p>For more information about exporting templates from Foreman, see <a href="#proc_exporting_report_templates_api">Exporting Report Templates Using the Foreman API</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use the following example to format the template that you want to import to a <code>.json</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat <em>Example_Template</em>.json
{
    "name": "<em>Example Template Name</em>",
    "template": "
    <em>Enter ERB Code Here</em>
"
}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example JSON File with ERB Template:</div>
<div class="content">
<pre>{
    "name": "Hosts - complete list",
    "template": "
&lt;%#
name: Hosts - complete list
snippet: false
template_inputs:
- name: host
  required: false
  input_type: user
  advanced: false
  value_type: plain
  resource_type: Katello::ActivationKey
model: ReportTemplate
-%&gt;
&lt;% load_hosts(search: input('host')).each_record do |host| -%&gt;
&lt;%
      report_row(
          'Server FQND': host.name
      )
-%&gt;
&lt;%  end -%&gt;
&lt;%= report_render %&gt;
"
}</pre>
</div>
</div>
</li>
<li>
<p>Use the following request to import the template:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl --insecure --user admin:redhat \
--data @<em>Example_Template</em>.json --header "Content-Type:application/json" \
--request POST --config https://<em>foreman.example.com</em>/api/report_templates/import</pre>
</div>
</div>
</li>
<li>
<p>Use the following request to retrieve a list of report templates and validate that you can view the template in Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl --insecure --user admin:redhat \
 --request GET --config https://<em>foreman.example.com</em>/api/report_templates | json_reformat</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="con_report_templates_safe_mode">7.7. Report Template Safe Mode</h3>
<div class="paragraph">
<p>When you create report templates in Foreman, safe mode is enabled by default.
Safe mode limits the macros and variables that you can use in the report template.
Safe mode prevents rendering problems and enforces best practices in report templates.
The list of supported macros and variables is available in the Foreman web UI.</p>
</div>
<div class="paragraph">
<p>To view the macros and variables that are available, in the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong> and click <strong>Create Template</strong>.
In the Create Template window, click the <strong>Help</strong> tab and expand <strong>Safe mode methods</strong>.</p>
</div>
<div class="paragraph">
<p>While safe mode is enabled, if you try to use a macro or variable that is not listed in <strong>Safe mode methods</strong>, the template editor displays an error message.</p>
</div>
<div class="paragraph">
<p>To view the status of safe mode in Foreman, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Provisioning</strong> tab.
Locate the <strong>Safemode rendering</strong> row to check the value.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Red_Hat_Satellite-Managing_Hosts-Configuring_Host_Collections">8. Configuring Host Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is for users of the Katello plug-in and hosts running RPM-based linux distributions.
Hosts collections work via the Pulp back end.</p>
</div>
<div class="paragraph">
<p>A host collection is a group of multiple content hosts.
This feature enables you to perform the same action on multiple hosts at once.
These actions can include the installation, removal, and update of packages and errata, change of assigned life cycle environment, and change of Content View.
You can create host collections to suit your requirements, and those of your company.
For example, group hosts in host collections by function, department, or business unit.</p>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Creating_a_Host_Collection">8.1. Creating a Host Collection</h3>
<div class="paragraph">
<p>The following procedure shows how to create host collections.</p>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Creating_a_Host_Collection-To_Create_a_Host_Collection" class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>Click <strong>New Host Collection</strong>.</p>
</li>
<li>
<p>Add the Name of the host collection.</p>
</li>
<li>
<p>Clear <strong>Unlimited Content Hosts</strong>, and enter the desired maximum number of hosts in the <strong>Limit</strong> field.</p>
</li>
<li>
<p>Add the Description of the host collection.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a host collection, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host-collection create \
--organization "<em>Your_Organization</em>" \
--name <em>hc_name</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Cloning_a_Host_Collection">8.2. Cloning a Host Collection</h3>
<div class="paragraph">
<p>The following procedure shows how to clone a host collection.</p>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Cloning_a_Host_Collection-To_Clone_a_Host_Collection" class="olist arabic">
<div class="title">To Clone a Host Collection:</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>On the left hand panel, click the host collection you want to clone.</p>
</li>
<li>
<p>Click <strong>Copy Collection</strong>.</p>
</li>
<li>
<p>Specify a name for the cloned collection.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Removing_a_Host_Collection">8.3. Removing a Host Collection</h3>
<div class="paragraph">
<p>The following procedure shows how to remove a host collection.</p>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Removing_a_Host_Collection-To_Remove_a_Host_Collection" class="olist arabic">
<div class="title">To Remove a Host Collection:</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>Choose the host collection to be removed.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.
An alert box appears:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Are you sure you want to remove host collection <em>Host Collection Name</em>?</pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Adding_a_Host_to_a_Host_Collection">8.4. Adding a Host to a Host Collection</h3>
<div class="paragraph">
<p>The following procedure shows how to add hosts to host collections.</p>
</div>
<div id="form-Red_Hat_Satellite-Managing_Hosts-Adding_Hosts_to_a_Host_Collection-Task_Prerequisites" class="paragraph">
<div class="title">Prerequisites</div>
<p>A host must be registered to Foreman to add it to a Host Collection.</p>
</div>
<div class="paragraph">
<p>Note that if you add a host to a host collection, the Foreman auditing system does not log the change.</p>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Adding_Hosts_to_a_Host_Collection-To_Add_Hosts_to_a_Host_Collection" class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>Click the host collection where the host should be added.</p>
</li>
<li>
<p>On the <strong>Hosts</strong> tab, select the <strong>Add</strong> subtab.</p>
</li>
<li>
<p>Select the hosts to be added from the table and click <strong>Add Selected</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">CLI procedure</div>
<p>To add hosts to a host collection, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host-collection add-host \
--id <em>hc_ID</em> \
--host-ids <em>host_ID1</em>,<em>host_ID2</em>...</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Removing_a_Host_from_a_Host_Collection">8.5. Removing a Host from a Host Collection</h3>
<div class="paragraph">
<p>The following procedure shows how to remove hosts from host collections.</p>
</div>
<div class="paragraph">
<p>Note that if you remove a host from a host collection, the host collection record in the database is not modified so the Foreman auditing system does not log the change.</p>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Removing_a_Host_from_a_Host_Collection-To_Remove_Hosts_from_a_Host_Collection" class="olist arabic">
<div class="title">To Remove Hosts from a Host Collection:</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>Choose the desired host collection.</p>
</li>
<li>
<p>On the <strong>Hosts</strong> tab, select the <strong>List/Remove</strong> subtab.</p>
</li>
<li>
<p>Select the hosts you want to remove from the host collection and click <strong>Remove Selected</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Configuring_Host_Collections-Adding_Content_to_a_Host_Collection">8.6. Adding Content to a Host Collection</h3>
<div class="paragraph">
<p>These steps show how to add content to host collections in Foreman.</p>
</div>
<div class="sect3">
<h4 id="sect-Red_Hat_Satellite-Managing_Hosts-Adding_Packages_to_a_Host_Collection">8.6.1. Adding Packages to a Host Collection</h4>
<div class="paragraph">
<p>The following procedure shows how to add packages to host collections.</p>
</div>
<div id="form-Red_Hat_Satellite-Managing_Hosts-Adding_Packages_to_a_Host_Collection-Task_Prerequisites" class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The content to be added should be available in one of the existing repositories or added prior to this procedure.</p>
</li>
<li>
<p>Content should be promoted to the environment where the hosts are assigned.</p>
</li>
</ul>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Adding_Packages_to_a_Host_Collection-To_Add_Packages_to_Host_Collections" class="olist arabic">
<div class="title">To Add Packages to Host Collections:</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>Click the host collection where the package should be added.</p>
</li>
<li>
<p>On the <strong>Collection Actions</strong> tab, click <strong>Package Installation, Removal, and Update</strong>.</p>
</li>
<li>
<p>To update all packages, click the <strong>Update All Packages</strong> button to use the default method.
Alternatively, select the drop-down icon to the right of the button to select a method to use.
Selecting the <strong>via remote execution - customize first</strong> menu entry will take you to the <strong>Job invocation</strong> page where you can customize the action.</p>
</li>
<li>
<p>Select the <strong>Package</strong> or <strong>Package Group</strong> radio button as required.</p>
</li>
<li>
<p>In the field provided, specify the package or package group name.
Then click:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Install</strong> - to install a new package using the default method.
Alternatively, select the drop-down icon to the right of the button and select a method to use.
Selecting the <strong>via remote execution - customize first</strong> menu entry will take you to the <strong>Job invocation</strong> page where you can customize the action.</p>
</li>
<li>
<p><strong>Update</strong> - to update an existing package in the host collection using the default method.
Alternatively, select the drop-down icon to the right of the button and select a method to use.
Selecting the <strong>via remote execution - customize first</strong> menu entry will take you to the <strong>Job invocation</strong> page where you can customize the action.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sect-Red_Hat_Satellite-Managing_Hosts-Adding_Errata_to_a_Host_Collection">8.6.2. Adding Errata to a Host Collection</h4>
<div class="paragraph">
<p>The following procedure shows how to add errata to host collections.</p>
</div>
<div id="form-Red_Hat_Satellite-Managing_Hosts-Adding_Errata_to_a_Host_Collection-Prerequisites" class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The errata to be added should be available in one of the existing repositories or added prior to this procedure.</p>
</li>
<li>
<p>Errata should be promoted to the environment where the hosts are assigned.</p>
</li>
</ul>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Adding_Errata_to_a_Host_Collection-To_Add_Errata_to_a_Host_Collection" class="olist arabic">
<div class="title">To Add Errata to a Host Collection:</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>Select the host collection where the errata should be added.</p>
</li>
<li>
<p>On the <strong>Collection Actions</strong> tab, click <strong>Errata Installation</strong>.</p>
</li>
<li>
<p>Select the errata you want to add to the host collection and click the <strong>Install Selected</strong> button to use the default method.
Alternatively, select the drop-down icon to the right of the button to select a method to use.
Selecting the <strong>via remote execution - customize first</strong> menu entry will take you to the <strong>Job invocation</strong> page where you can customize the action.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Removing_Content_from_a_Host_Collection">8.7. Removing Content from a Host Collection</h3>
<div class="paragraph">
<p>The following procedure shows how to remove packages from host collections.</p>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Removing_Content_from_a_Host_Collection-To_Remove_Content_from_a_Host_Collection" class="olist arabic">
<div class="title">To Remove Content from a Host Collection:</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collections</strong>.</p>
</li>
<li>
<p>Click the host collection where the package should be removed.</p>
</li>
<li>
<p>On the <strong>Collection Actions</strong> tab, click <strong>Package Installation, Removal, and Update</strong>.</p>
</li>
<li>
<p>Select the <strong>Package</strong> or <strong>Package Group</strong> radio button as required.</p>
</li>
<li>
<p>In the field provided, specify the package or package group name.</p>
</li>
<li>
<p>Click the <strong>Remove</strong> button to remove the package or package group using the default method.
Alternatively, select the drop-down icon to the right of the button and select a method to use.
Selecting the <strong>via remote execution - customize first</strong> menu entry will take you to the <strong>Job invocation</strong> page where you can customize the action.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Satellite-Managing_Hosts-Changing_the_Life_Cycle_Environment_or_Content_View_of_a_Host_Collection">8.8. Changing the Life Cycle Environment or Content View of a Host Collection</h3>
<div class="paragraph">
<p>The following procedure shows how to change the assigned life cycle environment or Content View of host collections.</p>
</div>
<div id="proc-Red_Hat_Satellite-Managing_Hosts-Changing_the_Life_Cycle_Environment_or_Content_View_of_a_Host_Collection-To_Change_the_Life_Cycle_Environment_or_Content_View_of_a_Host_Collection" class="olist arabic">
<div class="title">To Change the Life Cycle Environment or Content View of a Host Collection:</div>
<ol class="arabic">
<li>
<p>Click <strong>Hosts</strong> &gt; <strong>Host Collection</strong>.</p>
</li>
<li>
<p>Selection the host collection where the life cycle environment or Content View should be changed.</p>
</li>
<li>
<p>On the <strong>Collection Actions</strong> tab, click <strong>Change assigned Life Cycle Environment or Content View</strong>.</p>
</li>
<li>
<p>Select the life cycle environment to be assigned to the host collection.</p>
</li>
<li>
<p>Select the required Content View from the list.</p>
</li>
<li>
<p>Click <strong>Assign</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The changes take effect in approximately 4 hours.
To make the changes take effect immediately, on the host, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># subscription-manager refresh</pre>
</div>
</div>
<div class="paragraph">
<p>You can use remote execution to run this command on multiple hosts at the same time.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-and-setting-up-remote-jobs_managing-hosts">9. Configuring and Setting up Remote Jobs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this section as a guide to configuring Foreman to execute jobs on remote hosts.</p>
</div>
<div class="paragraph">
<p>Any command that you want to apply to a remote host must be defined as a job template.
After you have defined a job template you can execute it multiple times.</p>
</div>
<div class="sect2">
<h3 id="about-running-jobs-on-hosts_managing-hosts">9.1. About Running Jobs on Hosts</h3>
<div class="paragraph">
<p>You can run jobs on hosts remotely from Smart&#160;Proxies using shell scripts or Ansible tasks and playbooks.
This is referred to as remote execution.</p>
</div>
<div class="paragraph">
<p>For custom Ansible roles that you create, or roles that you download, you must install the package containing the roles on the Smart&#160;Proxy base operating system.
Before you can use Ansible roles, you must import the roles into Foreman from the Smart&#160;Proxy where they are installed.</p>
</div>
<div class="paragraph">
<p>Communication occurs through Smart&#160;Proxy&#160;server, which means that Foreman&#160;server does not require direct access to the target host, and can scale to manage many hosts.
Remote execution uses the SSH service that must be enabled and running on the target host.
Ensure that the remote execution Smart&#160;Proxy has access to port 22 on the target hosts.</p>
</div>
<div class="paragraph">
<p>Foreman uses ERB syntax job templates.
For more information, see <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a> in the <em>Managing Hosts</em> guide.</p>
</div>
<div class="paragraph">
<p>Several job templates for shell scripts and Ansible are included by default.
For more information, see <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#setting-up-job-templates_managing-hosts">Setting up Job Templates</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Any Smart&#160;Proxy&#160;server base operating system is a client of Foreman&#160;server&#8217;s internal Smart&#160;Proxy, and therefore this section applies to any type of host connected to Foreman&#160;server, including Smart&#160;Proxies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can run jobs on multiple hosts at once, and you can use variables in your commands for more granular control over the jobs you run.
You can use host facts and parameters to populate the variable values.</p>
</div>
<div class="paragraph">
<p>In addition, you can specify custom values for templates when you run the command.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#executing-a-remote-job_managing-hosts">Executing a Remote Job</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="remote-execution-workflow_managing-hosts">9.2. Remote Execution Workflow</h3>
<div class="paragraph">
<p>When you run a remote job on hosts, for every host, Foreman performs the following actions to find a remote execution Smart&#160;Proxy to use.</p>
</div>
<div class="paragraph">
<p>Foreman searches only for Smart&#160;Proxies that have the remote execution feature enabled.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Foreman finds the host&#8217;s interfaces that have the <strong>Remote execution</strong> check box selected.</p>
</li>
<li>
<p>Foreman finds the subnets of these interfaces.</p>
</li>
<li>
<p>Foreman finds remote execution Smart&#160;Proxies assigned to these subnets.</p>
</li>
<li>
<p>From this set of Smart&#160;Proxies, Foreman selects the Smart&#160;Proxy that has the least number of running jobs.
By doing this, Foreman ensures that the jobs load is balanced between remote execution Smart&#160;Proxies.</p>
</li>
<li>
<p>If Foreman does not find a remote execution Smart&#160;Proxy at this stage, and if the <strong>Fallback to Any Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman selects the most lightly loaded Smart&#160;Proxy from the following types of Smart&#160;Proxies that are assigned to the host:</p>
<div class="ulist">
<ul>
<li>
<p>DHCP, DNS and TFTP Smart&#160;Proxies assigned to the host&#8217;s subnets</p>
</li>
<li>
<p>DNS Smart&#160;Proxy assigned to the host&#8217;s domain</p>
</li>
<li>
<p>Realm Smart&#160;Proxy assigned to the host&#8217;s realm</p>
</li>
<li>
<p>Puppet Master Smart&#160;Proxy</p>
</li>
<li>
<p>Puppet CA Smart&#160;Proxy</p>
</li>
<li>
<p>OpenSCAP Smart&#160;Proxy</p>
</li>
</ul>
</div>
</li>
<li>
<p>If Foreman does not find a remote execution Smart&#160;Proxy at this stage, and if the <strong>Enable Global Smart&#160;Proxy</strong> setting is enabled, Foreman selects the most lightly loaded remote execution Smart&#160;Proxy from the set of all Smart&#160;Proxies in the host&#8217;s organization and location to execute a remote job.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="permissions-for-remote-execution_managing-hosts">9.3. Permissions for Remote Execution</h3>
<div class="paragraph">
<p>You can control which users can run which jobs within your infrastructure, including which hosts they can target.
The remote execution feature provides two built-in roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Remote Execution Manager</strong>: This role allows access to all remote execution features and functionality.</p>
</li>
<li>
<p><strong>Remote Execution User</strong>: This role only allows running jobs; it does not provide permission to modify job templates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can clone the Remote Execution User role and customize its filter for increased granularity.
If you adjust the filter with the <code>view_job_templates</code> permission, the user can only see and trigger jobs based on matching job templates.
You can use the <code>view_hosts</code> and <code>view_smart_proxies</code> permissions to limit which hosts or Smart&#160;Proxies are visible to the role.</p>
</div>
<div class="paragraph">
<p>The <code>execute_template_invocation</code> permission is a special permission that is checked immediately before execution of a job begins.
This permission defines which job template you can run on a particular host.
This allows for even more granularity when specifying permissions.
For more information on working with roles and permissions see <a href="https://docs.theforeman.org/2.5/Administering_Red_Hat_Satellite/index-foreman-el.html#sect-Administering-Users_and_Roles-Creating_and_Managing_Roles">Creating and Managing Roles</a> in the <em>Administering Foreman</em>.</p>
</div>
<div class="paragraph">
<p>The following example shows filters for the <code>execute_template_invocation</code> permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">name = Reboot and host.name = staging.example.com
name = Reboot and host.name ~ *.staging.example.com
name = "Restart service" and host_group.name = webservers</pre>
</div>
</div>
<div class="paragraph">
<p>The first line in this example permits the user to apply the <strong>Reboot</strong> template to one selected host.
The second line defines a pool of hosts with names ending with <strong>.staging.example.com</strong>.
The third line binds the template with a host group.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Permissions assigned to users can change over time.
If a user has already scheduled some jobs to run in the future, and the permissions have changed, this can result in execution failure because the permissions are checked immediately before job execution.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-job-template_managing-hosts">9.4. Creating a Job Template</h3>
<div class="paragraph">
<p>Use this procedure to create a job template.
To use the CLI instead of the web UI, see the <a href="#cli-creating-a-job-template_managing-hosts">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Job templates</strong>.</p>
</li>
<li>
<p>Click <strong>New Job Template</strong>.</p>
</li>
<li>
<p>Click the <strong>Template</strong> tab, and in the <strong>Name</strong> field, enter a unique name for your job template.</p>
</li>
<li>
<p>Select <strong>Default</strong> to make the template available for all organizations and locations.</p>
</li>
<li>
<p>Create the template directly in the template editor or upload it from a text file by clicking <strong>Import</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Audit Comment</strong> field, add information about the change.</p>
</li>
<li>
<p>Click the <strong>Job</strong> tab, and in the <strong>Job category</strong> field, enter your own category or select from the default categories listed in <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#default-job-template-categories_managing-hosts">Default Job Template Categories</a>.</p>
</li>
<li>
<p>Optional: In the <strong>Description Format</strong> field, enter a description template.
For example, <code>Install package %{package_name}</code>.
You can also use <code>%{template_name}</code> and <code>%{job_category}</code> in your template.</p>
</li>
<li>
<p>From the <strong>Provider Type</strong> list, select <strong>SSH</strong> for shell scripts and <strong>Ansible</strong> for Ansible tasks or playbooks.</p>
</li>
<li>
<p>Optional: In the <strong>Timeout to kill</strong> field, enter a timeout value to terminate the job if it does not complete.</p>
</li>
<li>
<p>Optional: Click <strong>Add Input</strong> to define an input parameter.
Parameters are requested when executing the job and do not have to be defined in the template.
For examples, see the <strong>Help</strong> tab.</p>
</li>
<li>
<p>Optional: Click <strong>Foreign input set</strong> to include other templates in this job.</p>
</li>
<li>
<p>Optional: In the <strong>Effective user</strong> area, configure a user if the command cannot use the default <code>remote_execution_effective_user</code> setting.</p>
</li>
<li>
<p>Optional: If this template is a snippet to be included in other templates, click the <strong>Type</strong> tab and select <strong>Snippet</strong>.</p>
</li>
<li>
<p>Click the <strong>Location</strong> tab and add the locations where you want to use the template.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organizations where you want to use the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can extend and customize job templates by including other templates in the template syntax.
For more information, see the appendices in the <em>Managing Hosts</em> guide.</p>
</div>
<div id="cli-creating-a-job-template_managing-hosts" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>To create a job template using a template-definition file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-template create \
--file "<em>path_to_template_file</em>" \
--name "<em>template_name</em>" \
--provider-type SSH \
--job-category "<em>category_name</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-fallback-to-any-smartproxy-setting_managing-hosts">9.5. Configuring the Fallback to Any Smart&#160;Proxy Remote Execution Setting in Foreman</h3>
<div class="paragraph">
<p>You can enable the <strong>Fallback to Any Smart&#160;Proxy</strong> setting to configure Foreman to search for remote execution Smart&#160;Proxies from the list of Smart&#160;Proxies that are assigned to hosts.
This can be useful if you need to run remote jobs on hosts that have no subnets configured or if the hosts' subnets are assigned to Smart&#160;Proxies that do not have the remote execution feature enabled.</p>
</div>
<div class="paragraph">
<p>If the <strong>Fallback to Any Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded Smart&#160;Proxy from the set of all Smart&#160;Proxies assigned to the host, such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHCP, DNS and TFTP Smart&#160;Proxies assigned to the host&#8217;s subnets</p>
</li>
<li>
<p>DNS Smart&#160;Proxy assigned to the host&#8217;s domain</p>
</li>
<li>
<p>Realm Smart&#160;Proxy assigned to the host&#8217;s realm</p>
</li>
<li>
<p>Puppet Master Smart&#160;Proxy</p>
</li>
<li>
<p>Puppet CA Smart&#160;Proxy</p>
</li>
<li>
<p>OpenSCAP Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click <strong>RemoteExecution</strong>.</p>
</li>
<li>
<p>Configure the <strong>Fallback to Any Smart&#160;Proxy</strong> setting.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">CLI procedure</div>
<p>Enter the <code>hammer settings set</code> command on Foreman to configure the <strong>Fallback to Any Smart&#160;Proxy</strong> setting.
For example, to set the value to <code>true</code>, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name=remote_execution_fallback_proxy --value=true</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-global-smartproxy-remote-execution-setting_managing-hosts">9.6. Configuring the Global Smart&#160;Proxy Remote Execution Setting in Foreman</h3>
<div class="paragraph">
<p>By default, Foreman searches for remote execution Smart&#160;Proxies in hosts' organizations and locations regardless of whether Smart&#160;Proxies are assigned to hosts' subnets or not.
You can disable the <strong>Enable Global Smart&#160;Proxy</strong> setting if you want to limit the search to the Smart&#160;Proxies that are assigned to hosts' subnets.</p>
</div>
<div class="paragraph">
<p>If the <strong>Enable Global Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded remote execution Smart&#160;Proxy from the set of all Smart&#160;Proxies in the host&#8217;s organization and location to execute a remote job.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click <strong>RemoteExection</strong>.</p>
</li>
<li>
<p>Configure the <strong>Enable Global Smart&#160;Proxy</strong> setting.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the <code>hammer settings set</code> command on Foreman to configure the <code>Enable Global Smart&#160;Proxy</code> setting.
For example, to set the value to <code>true</code>, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name=remote_execution_global_proxy --value=true</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-an-alternative-directory-to-execute-remote-jobs-on-hosts_managing-hosts">9.7. Configuring Foreman to Use an Alternative Directory to Execute Remote Jobs on Hosts</h3>
<div class="paragraph">
<p>By default, Foreman uses the <code>/var/tmp</code> directory on the client system to execute the remote execution jobs.
If the client system has <code>noexec</code> set for the <code>/var/</code> volume or file system, you must configure Foreman to use an alternative directory because otherwise the remote execution job fails since the script cannot be run.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new directory, for example <em>new_place</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /<em>remote_working_dir</em></pre>
</div>
</div>
</li>
<li>
<p>Copy the SELinux context from the default <code>var</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chcon --reference=/var <em>/remote_working_dir</em></pre>
</div>
</div>
</li>
<li>
<p>Configure the system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-plugin-remote-execution-ssh-remote-working-dir <em>/remote_working_dir</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ssh-keys-for-remote-execution-overview_managing-hosts">9.8. Distributing SSH Keys for Remote Execution</h3>
<div class="paragraph">
<p>To use SSH keys for authenticating remote execution connections, you must distribute the public SSH key from Smart&#160;Proxy to its attached hosts that you want to manage.
Ensure that the SSH service is enabled and running on the hosts.
Configure any network or host-based firewalls to enable access to port 22.</p>
</div>
<div class="paragraph">
<p>Use one of the following methods to distribute the public SSH key from Smart&#160;Proxy to target hosts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#distributing-ssh-keys-for-remote-execution-manually_managing-hosts">Distributing SSH Keys for Remote Execution Manually</a>.</p>
</li>
<li>
<p><a href="#using-the-api-to-obtain-ssh-keys-for-remote-execution_managing-hosts">Using the Foreman API to Obtain SSH Keys for Remote Execution</a>.</p>
</li>
<li>
<p><a href="#configuring-a-kickstart-template-to-distribute-ssh-keys-during-provisioning_managing-hosts">Configuring a Kickstart Template to Distribute SSH Keys during Provisioning</a>.</p>
</li>
<li>
<p>For new Foreman hosts, you can deploy SSH keys to Foreman hosts during registration using the global registration template.
For more information, see <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#registering-a-host_managing-hosts">Registering a Host to Foreman Using the Global Registration Template</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Foreman distributes SSH keys for the remote execution feature to the hosts provisioned from Foreman by default.</p>
</div>
<div class="paragraph">
<p>If the hosts are running on Amazon Web Services, enable password authentication.
For more information, see <a href="https://aws.amazon.com/premiumsupport/knowledge-center/new-user-accounts-linux-instance" class="bare">https://aws.amazon.com/premiumsupport/knowledge-center/new-user-accounts-linux-instance</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="distributing-ssh-keys-for-remote-execution-manually_managing-hosts">9.9. Distributing SSH Keys for Remote Execution Manually</h3>
<div class="paragraph">
<p>To distribute SSH keys manually, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command on Smart&#160;Proxy.
Repeat for each target host you want to manage:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh-copy-id -i ~foreman-proxy/.ssh/id_rsa_foreman_proxy.pub <em>root@target.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>To confirm that the key was successfully copied to the target host, enter the following command on Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh -i ~foreman-proxy/.ssh/id_rsa_foreman_proxy <em>root@target.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-the-api-to-obtain-ssh-keys-for-remote-execution_managing-hosts">9.10. Using the Foreman API to Obtain SSH Keys for Remote Execution</h3>
<div class="paragraph">
<p>To use the Foreman API to download the public key from Smart&#160;Proxy, complete this procedure on each target host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the target host, create the <code>~/.ssh</code> directory to store the SSH key:</p>
<div class="listingblock">
<div class="content">
<pre># mkdir ~/.ssh</pre>
</div>
</div>
</li>
<li>
<p>Download the SSH key from Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl https://<em>smartproxy.example.com</em>:8443/ssh/pubkey &gt;&gt; ~/.ssh/authorized_keys</pre>
</div>
</div>
</li>
<li>
<p>Configure permissions for the <code>~/.ssh</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre># chmod 700 ~/.ssh</pre>
</div>
</div>
</li>
<li>
<p>Configure permissions for the <code>authorized_keys</code> file:</p>
<div class="listingblock">
<div class="content">
<pre># chmod 600 ~/.ssh/authorized_keys</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-kickstart-template-to-distribute-ssh-keys-during-provisioning_managing-hosts">9.11. Configuring a Kickstart Template to Distribute SSH Keys during Provisioning</h3>
<div class="paragraph">
<p>You can add a <code>remote_execution_ssh_keys</code> snippet to your custom kickstart template to deploy SSH Keys to hosts during provisioning.
Kickstart templates that Foreman ships include this snippet by default.
Therefore, Foreman copies the SSH key for remote execution to the systems during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To include the public key in newly-provisioned hosts, add the following snippet to the Kickstart template that you use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= snippet 'remote_execution_ssh_keys' %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-keytab-for-kerberos-ticket-granting-tickets_managing-hosts">9.12. Configuring a keytab for Kerberos Ticket Granting Tickets</h3>
<div class="paragraph">
<p>Use this procedure to configure Foreman to use a keytab to obtain Kerberos ticket granting tickets.
If you do not set up a keytab, you must manually retrieve tickets.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the ID of the <code>foreman-proxy</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id -u foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Modify the <code>umask</code> value so that new files have the permissions <code>600</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># umask 077</pre>
</div>
</div>
</li>
<li>
<p>Create the directory for the keytab:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p "/var/kerberos/krb5/user/<em>USER_ID</em>"</pre>
</div>
</div>
</li>
<li>
<p>Create a keytab or copy an existing keytab to the directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp <em>your_client.keytab</em> /var/kerberos/krb5/user/<em>USER_ID</em>/client.keytab</pre>
</div>
</div>
</li>
<li>
<p>Change the directory owner to the <code>foreman-proxy</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman-proxy:foreman-proxy "/var/kerberos/krb5/user/<em>USER_ID</em>"</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the keytab file is read-only:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod -wx "/var/kerberos/krb5/user/<em>USER_ID</em>/client.keytab"</pre>
</div>
</div>
</li>
<li>
<p>Restore the SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -RvF /var/kerberos/krb5</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-kerberos-authentication-for-remote-execution_managing-hosts">9.13. Configuring Kerberos Authentication for Remote Execution</h3>
<div class="paragraph">
<p>You can use Kerberos authentication to establish an SSH connection for remote execution on Foreman hosts.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Enroll Foreman&#160;server on the Kerberos server</p>
</li>
<li>
<p>Enroll the Foreman target host on the Kerberos server</p>
</li>
<li>
<p>Configure and initialize a Kerberos user account for remote execution</p>
</li>
<li>
<p>Ensure that the foreman-proxy user on Foreman has a valid Kerberos ticket granting ticket</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To install and enable Kerberos authentication for remote execution, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman \
 --foreman-proxy-plugin-remote-execution-ssh-ssh-kerberos-auth true</pre>
</div>
</div>
</li>
<li>
<p>To edit the default user for remote execution, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>RemoteExecution</strong> tab.
In the <strong>SSH User</strong> row, edit the second column and add the user name for the Kerberos account.</p>
</li>
<li>
<p>Navigate to <strong>remote_execution_effective_user</strong> and edit the second column to add the user name for the Kerberos account.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To confirm that Kerberos authentication is ready to use, run a remote job on the host.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-job-templates_managing-hosts">9.14. Setting up Job Templates</h3>
<div class="paragraph">
<p>Foreman provides default job templates that you can use for executing jobs.
To view the list of job templates, navigate to <strong>Hosts</strong> &gt; <strong>Job templates</strong>.
If you want to use a template without making changes, proceed to <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#executing-a-remote-job_managing-hosts">Executing a Remote Job</a>.</p>
</div>
<div class="paragraph">
<p>You can use default templates as a base for developing your own.
Default job templates are locked for editing.
Clone the template and edit the clone.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To clone a template, in the <strong>Actions</strong> column, select <strong>Clone</strong>.</p>
</li>
<li>
<p>Enter a unique name for the clone and click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Job templates use the Embedded Ruby (ERB) syntax.
For more information about writing templates, see the <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a> in the <em>Managing Hosts</em> guide.</p>
</div>
<div class="paragraph">
<div class="title">Ansible Considerations</div>
<p>To create an Ansible job template, use the following procedure and instead of ERB syntax, use YAML syntax.
Begin the template with <code>---</code>.
You can embed an Ansible playbook YAML file into the job template body.
You can also add ERB syntax to customize your YAML Ansible template.
You can also import Ansible playbooks in Foreman.
For more information, see <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#Synchronizing_Templates_Repositories">Synchronizing Repository Templates</a> in the <em>Managing Hosts</em> guide.</p>
</div>
<div class="paragraph">
<div class="title">Parameter Variables</div>
<p>At run time, job templates can accept parameter variables that you define for a host.
Note that only the parameters visible on the <strong>Parameters</strong> tab at the host&#8217;s edit page can be used as input parameters for job templates.
If you do not want your Ansible job template to accept parameter variables at run time, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Ansible</strong> tab.
In the <strong>Top level Ansible variables</strong> row, change the <strong>Value</strong> parameter to <strong>No</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="executing-a-remote-job_managing-hosts">9.15. Executing a Remote Job</h3>
<div class="paragraph">
<p>You can execute a job that is based on a job template against one or more hosts.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the web UI, see the <a href="#cli-executing-a-remote-job_managing-hosts">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and select the target hosts on which you want to execute a remote job.
You can use the search field to filter the host list.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Schedule Remote Job</strong>.</p>
</li>
<li>
<p>On the <strong>Job invocation</strong> page, define the main job settings:</p>
</li>
<li>
<p>Select the <strong>Job category</strong> and the <strong>Job template</strong> you want to use.</p>
</li>
<li>
<p>Optional: Select a stored search string in the <strong>Bookmark</strong> list to specify the target hosts.</p>
</li>
<li>
<p>Optional: Further limit the targeted hosts by entering a <strong>Search query</strong>.
The <strong>Resolves to</strong> line displays the number of hosts affected by your query.
Use the refresh button to recalculate the number after changing the query.
The preview icon lists the targeted hosts.</p>
</li>
<li>
<p>The remaining settings depend on the selected job template.
See <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#creating-a-job-template_managing-hosts">Creating a Job Template</a> for information on adding custom parameters to a template.</p>
</li>
<li>
<p>Optional: To configure advanced settings for the job, click <strong>Display advanced fields</strong>.
Some of the advanced settings depend on the job template, the following settings are general:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Effective user</strong> defines the user for executing the job, by default it is the SSH user.</p>
</li>
<li>
<p><strong>Concurrency level</strong> defines the maximum number of jobs executed at once, which can prevent overload of systems' resources in a case of executing the job on a large number of hosts.</p>
</li>
<li>
<p><strong>Timeout to kill</strong> defines time interval in seconds after which the job should be killed, if it is not finished already.
A task which could not be started during the defined interval, for example, if the previous task took too long to finish, is canceled.</p>
</li>
<li>
<p><strong>Type of query</strong> defines when the search query is evaluated.
This helps to keep the query up to date for scheduled tasks.</p>
</li>
<li>
<p><strong>Execution ordering</strong> determines the order in which the job is executed on hosts: alphabetical or randomized.</p>
<div class="paragraph">
<p><strong>Concurrency level</strong> and <strong>Timeout to kill</strong> settings enable you to tailor job execution to fit your infrastructure hardware and needs.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>To run the job immediately, ensure that <strong>Schedule</strong> is set to <strong>Execute now</strong>.
You can also define a one-time future job, or set up a recurring job.
For recurring tasks, you can define start and end dates, number and frequency of runs.
You can also use cron syntax to define repetition.
For more information about cron, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-automating_system_tasks">Automating System Tasks</a> section of the Red Hat Enterprise Linux 7 <em>System Administrator&#8217;s Guide</em>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
This displays the <strong>Job Overview</strong> page, and when the job completes, also displays the status of the job.</p>
</li>
</ol>
</div>
<div id="cli-executing-a-remote-job_managing-hosts" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command on Foreman:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name=remote_execution_global_proxy --value=false</pre>
</div>
</div>
<div class="paragraph">
<p>To execute a remote job with custom parameters, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the ID of the job template you want to use:</p>
<div class="listingblock">
<div class="content">
<pre># hammer job-template list</pre>
</div>
</div>
</li>
<li>
<p>Show the template details to see parameters required by your template:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-template info --id <em>template_ID</em></pre>
</div>
</div>
</li>
<li>
<p>Execute a remote job with custom parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-invocation create \
--job-template "<em>template_name</em>" \
--inputs <em>key1</em>="<em>value</em>",<em>key2</em>="<em>value</em>",... \
--search-query "<em>query</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>query</em> with the filter expression that defines hosts, for example <code>"name ~ rex01"</code>.
For more information about executing remote commands with hammer, enter <code>hammer job-template --help</code> and <code>hammer job-invocation --help</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-remote-jobs_managing-hosts">9.16. Monitoring Jobs</h3>
<div class="paragraph">
<p>You can monitor the progress of the job while it is running.
This can help in any troubleshooting that may be required.</p>
</div>
<div class="paragraph">
<p>Ansible jobs run on batches of 100 hosts, so you cannot cancel a job running on a specific host.
A job completes only after the Ansible playbook runs on all hosts in the batch.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the Job page.
This page is automatically displayed if you triggered the job with the <code>Execute now</code> setting.
To monitor scheduled jobs, navigate to <strong>Monitor</strong> &gt; <strong>Jobs</strong> and select the job run you wish to inspect.</p>
</li>
<li>
<p>On the Job page, click the <strong>Hosts</strong> tab.
This displays the list of hosts on which the job is running.</p>
</li>
<li>
<p>In the <strong>Host</strong> column, click the name of the host that you want to inspect.
This displays the <strong>Detail of Commands</strong> page where you can monitor the job execution in real time.</p>
</li>
<li>
<p>Click <strong>Back to Job</strong> at any time to return to the <strong>Job Details</strong> page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">CLI procedure</div>
<p>To monitor the progress of a job while it is running, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the ID of a job:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-invocation list</pre>
</div>
</div>
</li>
<li>
<p>Monitor the job output:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-invocation output \
--id <em>job_ID</em> \
--host <em>host_name</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: to cancel a job, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-invocation cancel \
--id <em>job_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Synchronizing_Templates_Repositories">9.17. Synchronizing Template Repositories</h3>
<div class="paragraph">
<p>In Foreman, you can synchronize repositories of job templates, provisioning templates, report templates, and partition table templates between Foreman&#160;server and a version control system or local directory.
In this chapter, a Git repository is used for demonstration purposes.</p>
</div>
<div class="paragraph">
<p>This section details the workflow for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>installing and configuring the TemplateSync plug-in</p>
</li>
<li>
<p>performing exporting and importing tasks</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_enabling_the_templatesync_plug_in">9.17.1. Enabling the TemplateSync plug-in</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To enable the plug-in on your Foreman&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-templates</pre>
</div>
</div>
</li>
<li>
<p>To verify that the plug-in is installed correctly, ensure <strong>Administer</strong> &gt; <strong>Settings</strong> includes the <strong>TemplateSync</strong> menu.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-templatesync-plug-in">9.17.2. Configuring the TemplateSync plug-in</h4>
<div class="paragraph">
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>TemplateSync</strong> to configure the plug-in.
The following table explains the attributes behavior.
Note that some attributes are used only for importing or exporting tasks.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Synchronizing Templates Plug-in configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">API parameter name</th>
<th class="tableblock halign-left valign-top">Meaning on importing</th>
<th class="tableblock halign-left valign-top">Meaning on exporting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associate</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>associate</code></p>
</div>
<div class="paragraph">
<p>Accepted values: <code>always</code>, <code>new</code>, <code>never</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associates templates with OS, Organization, and Location based on metadata.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branch</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>branch</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the default branch in Git repository to read from.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the default branch in Git repository to write to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dirname</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>dirname</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies  the subdirectory under the repository to read from.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the subdirectory under the repository to write to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filter</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>filter</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Imports only templates with names that match this regular expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exports only templates with names that match this regular expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Force import</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>force</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Imported templates overwrite locked templates with the same name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lock templates</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>lock</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Do not overwrite existing templates when you import a new template with the same name, unless <strong>Force import</strong> is enabled.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata export mode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>metadata_export_mode</code></p>
</div>
<div class="paragraph">
<p>Accepted values: <code>refresh</code>, <code>keep</code>, <code>remove</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines how metadata is handled when exporting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Refresh</strong> — remove existing metadata from the template content and generate new metadata based on current assignments and attributes.</p>
</li>
<li>
<p><strong>Keep</strong> — retain the existing metadata.</p>
</li>
<li>
<p><strong>Remove</strong> — export template without metadata.
Useful if you want to add metadata manually.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negate</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>negate</code></p>
</div>
<div class="paragraph">
<p>Accepted values: <code>true</code>, <code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Imports templates ignoring the filter attribute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exports templates ignoring the filter attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>prefix</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds specified string to the beginning of the template if the template name does not start with the prefix already.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repo</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>repo</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the path to the repository to synchronize from.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the path to a repository to export to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verbosity</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>verbose</code></p>
</div>
<div class="paragraph">
<p>Accepted values: <code>true</code>, <code>false</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables writing verbose messages to the logs for this action.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_importing_and_exporting_templates">9.17.3. Importing and Exporting Templates</h4>
<div class="paragraph">
<p>You can import and export templates using the Foreman web UI, Hammer CLI, or Foreman API.
Foreman API calls use the role-based access control system, which enables the tasks to be executed as any user.
You can synchronize templates with a version control system, such as Git, or a local directory.</p>
</div>
<div class="sect4">
<h5 id="_importing_templates">Importing Templates</h5>
<div class="paragraph">
<p>You can import templates from a repository of your choice.
You can use different protocols to point to your repository, for example <code>/tmp/dir</code>, <code>git://example.com</code>, <code>https://example.com</code>, and <code>ssh://example.com</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Each template must contain the location and organization that the template belongs to.
This applies to all template types.
Before you import a template, ensure that you add the following section to the template:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%#
kind: provision
name: <em>My Kickstart File</em>
oses:
- RedHat 7
- RedHat 6
locations:
- <em>First Location</em>
- <em>Second Location</em>
organizations:
- <em>Default Organization</em>
- <em>Extra Organization</em>
%&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Sync Templates</strong>.</p>
</li>
<li>
<p>Click <strong>Import</strong>.</p>
</li>
<li>
<p>Each field is populated with values configured in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>TemplateSync</strong>.
Change the values as required for the templates you want to import.
For more information about each field, see <a href="#configuring-the-templatesync-plug-in">Configuring the TemplateSync plug-in</a>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Foreman web UI displays the status of the import.
The status is not persistent; if you leave the status page, you cannot return to it.</p>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To import a template from a repository, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer import-templates \
    --prefix '[<em>Custom Index</em>] ' \
    --filter '.*<em>Template Name$</em>' \
    --repo <em>https://github.com/examplerepo/exampledirectory</em> \
    --branch <em>my_branch</em> \
    --organization 'Default Organization'</pre>
</div>
</div>
<div class="paragraph">
<p>For better indexing and management of your templates, use <code>--prefix</code> to set a category for your templates.
To select certain templates from a large repository, use <code>--filter</code> to define the title of the templates that you want to import.
For example <code>--filter '.*Ansible Default$'</code> imports various Ansible Default templates.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_exporting_templates">Exporting Templates</h5>
<div class="paragraph">
<p>You can export templates to a version control server, such as a Git repository.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Sync Templates</strong>.</p>
</li>
<li>
<p>Click <strong>Export</strong>.</p>
</li>
<li>
<p>Each field is populated with values configured in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>TemplateSync</strong>.
Change the values as required for the templates you want to export.
For more information about each field, see <a href="#configuring-the-templatesync-plug-in">Configuring the TemplateSync plug-in</a>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Foreman web UI displays the status of the export.
The status is not persistent; if you leave the status page, you cannot return to it.</p>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Clone a local copy of your Git repository:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ git clone https://github.com/theforeman/community-templates <em>/custom/templates</em></pre>
</div>
</div>
</li>
<li>
<p>Change the owner of your local directory to the <code>foreman</code> user, and change the SELinux context with the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman:foreman <em>/custom/templates</em>
# chcon -R -t httpd_sys_rw_content_t <em>/custom/templates</em></pre>
</div>
</div>
</li>
<li>
<p>To export the templates to your local repository, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">hammer export-templates --organization 'Default Organization' --repo <em>/custom/templates</em></pre>
</div>
</div>
<div class="paragraph">
<p>When exporting templates, avoid temporary directories like <code>/tmp</code> or <code>/var/tmp</code> because the backend service runs with systemd private temporary directories.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_synchronizing_templates_using_the_foreman_api">Synchronizing Templates Using the Foreman API</h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Each template must contain the location and organization that the template belongs to.
This applies to all template types.
Before you import a template, ensure that you add the following section to the template:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%#
kind: provision
name: <em>My Kickstart File</em>
oses:
- RedHat 7
- RedHat 6
locations:
- <em>First Location</em>
- <em>Second Location</em>
organizations:
- <em>Default Organization</em>
- <em>Extra Organization</em>
%&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure a version control system that uses SSH authorization, for example gitosis, gitolite, or git daemon.</p>
</li>
<li>
<p>Configure the TemplateSync plug-in settings on a <strong>TemplateSync</strong> tab.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change the <strong>Branch</strong> setting to match the target branch on a Git server.</p>
</li>
<li>
<p>Change the <strong>Repo</strong> setting to match the Git repository.
For example, for the repository located in <code>git@git.example.com/templates.git</code> set the setting into <code>ssh://git@git.example.com/templates.git</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Accept Git SSH host key as the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre># sudo -u foreman ssh <em>git.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the <code>Permission denied, please try again.</code> message in the output, which is expected, because the SSH connection cannot succeed yet.</p>
</div>
</li>
<li>
<p>Create an SSH key pair if you do not already have it.
Do not specify a passphrase.</p>
<div class="listingblock">
<div class="content">
<pre># sudo -u foreman ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Configure your version control server with the public key from your Foreman, which resides in <code>/usr/share/foreman/.ssh/id_rsa.pub</code>.</p>
</li>
<li>
<p>Export templates from your Foreman&#160;server to the version control repository specified in the <strong>TemplateSync</strong> menu:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl -H "Accept:application/json,version=2" \
-H "Content-Type:application/json" \
-u <em>login</em>:<em>password</em> \
-k https://_foreman.example.com/api/v2/templates/export \
-X POST

{"message":"Success"}</pre>
</div>
</div>
</li>
<li>
<p>Import templates to Foreman&#160;server after their content was changed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl -H "Accept:application/json,version=2" \
-H "Content-Type:application/json" \
-u <em>login</em>:<em>password</em> \
-k https://_foreman.example.com/api/v2/templates/import \
-X POST

{“message”:”Success”}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that templates provided by Foreman are locked and you cannot import them by default.
To overwrite this behavior, change the <code>Force import</code> setting in the <strong>TemplateSync</strong> menu to <code>yes</code> or add the <code>force</code> parameter <code>-d '{ "force": "true" }’</code> to the import command.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_synchronizing_templates_with_a_local_directory_using_the_foreman_api">Synchronizing Templates with a Local Directory Using the Foreman API</h5>
<div class="paragraph">
<p>Synchronizing templates with a local directory is useful if you have configured a version control repository in the local directory.
That way, you can edit templates and track the history of edits in the directory.
You can also synchronize changes to Foreman&#160;server after editing the templates.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Each template must contain the location and organization that the template belongs to.
This applies to all template types.
Before you import a template, ensure that you add the following section to the template:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%#
kind: provision
name: <em>My Kickstart File</em>
oses:
- RedHat 7
- RedHat 6
locations:
- <em>First Location</em>
- <em>Second Location</em>
organizations:
- <em>Default Organization</em>
- <em>Extra Organization</em>
%&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the directory where templates are stored and apply appropriate permissions and SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre># mkdir -p <em>/usr/share/templates_dir/</em>
# chown foreman <em>/usr/share/templates_dir/</em>
# chcon -t httpd_sys_rw_content_t <em>/usr/share/templates_dir/</em> -R</pre>
</div>
</div>
</li>
<li>
<p>Change the <strong>Repo</strong> setting on the <strong>TemplateSync</strong> tab to match the export directory <code>/usr/share/templates_dir/</code>.</p>
</li>
<li>
<p>Export templates from your Foreman&#160;server to a local directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl -H "Accept:application/json,version=2" \
-H "Content-Type:application/json" \
-u <em>login</em>:<em>password</em> \
-k https://_foreman.example.com/api/v2/templates/export \
-X POST \

{"message":"Success"}</pre>
</div>
</div>
</li>
<li>
<p>Import templates to Foreman&#160;server after their content was changed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl -H "Accept:application/json,version=2" \
-H "Content-Type:application/json" \
-u <em>login</em>:<em>password</em> \
-k https://_foreman.example.com/api/v2/templates/import \
-X POST

{“message”:”Success”}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that templates provided by Foreman are locked and you cannot import them by default.
To overwrite this behavior, change the <code>Force import</code> setting in the <strong>TemplateSync</strong> menu to <code>yes</code> or add the <code>force</code> parameter <code>-d '{ "force": "true" }’</code> to the import command.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can override default API settings by specifying them in the request with the <code>-d</code> parameter.
The following example exports templates to the <code>git.example.com/templates</code> repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl -H "Accept:application/json,version=2" \
-H "Content-Type:application/json" \
-u login:password \
-k https://foreman.example.com/api/v2/templates/export \
-X POST \
-d "{\"repo\":\"git.example.com/templates\"}"</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_git_configuration">9.17.4. Advanced Git Configuration</h4>
<div class="paragraph">
<p>You can perform additional Git configuration for the TemplateSync plug-in using the command line or editing the <code>.gitconfig</code> file.</p>
</div>
<div class="paragraph">
<div class="title">Accepting a self-signed Git certificate</div>
<p>If you are using a self-signed certificate authentication on your Git server, validate the certificate with the <code>git config http.sslCAPath</code> command.</p>
</div>
<div class="paragraph">
<p>For example, the following command verifies a self-signed certificate stored in <code>/cert/cert.pem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># sudo -u foreman git config --global http.sslCAPath <em>cert/cert.pem</em></pre>
</div>
</div>
<div class="paragraph">
<p>For a complete list of advanced options, see the <code>git-config</code> manual page.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uninstalling_the_plug_in">9.17.5. Uninstalling the plug-in</h4>
<div class="paragraph">
<p>To avoid errors after removing the foreman_templates plugin:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable the plug-in using the Foreman installer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --no-enable-foreman-plugin-templates</pre>
</div>
</div>
</li>
<li>
<p>Clean custom data of the plug-in.
The command does not affect any templates that you created.</p>
<div class="listingblock">
<div class="content">
<pre># foreman-rake templates:cleanup</pre>
</div>
</div>
</li>
<li>
<p>Uninstall the plug-in:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum remove foreman-plugin-templates</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference">Appendix A: Template Writing Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Embedded Ruby (ERB) is a tool for generating text files based on templates that combine plain text with Ruby code.
Foreman uses ERB syntax in the following cases:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Provisioning templates</dt>
<dd>
<p>For more information, see <a href="https://docs.theforeman.org/2.5/Provisioning_Guide/index-foreman-el.html#creating-provisioning-templates_provisioning">Creating Provisioning Templates</a> in the <em>Provisioning Guide</em>.</p>
</dd>
<dt class="hdlist1">Remote execution job templates</dt>
<dd>
<p>For more information, see <a href="#configuring-and-setting-up-remote-jobs_managing-hosts">Configuring and Setting up Remote Jobs</a>.</p>
</dd>
<dt class="hdlist1">Report templates</dt>
<dd>
<p>For more information, see <a href="#using_report_templates">Using Report Templates to Monitor Hosts</a>.</p>
</dd>
<dt class="hdlist1">Templates for partition tables</dt>
<dd>
<p>For more information, see <a href="https://docs.theforeman.org/2.5/Provisioning_Guide/index-foreman-el.html#creating-partition-tables_provisioning">Creating Partition Tables</a> in the <em>Provisioning Guide</em>.</p>
</dd>
<dt class="hdlist1">Smart Variables</dt>
<dd>
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.10/html/puppet_guide/chap-red_hat_satellite-puppet_guide-adding_puppet_modules_to_red_hat_satellite_6#sect-Red_Hat_Satellite-Puppet_Guide-Adding_Puppet_Modules_to_Red_Hat_Satellite_6-Configuring_Smart_Variables">Configuring Smart Variables</a> in the <em>Puppet Guide</em>.</p>
</dd>
<dt class="hdlist1">Smart Class Parameters</dt>
<dd>
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.10/html/puppet_guide/chap-red_hat_satellite-puppet_guide-adding_puppet_modules_to_red_hat_satellite_6#sect-Red_Hat_Satellite-Puppet_Guide-Adding_Puppet_Modules_to_Red_Hat_Satellite_6-Configuring_Smart_Class_Parameters">Configuring Smart Class Parameters</a> in the <em>Puppet Guide</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This section provides an overview of Foreman-specific macros and variables that can be used in ERB templates along with some usage examples.
Note that the default templates provided by Foreman (<strong>Hosts</strong> &gt; <strong>Provisioning templates</strong>, <strong>Hosts</strong> &gt; <strong>Job templates</strong>, <strong>Monitor</strong> &gt; <strong>Report Templates</strong> ) also provide a good source of ERB syntax examples.</p>
</div>
<div class="paragraph">
<p>When provisioning a host or running a remote job, the code in the ERB is executed and the variables are replaced with the host specific values.
This process is referred to as <strong>rendering</strong>.
Foreman&#160;server has the safemode rendering option enabled by default, which prevents any harmful code being executed from templates.</p>
</div>
<div class="sect2">
<h3 id="appe-Red_Hat_Satellite-Managing_Hosts-Template_Writing_Reference-ui">Accessing the Template Writing Reference in the Foreman web UI</h3>
<div class="paragraph">
<p>You can access the template writing reference document in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Foreman web UI.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
<li>
<p>Click the <strong>Templates DSL</strong> link in the Support section.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Managing_Hosts-Writing_ERB_Templates">Writing ERB Templates</h3>
<div class="paragraph">
<p>The following tags are the most important and commonly used in ERB templates:</p>
</div>
<div class="paragraph">
<div class="title">&lt;%  %&gt;</div>
<p>All Ruby code is enclosed within <code>&lt;%  %&gt;</code> in an ERB template.
The code is executed when the template is rendered.
It can contain Ruby control flow structures as well as Foreman-specific macros and variables.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;% if @host.operatingsystem.family == "Redhat" &amp;&amp; @host.operatingsystem.major.to_i &gt; 6 -%&gt;
systemctl &lt;%= input("action") %&gt; &lt;%= input("service") %&gt;
&lt;% else -%&gt;
service &lt;%= input("service") %&gt; &lt;%= input("action") %&gt;
&lt;% end -%&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that this template silently performs an action with a service and returns nothing at the output.</p>
</div>
<div class="paragraph">
<div class="title">&lt;%=  %&gt;</div>
<p>This provides the same functionality as <code>&lt;%  %&gt;</code>  but when the template is executed, the code output is inserted into the template.
This is useful for variable substitution, for example:</p>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>echo &lt;%= @host.name %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example rendering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>host.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;% server_name = @host.fqdn %&gt;
&lt;%= server_name %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example rendering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>host.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you enter an incorrect variable, no output is returned.
However, if you try to call a method on an incorrect variable, the following error message returns:</p>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= @<em>example_incorrect_variable</em>.fqdn -%&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example rendering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>undefined method `fqdn' for nil:NilClass</pre>
</div>
</div>
<div class="paragraph">
<div class="title">&lt;%  -%&gt;, &lt;%=  -%&gt;</div>
<p>By default, a newline character is inserted after a Ruby block if it is closed at the end of a line:</p>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%= "line1" %&gt;
&lt;%= "line2" %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example rendering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>line1
line2</pre>
</div>
</div>
<div class="paragraph">
<p>To change the default behavior, modify the enclosing mark with <code>-%&gt;</code>:</p>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%= "line1" -%&gt;
&lt;%= "line2" %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example rendering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>line1line2</pre>
</div>
</div>
<div class="paragraph">
<p>This is used to reduce the number of lines, where Ruby syntax permits, in rendered templates.
White spaces in ERB tags are ignored.</p>
</div>
<div class="paragraph">
<p>An example of how this would be used in a report template to remove unnecessary newlines between a FQDN and IP address:</p>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%= @host.fqdn -%&gt;
&lt;%= @host.ip -%&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example rendering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>host.example.com10.10.181.216</em></pre>
</div>
</div>
<div class="paragraph">
<div class="title">&lt;%#  %&gt;</div>
<p>Encloses a comment that is ignored during template rendering:</p>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%# A comment %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This generates no output.</p>
</div>
<div class="paragraph">
<div class="title">Indentation in ERB templates</div>
<p>Because of the varying lengths of the ERB tags, indenting the ERB syntax might seem messy.
ERB syntax ignore white space.
One method of handling the indentation is to declare the ERB tag at the beginning of each new line and then use white space within the ERB tag to outline the relationships within the syntax, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%- load_hosts.each do |host| -%&gt;
&lt;%-   if host.build? %&gt;
&lt;%=     host.name %&gt; build is in progress
&lt;%-   end %&gt;
&lt;%- end %&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Managing_Hosts-Troubleshooting_ERB_Templates">Troubleshooting ERB Templates</h3>
<div class="paragraph">
<p>The Foreman web UI provides two ways to verify the template rendering for a specific host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Directly in the template editor</strong> – when editing a template (under <strong>Hosts</strong> &gt; <strong>Partition tables</strong>, <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong>, or <strong>Hosts</strong> &gt; <strong>Job templates</strong>), on the <strong>Template</strong> tab click <strong>Preview</strong> and select a host from the list.
The template then renders in the text field using the selected host&#8217;s parameters.
Preview failures can help to identify issues in your template.</p>
</li>
<li>
<p><strong>At the host&#8217;s details page</strong> – select a host at <strong>Hosts</strong> &gt; <strong>All hosts</strong> and click the <strong>Templates</strong> tab to list templates associated with the host.
Select <strong>Review</strong> from the list next to the selected template to view it&#8217;s rendered version.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect-Managing_Hosts-Satellite_Specific_macros_and_Variables">Generic Foreman-Specific Macros</h3>
<div class="paragraph">
<p>This section lists Foreman-specific macros for ERB templates.</p>
</div>
<div class="paragraph">
<p>You can use the macros listed in the following table across all kinds of templates.</p>
</div>
<table id="tabl-Red_Hat_Satellite-Managing_Hosts-Generic_Macros" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Generic Macros</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">indent(n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indents the block of code by n spaces, useful when using a snippet template that is not indented.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">foreman_url(kind)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the full URL to host-rendered templates of the given kind.
For example, templates of the "provision" type usually reside at <strong><a href="http://HOST/unattended/provision" class="bare">http://HOST/unattended/provision</a></strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">snippet(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders the specified snippet template.
Useful for nesting provisioning templates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">snippets(file)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders the specified snippet found in the Foreman database, attempts to load it from the <strong>unattended/snippets/</strong> directory if it is not found in the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">snippet_if_exists(name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders the specified snippet, skips if no snippet with the specified name is found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="ref_template_macros">Templates Macros</h3>
<div class="paragraph">
<p>If you want to write custom templates, you can use some of the following macros.</p>
</div>
<div class="paragraph">
<p>Depending on the template type, some of the following macros have different requirements.</p>
</div>
<div class="paragraph">
<p>For more information about the available macros for report templates, in the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Report Templates</strong>, and click <strong>Create Template</strong>.
In the Create Template window, click the <strong>Help</strong> tab.</p>
</div>
<div class="paragraph">
<p>For more information about the available macros for job templates, in the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Job Templates</strong>, and click the <strong>New Job Template</strong>.
In the New Job Template window, click the <strong>Help</strong> tab.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">input</dt>
<dd>
<p>Using the <code>input</code> macro, you can customize the input data that the template can work with.
You can define the input name, type, and the options that are available for users.
For report templates, you can only use user inputs.
When you define a new input and save the template, you can then reference the input in the ERB syntax of the template body.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= input('cpus') %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This loads the value from user input <code>cpus</code>.</p>
</div>
</dd>
<dt class="hdlist1">load_hosts</dt>
<dd>
<p>Using the <code>load_hosts</code> macro, you can generate a complete list of hosts.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%- load_hosts().each_record do |host| -%&gt;
&lt;%=     host.name %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>load_hosts</code> macro with the <code>each_record</code> macro to load records in batches of 1000 to reduce memory consumption.</p>
</div>
<div class="paragraph">
<p>If you want to filter the list of hosts for the report, you can add the option <code>search: input(‘<em>Example_Host</em>’)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;% load_hosts(search: input('<em>Example_Host</em>')).each_record do |host| -%&gt;
&lt;%=  host.name %&gt;
&lt;% end -%&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, you first create an input that you then use to refine the search criteria that the <code>load_hosts</code> macro retrieves.</p>
</div>
</dd>
<dt class="hdlist1">report_row</dt>
<dd>
<p>Using the <code>report_row</code> macro, you can create a formatted report for ease of analysis.
The <code>report_row</code> macro requires the <code>report_render</code> macro to generate the output.</p>
<div class="listingblock">
<div class="title">Example input:</div>
<div class="content">
<pre class="nowrap">&lt;%- load_hosts(search: input('<em>Example_Host</em>')).each_record do |host| -%&gt;
&lt;%-   report_row(
        'Server FQDN': host.name
      ) -%&gt;
&lt;%- end -%&gt;
&lt;%= report_render -%&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rendering:</div>
<div class="content">
<pre class="nowrap">Server FQDN
<em>host1.example.com</em>
<em>host2.example.com</em>
<em>host3.example.com</em>
<em>host4.example.com</em>
<em>host5.example.com</em>
<em>host6.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>You can add extra columns to the report by adding another header.
The following example adds IP addresses to the report:</p>
</div>
<div class="listingblock">
<div class="title">Example input:</div>
<div class="content">
<pre class="nowrap">&lt;%- load_hosts(search: input('host')).each_record do |host| -%&gt;
&lt;%-   report_row(
      'Server FQDN': host.name,
           'IP': host.ip
      ) -%&gt;
&lt;%- end -%&gt;
&lt;%= report_render -%&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rendering:</div>
<div class="content">
<pre class="nowrap">Server FQDN,IP
<em>host1.example.com</em>,<em>10.8.30.228</em>
<em>host2.example.com</em>,<em>10.8.30.227</em>
<em>host3.example.com</em>,<em>10.8.30.226</em>
<em>host4.example.com</em>,<em>10.8.30.225</em>
<em>host5.example.com</em>,<em>10.8.30.224</em>
<em>host6.example.com</em>,<em>10.8.30.223</em></pre>
</div>
</div>
</dd>
<dt class="hdlist1">report_render</dt>
<dd>
<div class="paragraph">
<p>This macro is available only for report templates.</p>
</div>
<div class="paragraph">
<p>Using the <code>report_render</code> macro, you create the output for the report.
During the template rendering process, you can select the format that you want for the report.
YAML, JSON, HTML, and CSV formats are supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= report_render -%&gt;</pre>
</div>
</div>
</dd>
<dt class="hdlist1">render_template()</dt>
<dd>
<div class="paragraph">
<p>This macro is available only for job templates.</p>
</div>
<div class="paragraph">
<p>Using this macro, you can render a specific template.
You can also enable and define arguments that you want to pass to the template.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="ref_host_specific_variables_for_templates">Host-Specific Variables</h3>
<div class="paragraph">
<p>The following variables enable using host data within templates.
Note that job templates accept only <code>@host</code> variables.</p>
</div>
<table id="tabl-Red_Hat_Satellite-Managing_Hosts-Variables" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Host Specific Variables and Macros</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The architecture of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.bond_interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns an array of all bonded interfaces.
See <a href="#ref_working_with_arrays">Parsing Arrays</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.capabilities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The method of system provisioning, can be either build (for example kickstart) or image.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.certname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SSL certificate name of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.diskLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The disk layout of the host.
Can be inherited from the operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domain of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Puppet environment of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.facts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a Ruby hash of facts from Facter.
For example to access the 'ipaddress' fact from the output, specify @host.facts['ipaddress'].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.grub_pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the host&#8217;s bootloader password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.hostgroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host group of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host_enc['parameters']</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a Ruby hash containing information on host parameters.
For example, use host_enc['parameters']['lifecycle_environment'] to get the life cycle environment of a host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.image_build?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the host is provisioned using an image.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains an array of all available host interfaces including the primary interface.
See <a href="#ref_working_with_arrays">Parsing Arrays</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.interfaces_with_identifier('IDs')</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns array of interfaces with given identifier.
You can pass an array of multiple identifiers as an input, for example @host.interfaces_with_identifier(['eth0', 'eth1']).
See <a href="#ref_working_with_arrays">Parsing Arrays</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.ip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IP address of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.mac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The MAC address of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.managed_interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns an array of managed interfaces (excluding BMC and bonded interfaces).
See <a href="#ref_working_with_arrays">Parsing Arrays</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assigned operating system installation medium.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full name of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.operatingsystem.family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operating system family.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.operatingsystem.major</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The major version number of the assigned operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.operatingsystem.minor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minor version number of the assigned operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.operatingsystem.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assigned operating system name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.operatingsystem.boot_files_uri(medium_provider)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full path to the kernel and initrd, returns an array.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.os.medium_uri(@host)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI used for provisioning (path configured in installation media).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host_param('parameter_name')</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the value of the specified host parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host_param_false?('parameter_name')</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>false</code> if the specified host parameter evaluates to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host_param_true?('parameter_name')</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the specified host parameter evaluates to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.primary_interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the primary interface of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The compute resource provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.provision_interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the provisioning interface of the host.
Returns an interface object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.ptable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The partition table name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.puppet_ca_server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Puppet CA server the host must use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.puppetmaster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Puppet master the host must use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.pxe_build?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the host is provisioned using the network or PXE.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.shortname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The short name of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.sp_ip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IP address of the BMC interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.sp_mac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The MAC address of the BMC interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.sp_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the BMC interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.sp_subnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The subnet of the BMC network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.subnet.dhcp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if a DHCP proxy is configured for this host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.subnet.dns_primary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The primary DNS server of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.subnet.dns_secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The secondary DNS server of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.subnet.gateway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The gateway of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.subnet.mask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The subnet mask of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.url_for_boot(:initrd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full path to the initrd image associated with this host.
Not recommended, as it does not interpolate variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@host.url_for_boot(:kernel)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full path to the kernel associated with this host.
Not recommended, as it does not interpolate variables, prefer boot_files_uri.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@provisioning_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals to 'host' or 'hostgroup' depending on type of provisioning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@static</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the network configuration is static.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@template_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the template being rendered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grub_pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a bootloader argument to set the encrypted bootloader password, such as <strong>--md5pass=#{@host.grub_pass}</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ks_console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a string assembled using the port and the baud rate of the host which can be added to a kernel line.
For example <strong>console=ttyS1,9600</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">root_pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the root password configured for the system.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The majority of common Ruby methods can be applied on host-specific variables.
For example, to extract the last segment of the host&#8217;s IP address, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;% @host.ip.split('.').last %&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ref_kickstart_specific_variables">Kickstart-Specific Variables</h3>
<div class="paragraph">
<p>The following variables are designed to be used within kickstart provisioning templates.</p>
</div>
<table id="tabl-Red_Hat_Satellite-Managing_Hosts-Kickstart_Variables" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Kickstart Specific Variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@arch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host architecture name, same as @host.architecture.name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@dynamic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if the partition table being used is a %pre script (has the #Dynamic option as the first line of the table).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@epel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command which will automatically install the correct version of the epel-release rpm.
Use in a %post script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@mediapath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full kickstart line to provide the URL command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@osver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operating system major version number, same as @host.operatingsystem.major.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="ref_writing_conditional_statements">Conditional Statements</h3>
<div class="paragraph">
<p>In your templates, you might perform different actions depending on which value exists.
To achieve this, you can use conditional statements in your ERB syntax.</p>
</div>
<div class="paragraph">
<p>In the following example, the ERB syntax searches for a specific host name and returns an output depending on the value it finds:</p>
</div>
<div class="paragraph">
<p>Example input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;% load_hosts().each_record do |host| -%&gt;
&lt;% if @host.name == "<em>host1.example.com</em>" -%&gt;
&lt;%      result="positive" -%&gt;
&lt;%  else -%&gt;
&lt;%      result="negative" -%&gt;
&lt;%  end -%&gt;
&lt;%= result -%&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example rendering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>host1.example.com</em>
positive</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ref_working_with_arrays">Parsing Arrays</h3>
<div class="paragraph">
<p>While writing or modifying templates, you might encounter variables that return arrays.
For example, host variables related to network interfaces, such as <code>@host.interfaces</code> or <code>@host.bond_interfaces</code>, return interface data grouped in an array.
To extract a parameter value of a specific interface, use Ruby methods to parse the array.</p>
</div>
<div class="paragraph">
<div class="title">Finding the Correct Method to Parse an Array</div>
<p>The following procedure is an example that you can use to find the relevant methods to parse arrays in your template.
In this example, a report template is used, but the steps are applicable to other templates.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To retrieve the NIC of a content host, in this example, using the <code>@host.interfaces</code> variable returns class values that you can then use to find methods to parse the array.</p>
<div class="listingblock">
<div class="title">Example input:</div>
<div class="content">
<pre>&lt;%= @host.interfaces -%&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rendering:</div>
<div class="content">
<pre>&lt;Nic::Base::ActiveRecord_Associations_CollectionProxy:0x00007f734036fbe0&gt;</pre>
</div>
</div>
</li>
<li>
<p>In the Create Template window, click the <strong>Help</strong> tab and search for the <code>ActiveRecord_Associations_CollectionProxy</code> and <code>Nic::Base</code> classes.</p>
</li>
<li>
<p>For <code>ActiveRecord_Associations_CollectionProxy</code>, in the <strong>Allowed methods or members</strong> column, you can view the following methods to parse the array:</p>
<div class="listingblock">
<div class="content">
<pre>[] each find_in_batches first map size to_a</pre>
</div>
</div>
</li>
<li>
<p>For <code>Nic::Base</code>, in the <strong>Allowed methods or members</strong> column, you can view the following method to parse the array:</p>
<div class="listingblock">
<div class="content">
<pre>alias? attached_devices attached_devices_identifiers attached_to bond_options children_mac_addresses domain fqdn identifier inheriting_mac ip ip6 link mac managed? mode mtu nic_delay physical? primary provision shortname subnet subnet6 tag virtual? vlanid</pre>
</div>
</div>
</li>
<li>
<p>To iterate through an interface array, add the relevant methods to the ERB syntax:</p>
<div class="listingblock">
<div class="title">Example input:</div>
<div class="content">
<pre>&lt;% load_hosts().each_record do |host| -%&gt;
&lt;%    host.interfaces.each do |iface| -%&gt;
  iface.alias?: &lt;%= iface.alias? %&gt;
  iface.attached_to: &lt;%= iface.attached_to %&gt;
  iface.bond_options: &lt;%= iface.bond_options %&gt;
  iface.children_mac_addresses: &lt;%= iface.children_mac_addresses %&gt;
  iface.domain: &lt;%= iface.domain %&gt;
  iface.fqdn: &lt;%= iface.fqdn %&gt;
  iface.identifier: &lt;%= iface.identifier %&gt;
  iface.inheriting_mac: &lt;%= iface.inheriting_mac %&gt;
  iface.ip: &lt;%= iface.ip %&gt;
  iface.ip6: &lt;%= iface.ip6 %&gt;
  iface.link: &lt;%= iface.link %&gt;
  iface.mac: &lt;%= iface.mac %&gt;
  iface.managed?: &lt;%= iface.managed? %&gt;
  iface.mode: &lt;%= iface.mode %&gt;
  iface.mtu: &lt;%= iface.mtu %&gt;
  iface.physical?: &lt;%= iface.physical? %&gt;
  iface.primary: &lt;%= iface.primary %&gt;
  iface.provision: &lt;%= iface.provision %&gt;
  iface.shortname: &lt;%= iface.shortname %&gt;
  iface.subnet: &lt;%= iface.subnet %&gt;
  iface.subnet6: &lt;%= iface.subnet6 %&gt;
  iface.tag: &lt;%= iface.tag %&gt;
  iface.virtual?: &lt;%= iface.virtual? %&gt;
  iface.vlanid: &lt;%= iface.vlanid %&gt;
&lt;%- end -%&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rendering:</div>
<div class="content">
<pre class="nowrap"><em>host1.example.com</em>
  iface.alias?: false
  iface.attached_to:
  iface.bond_options:
  iface.children_mac_addresses: []
  iface.domain:
  iface.fqdn: <em>host1.example.com</em>
  iface.identifier: ens192
  iface.inheriting_mac: 00:50:56:8d:4c:cf
  iface.ip: 10.10.181.13
  iface.ip6:
  iface.link: true
  iface.mac: 00:50:56:8d:4c:cf
  iface.managed?: true
  iface.mode: balance-rr
  iface.mtu:
  iface.physical?: true
  iface.primary: true
  iface.provision: true
  iface.shortname: <em>host1.example.com</em>
  iface.subnet:
  iface.subnet6:
  iface.tag:
  iface.virtual?: false
  iface.vlanid:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref_example_template_snippets">Example Template Snippets</h3>
<div class="paragraph">
<div class="title">Checking if a Host Has Puppet and Puppetlabs Enabled</div>
<p>The following example checks if the host has the Puppet and Puppetlabs repositories enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%
pm_set = @host.puppetmaster.empty? ? false : true
puppet_enabled = pm_set || host_param_true?('force-puppet')
puppetlabs_enabled = host_param_true?('enable-puppetlabs-repo')
%&gt;</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Capturing Major and Minor Versions of a Host&#8217;s Operating System</div>
<p>The following example shows how to capture the minor and major version of the host&#8217;s operating system, which can be used for package related decisions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%
os_major = @host.operatingsystem.major.to_i
os_minor = @host.operatingsystem.minor.to_i
%&gt;

&lt;% if ((os_minor &lt; 2) &amp;&amp; (os_major &lt; 14)) -%&gt;
...
&lt;% end -%&gt;</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Importing Snippets to a Template</div>
<p>The following example imports the <strong>subscription_manager_registration</strong> snippet to the template and indents it by four spaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%= indent 4 do
snippet 'subscription_manager_registration'
end %&gt;</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Conditionally Importing a Kickstart Snippet</div>
<p>The following example imports the <code>kickstart_networking_setup</code> snippet if the host&#8217;s subnet has the DHCP boot mode enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;% subnet = @host.subnet %&gt;
&lt;% if subnet.respond_to?(:dhcp_boot_mode?) -%&gt;
&lt;%= snippet 'kickstart_networking_setup' %&gt;
&lt;% end -%&gt;</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Parsing Values from Host Custom Facts</div>
<p>You can use the <code>host.facts</code> variable to parse values from a host&#8217;s facts and custom facts.</p>
</div>
<div class="paragraph">
<p>In this example <code>luks_stat</code> is a custom fact that you can parse in the same manner as <code>dmi::system::serial_number</code>, which is a host fact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>'Serial': host.facts['dmi::system::serial_number'],
'Encrypted': host.facts['luks_stat'],</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, you can customize the Applicable Errata report template to parse for custom information about the kernel version of each host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;%-     report_row(
          'Host': host.name,
          'Operating System': host.operatingsystem,
          'Kernel': host.facts['uname::release'],
          'Environment': host.lifecycle_environment,
          'Erratum': erratum.errata_id,
          'Type': erratum.errata_type,
          'Published': erratum.issued,
          'Applicable since': erratum.created_at,
          'Severity': erratum.severity,
          'Packages': erratum.package_names,
          'CVEs': erratum.cves,
          'Reboot suggested': erratum.reboot_suggested,
        ) -%&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="job-template-examples-and-extensions">Appendix B: Job Template Examples and Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this section as a reference to help modify, customize, and extend your job templates to suit your requirements.</p>
</div>
<div class="sect2">
<h3 id="customizing-templates_managing-hosts">Customizing Job Templates</h3>
<div class="paragraph">
<p>When creating a job template, you can include an existing template in the template editor field.
This way you can combine templates, or create more specific templates from the general ones.</p>
</div>
<div class="paragraph">
<p>The following template combines default templates to install and start the <strong>httpd</strong> service on Red Hat Enterprise Linux systems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%= render_template 'Package Action - SSH Default', :action =&gt; 'install', :package =&gt; 'httpd' %&gt;
&lt;%= render_template 'Service Action - SSH Default', :action =&gt; 'start', :service_name =&gt; 'httpd' %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above template specifies parameter values for the rendered template directly.
It is also possible to use the <strong>input()</strong> method to allow users to define input for the rendered template on job execution.
For example, you can use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%= render_template 'Package Action - SSH Default', :action =&gt; 'install', :package =&gt; input("package") %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above template, you have to import the parameter definition from the rendered template.
To do so, navigate to the <strong>Jobs</strong> tab, click <strong>Add Foreign Input Set</strong>, and select the rendered template from the <strong>Target template</strong> list.
You can import all parameters or specify a comma separated list.</p>
</div>
</div>
<div class="sect2">
<h3 id="default-job-template-categories_managing-hosts">Default Job Template Categories</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Job template category</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for performing package related actions.
Install, update, and remove actions are included by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for executing Puppet runs on target hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for performing power related actions.
Restart and shutdown actions are included by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for executing custom commands on remote hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for performing service related actions.
Start, stop, restart, and status actions are included by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Katello</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for performing content related actions.
These templates are used mainly from different parts of the Foreman web UI (for example bulk actions UI for content hosts), but can be used separately to perform operations such as errata installation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="default-example-restorecon-template_managing-hosts">Example restorecon Template</h3>
<div class="paragraph">
<p>This example shows how to create a template called <strong>Run Command - restorecon</strong> that restores the default <strong>SELinux</strong> context for all files in the selected directory on target hosts.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Job templates</strong>.
Click <strong>New Job Template</strong>.</p>
</li>
<li>
<p>Enter <strong>Run Command - restorecon</strong> in the <strong>Name</strong> field.
Select <strong>Default</strong> to make the template available to all organizations.
Add the following text to the template editor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">restorecon -RvF &lt;%= input("directory") %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;%= input("directory") %&gt;</code> string is replaced by a user-defined directory during job invocation.</p>
</div>
</li>
<li>
<p>On the <strong>Job</strong> tab, set <strong>Job category</strong> to <code>Commands</code>.</p>
</li>
<li>
<p>Click <strong>Add Input</strong> to allow job customization.
Enter <code>directory</code> to the <strong>Name</strong> field.
The input name must match the value specified in the template editor.</p>
</li>
<li>
<p>Click <strong>Required</strong> so that the command cannot be executed without the user specified parameter.</p>
</li>
<li>
<p>Select <strong>User input</strong> from the <strong>Input type</strong> list.
Enter a description to be shown during job invocation, for example <code>Target directory for restorecon</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#default-example-of-executing-restorecon-on-multiple-hosts_managing-hosts">Executing a restorecon Template on Multiple Hosts</a> for information on how to execute a job based on this template.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-rendering-of-the-restorecon-template_managing-hosts">Rendering a restorecon Template</h3>
<div class="paragraph">
<p>This example shows how to create a template derived from the <strong>Run command - restorecon</strong> template created in <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#default-example-restorecon-template_managing-hosts">Example restorecon Template</a>.
This template does not require user input on job execution, it will restore the SELinux context in all files under the <strong>/home/</strong> directory on target hosts.</p>
</div>
<div class="paragraph">
<p>Create a new template as described in <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#setting-up-job-templates_managing-hosts">Setting up Job Templates</a>, and specify the following string in the template editor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%= render_template("Run Command - restorecon", :directory =&gt; "/home") %&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-example-of-executing-restorecon-on-multiple-hosts_managing-hosts">Executing a restorecon Template on Multiple Hosts</h3>
<div class="paragraph">
<p>This example shows how to run a job based on the template created in <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#default-example-restorecon-template_managing-hosts">Example restorecon Template</a> on multiple hosts.
The job restores the SELinux context in all files under the <strong>/home/</strong> directory.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong> and select target hosts.
Select <strong>Schedule Remote Job</strong> from the <strong>Select Action</strong> list.</p>
</li>
<li>
<p>In the <strong>Job invocation</strong> page, select the <code>Commands</code> job category and the <code>Run Command - restorecon</code> job template.</p>
</li>
<li>
<p>Type <code>/home</code> in the <strong>directory</strong> field.</p>
</li>
<li>
<p>Set <strong>Schedule</strong> to <code>Execute now</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
You are taken to the <strong>Job invocation</strong> page where you can monitor the status of job execution.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="example-including-power-actions-in-a-job-template_managing-hosts">Including Power Actions in Templates</h3>
<div class="paragraph">
<p>This example shows how to set up a job template for performing power actions, such as reboot.
This procedure prevents Foreman from interpreting the disconnect exception upon reboot as an error, and consequently, remote execution of the job works correctly.</p>
</div>
<div class="paragraph">
<p>Create a new template as described in <a href="https://docs.theforeman.org/2.5/Managing_Hosts/index-foreman-el.html#setting-up-job-templates_managing-hosts">Setting up Job Templates</a>, and specify the following string in the template editor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%= render_template("Power Action - SSH Default", :action =&gt; "restart") %&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.5 (unsupported)<br>
Last updated Apr 2023
</div>
</div>
</body>
</html>